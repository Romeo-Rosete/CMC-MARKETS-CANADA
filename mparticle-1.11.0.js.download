/*! For license information please see mparticle.js.LICENSE.txt */
(()=>{var e={99:(e,t)=>{var r="GoogleAdWords",n=3,o=4,i=16,s="GoogleAds.ECData",a=function(){var e,t,a,c,d,l=this,g=!1,p=[];function m(t,r,n){return!!(t.ProductAction&&t.ProductAction.ProductList&&t.ProductAction.ProductActionType)&&(window.gtag&&"True"==e.enableGtag?b(t,r,n):window.google_trackConversion?h(t,r,n):(console.error("Unrecognized Commerce Event",t),!1))}function f(){var t={google_conversion_value:0,google_conversion_language:"en",google_conversion_format:"3",google_conversion_color:"ffffff"};return t.google_remarketing_only="True"==e.remarketingOnly,t.google_conversion_id=e.conversionId,t}function v(e,t,r){var n=f();return n.google_conversion_label=t,n.google_custom_params=r,n}function h(e,t,r){var n=f();return n.google_conversion_label=t,e.ProductAction.ProductActionType===mParticle.ProductActionType.Purchase&&e.ProductAction.TransactionId&&(n.google_conversion_order_id=e.ProductAction.TransactionId),e.CurrencyCode&&(n.google_conversion_currency=e.CurrencyCode),e.ProductAction.TotalAmount&&(n.google_conversion_value=e.ProductAction.TotalAmount),n.google_custom_params=r,n}function y(t){return{send_to:d+"/"+t,value:0,language:"en",remarketing_only:"True"==e.remarketingOnly}}function P(e,t,r){if(!t)return null;var n=y(t);return n.transaction_id=e.SourceMessageId,u(n,r)}function b(e,t,r){if(!t)return null;var n=y(t);return e.ProductAction.ProductActionType===mParticle.ProductActionType.Purchase&&e.ProductAction.TransactionId?n.transaction_id=e.ProductAction.TransactionId:n.transaction_id=e.SourceMessageId,e.CurrencyCode&&(n.currency=e.CurrencyCode),e.ProductAction.TotalAmount&&(n.value=e.ProductAction.TotalAmount),u(n,r)}function C(e){try{gtag("event","conversion",e)}catch(t){return console.error("gtag is not available to send payload: ",e,t),!1}return!0}function w(e){try{window.google_trackConversion(e)}catch(t){return console.error("google_trackConversion is not available to send payload: ",e,t),!1}return!0}function S(e,t,r){if(r){var n=r.filter((function(r){return!!(r.jsmap&&r.maptype&&r.value)&&(r.jsmap==e&&r.maptype==t)}));if(n&&n.length>0)return n[0]}return null}function _(e,t,r){var n=[e,t,r].join("");return mParticle.generateHash(n)}function I(e){var t;if((window.gtag||window.google_trackConversion)&&e.length>0)try{for(;e.length>0;)(t=e.shift()).action(t.data)}catch(e){console.error("Error on mParticle Adwords Kit",e)}}l.name=r,this.init=function(n,o,i){window.enhanced_conversion_data={},e=n,c=o;try{if(!e.conversionId)return"Can't initialize forwarder: "+r+", conversionId is not defined";if(d="AW-"+e.conversionId,!0!==i?"True"==e.enableGtag?function(){window.dataLayer=window.dataLayer||[],window.gtag=function(){dataLayer.push(arguments)};var t=document.createElement("script");t.async=!0,t.onload=function(){gtag("js",new Date),"True"===e.enableEnhancedConversions?gtag("config",d,{allow_enhanced_conversions:!0}):gtag("config",d),g=!0,I(p)},t.src="https://www.googletagmanager.com/gtag/js?id="+d,document.getElementsByTagName("head")[0].appendChild(t)}():((s=document.createElement("script")).type="text/javascript",s.async=!0,s.onload=function(){g=!0,I(p)},s.src=("https:"==document.location.protocol?"https":"http")+"://www.googleadservices.com/pagead/conversion_async.js",document.getElementsByTagName("head")[0].appendChild(s)):(g=!0,I(p)),!e.conversionId)return"Can't initialize forwarder: "+r+", conversionId is not defined";e.remarketingOnly="True"==e.remarketingOnly;try{e.labels&&(t=JSON.parse(e.labels.replace(/&quot;/g,'"'))),e.customParameters&&(a=JSON.parse(e.customParameters.replace(/&quot;/g,'"')))}catch(e){return"Can't initialize forwarder: "+r+", Could not process event to label mapping"}return"Successfully initialized: "+r}catch(e){return"Failed to initialize: "+r}var s},this.process=function u(d){var f,y,A=!1,E=function(){},T=function(){};if(g){I(p);try{if(window.gtag&&"True"==e.enableGtag)"True"===e.enableEnhancedConversions&&((y=d.CustomFlags)&&Object.keys(y).length&&y[s])&&(window.enhanced_conversion_data=function(e){if("string"!=typeof e)return"object"==typeof e?(t=e,JSON.parse(JSON.stringify(t))):(console.warn("Unrecognized Enhanced Conversion Data Format",e),{});try{return JSON.parse(e)}catch(t){return console.warn("Unrecognized Enhanced Conversion Data Format",e,t),{}}var t}(d.CustomFlags[s])),E=C,T=P,m=b;else{if(!window.google_trackConversion)return p.push({action:u,data:d}),"Can't send to forwarder "+r+", not initialized. Event added to queue.";E=w,T=v,m=h}var k=function(e){var r=_(e.EventDataType,e.EventCategory,e.EventName),n=e.EventDataType===o?"EventClass.Id":"EventClassDetails.Id",i=null,s=S(r,n,t);s&&(i=s.value);return i}(d),D=function(e){var t={},r=e.EventAttributes,n=e.EventDataType===o?"EventAttributeClass.Id":"EventAttributeClassDetails.Id";if(r)for(var i in r)if(r.hasOwnProperty(i)){var s=S(_(e.EventDataType,e.EventCategory,i),n,a);s&&(t[s.value]=r[i])}return t}(d);return k&&(d.EventDataType==n||d.EventDataType==o?f=T(d,k,D):d.EventDataType==i&&d.ProductAction&&(f=m(d,k,D)),f&&(A=E(f)),A&&c)?(c(l,d),"Successfully sent to "+r):"Can't send to forwarder: "+r+". Event not mapped"}catch(e){return console.error("Can\t send to forwarder",e),"Can't send to forwarder: "+r+" "+e}}else p.push({action:u,data:d});return"Can't send to forwarder "+r+", not initialized. Event added to queue."},this.processQueue=I};function c(e){return null!=e&&"object"==typeof e&&!1===Array.isArray(e)}function u(){for(var e={},t=0;t<arguments.length;t+=1)for(var r=arguments[t],n=Object.keys(r),o=0;o<n.length;o+=1)e[n[o]]=r[n[o]];return e}"undefined"!=typeof window&&window&&window.mParticle&&window.mParticle.addForwarder&&window.mParticle.addForwarder({name:r,constructor:a,getId:function(){return 82}});var d={register:function(e){e?c(e)?(c(e.kits)||(e.kits={}),e.kits[r]={constructor:a},console.log("Successfully registered "+r+" to your mParticle configuration")):console.log("'config' must be an object. You passed in a "+typeof e):console.log("You must pass a config object to register the kit "+r)}};t.Z=d},364:(e,t)=>{var r,n,o,i="Amplitude",s=3,a=4,c=16,u="mpId",d="customerId",l="email",g="other",p="other2",m="other3",f="other4",v="other5",h="other6",y="other7",P="other8",b="other9",C="other10",w="mparticle_amplitude_should_split",S="Total Amount",_="Total",I="products",A="Refund",E="Purchase",T=function(){var e,t,T,k=this,D=!1;function O(){return T?window.amplitude.getInstance():window.amplitude.getInstance(e.instanceName)}function U(e,t){if(!D)return"Cannot call setUserAttribute on forwarder "+i+", not initialized";try{var r={};return r[e]=t,O().setUserProperties(r),"Successfully called setUserProperties API on "+i}catch(e){return"Failed to call SET setUserProperties on "+i+" "+e}}function L(e){e.EventAttributes?(e.EventAttributes=N(e.EventAttributes),O().logEvent(e.EventName,e.EventAttributes)):O().logEvent(e.EventName)}function M(e){var t={};for(var r in e)r!==S&&"Total Product Amount"!==r&&(t[r]=e[r]);return N(t)}function N(t){if("True"===e.sendEventAttributesAsObjects)for(var r in t)if("string"==typeof t[r])try{var n=JSON.parse(t[r]);"object"==typeof n&&(t[r]=n)}catch(e){}return t}k.name=i,this.init=function(s,a,c){var d;t=a,r="False"===(e=s).excludeIndividualProductEvents,n=r,o="True"===e.enableTempAmplitudeEcommerce;try{if(window.amplitude||!0!==c&&function(e,t){var r=e.amplitude||{_q:[],_iq:{}},n=t.createElement("script");n.type="text/javascript",n.integrity="sha384-QahB0HKETlcqjneomU3Ohs+UgJTinhUNFIKJitEl2Vo7DjvphO2jei64ZP5J2GA5",n.crossOrigin="anonymous",n.async=!0,n.src="https://cdn.amplitude.com/libs/amplitude-8.21.8-min.gz.js",n.onload=function(){e.amplitude.runQueuedFunctions||console.log("[Amplitude] Error: could not load SDK")};var o=t.getElementsByTagName("script")[0];function i(e,t){e.prototype[t]=function(){return this._q.push([t].concat(Array.prototype.slice.call(arguments,0))),this}}o.parentNode.insertBefore(n,o);for(var s=function(){return this._q=[],this},a=["add","append","clearAll","prepend","set","setOnce","unset","preInsert","postInsert","remove"],c=0;c<a.length;c++)i(s,a[c]);r.Identify=s;for(var u=function(){return this._q=[],this},d=["setProductId","setQuantity","setPrice","setRevenueType","setEventProperties"],l=0;l<d.length;l++)i(u,d[l]);r.Revenue=u;var g=["init","logEvent","logRevenue","setUserId","setUserProperties","setOptOut","setVersionName","setDomain","setDeviceId","enableTracking","setGlobalUserProperties","identify","clearUserProperties","setGroup","logRevenueV2","regenerateDeviceId","groupIdentify","onInit","onNewSessionStart","logEventWithTimestamp","logEventWithGroups","setSessionId","resetSessionId","getDeviceId","getUserId","setMinTimeBetweenSessionsMillis","setEventUploadThreshold","setUseDynamicConfig","setServerZone","setServerUrl","sendEvents","setLibrary","setTransport"];function p(e){function t(t){e[t]=function(){e._q.push([t].concat(Array.prototype.slice.call(arguments,0)))}}for(var r=0;r<g.length;r++)t(g[r])}p(r),r.getInstance=function(e){return e=(e&&0!==e.length?e:"$default_instance").toLowerCase(),Object.prototype.hasOwnProperty.call(r._iq,e)||(r._iq[e]={_q:[]},p(r._iq[e])),r._iq[e]},e.amplitude=r}(window,document),d={},"object"==typeof window.AmplitudeInitSettings&&null!==window.AmplitudeInitSettings&&(d=window.AmplitudeInitSettings),e.saveEvents&&(d.saveEvents="True"===e.saveEvents),e.savedMaxCount&&(d.savedMaxCount=parseInt(e.savedMaxCount,10)),e.uploadBatchSize&&(d.uploadBatchSize=parseInt(e.uploadBatchSize,10)),e.includeUtm&&(d.includeUtm="True"===e.includeUtm),e.includeReferrer&&(d.includeReferrer="True"===e.includeReferrer),e.forceHttps&&(d.forceHttps="True"===e.forceHttps),e.baseUrl&&(d.apiEndpoint=e.baseUrl),T=!e.instanceName||"default"===e.instanceName,O().init(e.apiKey,null,d),D=!0,e.userIdentification===u&&window.mParticle&&window.mParticle.Identity){var l=window.mParticle.Identity.getCurrentUser();if(l){var g=l.getMPID();O().setUserId(g)}}return"Successfully initialized: "+i}catch(e){return"Failed to initialize: "+i}},this.process=function(e){var u,d=!1;if(D)try{return e.EventDataType===s?(d=!0,(u=e).EventAttributes?(u.EventAttributes=N(u.EventAttributes),O().logEvent("Viewed "+u.EventName,u.EventAttributes)):O().logEvent("Viewed "+u.EventName)):e.EventDataType===c?d=function(e){var t=mParticle.eCommerce.expandCommerceEvent(e);if(e.ProductAction){return o?function(e,t){var o,i,s;o=e.ProductAction.ProductActionType===mParticle.ProductActionType.Refund,i=e.ProductAction.ProductActionType===mParticle.ProductActionType.Purchase,s=o||i,s&&t[0].EventName.indexOf(_)>-1&&function(e,t,r,n){var o=function(e,t,r){var n={};for(var o in e)if(o===S){var i=e[o]*(r?-1:1);n[t?"revenue":"$revenue"]=i}else o!==S&&(n[o]=e[o]);return N(n)}(e.EventAttributes,n,r);o[w]=!1,o[I]=t;var i=r?A:E;O().logEvent("eCommerce - "+i,o)}(t[0],e.ProductAction.ProductList,o,n);s||function(e){var t=M(e.EventAttributes);t[w]=!1;try{t[I]=e.ProductAction.ProductList}catch(e){console.error("error adding Product List to summary event")}O().logEvent(e.EventName,t)}(e);r&&function(e,t,r,n){e.forEach((function(e){var o;if(t&&e.EventName.indexOf(_)>-1&r){var i=(e.EventAttributes[S]||0)*(n?-1:1);o=function(e){var t={};for(var r in e)r!==S&&(t[r]=e[r]);return N(t)}(e.EventAttributes);var s=(new window.amplitude.Revenue).setPrice(i).setEventProperties(o);O().logRevenueV2(s)}else-1===e.EventName.indexOf(_)&&(o=M(e.EventAttributes),O().logEvent(e.EventName,o))}))}(t,s,n,o);return!0}(e,t):(i=e.ProductAction.ProductActionType===mParticle.ProductActionType.Refund,s=e.ProductAction.ProductActionType===mParticle.ProductActionType.Purchase,a=i||s,t.forEach((function(e){var t=M(e.EventAttributes);if(a&&e.EventName.indexOf("Total")>-1){var r=(e.EventAttributes["Total Amount"]||0)*(i?-1:1),n=(new window.amplitude.Revenue).setPrice(r).setEventProperties(t);O().logRevenueV2(n)}else O().logEvent(e.EventName,t)})),!0);var i,s,a}if(function(e){return e.EventCategory===mParticle.CommerceEventType.ProductImpression||e.EventCategory===mParticle.CommerceEventType.PromotionView||e.EventCategory===mParticle.CommerceEventType.PromotionClick}(e))return t.forEach((function(e){var t=M(e.EventAttributes);O().logEvent(e.EventName,t)})),!0;return console.warn("Commerce event does not conform to our expectations and was not forwarded to Amplitude. Please double-check your code."),!1}(e):e.EventDataType===a&&(d=!0,e.EventCategory===window.mParticle.EventType.Transaction?function(e){if(!e.EventAttributes||!e.EventAttributes.$MethodName||"LogEcommerceTransaction"===!e.EventAttributes.$MethodName)return void L(e);O().logRevenue(e.EventAttributes.RevenueAmount,e.EventAttributes.ProductQuantity,e.EventAttributes.ProductSKU.toString())}(e):L(e)),d&&t&&t(k,e),"Successfully sent to "+i}catch(e){return"Failed to send to: "+i+" "+e}return"Cannot send to forwarder "+i+", not initialized"},this.setUserIdentity=function(e,t){var r;if("1"===window.mParticle.getVersion()[0])return D?void(t===window.mParticle.IdentityType.CustomerId?O().setUserId(e):U((r=t,mParticle.IdentityType.getName(r)),e)):"Cannot call setUserIdentity on forwarder "+i+", not initialized"},this.onUserIdentified=function(t){var r;if(!D)return"Cannot call onUserIdentified on forwarder "+i+", not initialized";var n=t.getUserIdentities().userIdentities;"True"===e.includeEmailAsUserProperty&&U("email",n.email);try{switch(e.userIdentification){case u:r=t.getMPID();break;case d:r=n.customerid;break;case l:r=n.email;break;case g:r=n.other;break;case p:r=n.other2;break;case m:r=n.other3;break;case f:r=n.other4;break;case v:r=n.other5;break;case h:r=n.other6;break;case y:r=n.other7;break;case P:r=n.other8;break;case b:r=n.other9;break;case C:r=n.other10;break;default:r=null}if(r)return O().setUserId(r);console.warn("A user identification type of "+e.userIdentification+" was selected in mParticle dashboard, but was not passed to the identity call. Please check your implementation.")}catch(e){console.error("Error calling onUserIdentified on forwarder "+i)}},this.setUserAttribute=U,this.setOptOut=function(e){if(!D)return"Cannot call setOptOut on forwarder "+i+", not initialized";O().setOptOut(e)},this.removeUserAttribute=function(t){if(!D)return"Cannot call removeUserAttribute on forwarder "+i+", not initialized";if(e.allowUnsetUserAttributes&&"True"===e.allowUnsetUserAttributes)try{var r=(new window.amplitude.Identify).unset(t);return O().identify(r),"Successfully unset Amplitude user property: "+t}catch(e){return"Failed to call unset on "+i+" "+e}}};function k(e){return null!=e&&"object"==typeof e&&!1===Array.isArray(e)}"undefined"!=typeof window&&window&&window.mParticle&&window.mParticle.addForwarder&&window.mParticle.addForwarder({name:i,constructor:T,getId:function(){return 53}});var D={register:function(e){e?k(e)?(k(e.kits)||(e.kits={}),e.kits[i]={constructor:T},console.log("Successfully registered "+i+" to your mParticle configuration")):console.log('The "config" must be an object. You passed in a '+typeof e):console.log("You must pass a config object to register the kit "+i)}},O=D.register;t.ZP=D},334:(e,t)=>{function r(e){return null!=e&&"object"==typeof e&&!1===Array.isArray(e)}var n="Bing",o=3,i=4,s=16,a=function(){var e=this,t=!1,r=null,a=null;function c(r){if(!t)return"Can't send to forwarder: Bing, not initialized";var c=!1;try{if(r.EventDataType==i||r.EventDataType==o?(c=!0,function(e){if(!t)return"Can't log event on forwarder: Bing, not initialized";try{var r=u(e,"pageLoad");window.uetq.push(r)}catch(e){return"Can't log event on forwarder: Bing: "+e}}(r)):r.EventDataType==s&&r.ProductAction&&r.ProductAction.ProductActionType==mParticle.ProductActionType.Purchase&&(c=!0,function(e){if(!t)return"Can't log purchase event on forwarder: Bing, not initialized";if(void 0===e.ProductAction.TotalAmount||null===e.ProductAction.TotalAmount)return"Can't log purchase event without a total amount on product action";try{var r=u(e,"eCommerce");r.gv=e.ProductAction.TotalAmount,window.uetq.push(r)}catch(e){return"Can't log commerce event on forwarder: Bing: "+e}}(r)),c&&a)return a(e,r),"Successfully sent to forwarder: "+n}catch(e){return"Can't send to forwarder: Bing "+e}}function u(e,t){var r={ea:t,ec:window.mParticle.EventType.getName(e.EventCategory),el:e.EventName};return e.CustomFlags&&e.CustomFlags["Bing.EventValue"]&&(r.ev=e.CustomFlags["Bing.EventValue"]),r}e.name=n,this.init=function(e,o,i){r=e,a=o;try{if(!i&&(function(e,t,n,o,i){var s,a,c;e[i]=e[i]||[],e.uetq=e.uetq||[],s=function(){var t={ti:r.tagId,q:e.uetq};t.q=e[i],e[i]=new UET(t),e[i].push("pageLoad")},(a=t.createElement(n)).src="//bat.bing.com/bat.js",a.async=1,a.onload=a.onreadystatechange=function(){var e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(s(),a.onload=a.onreadystatechange=null)},(c=t.getElementsByTagName(n)[0]).parentNode.insertBefore(a,c)}(window,document,"script",0,"uetq"),window.uetq&&window.queue&&window.queue.length>0)){for(var s=0,u=window.queue.length;s<u;s++)c(window.queue[s]);window.queue.length=0}return t=!0,"Successfully initialized: "+n}catch(e){return"Can't initialize forwarder: Bing: "+e}},this.process=c};window&&window.mParticle&&window.mParticle.addForwarder&&window.mParticle.addForwarder({name:n,constructor:a,getId:function(){return 107}});var c={register:function(e){e?r(e)?(r(e.kits)||(e.kits={}),e.kits[n]={constructor:a},window.console.log("Successfully registered Bing to your mParticle configuration")):window.console.log("'config' must be an object. You passed in a "+typeof e):window.console.log("You must pass a config object to register the kit "+n)}},u=c.register;t.ZP=c},862:(e,t,r)=>{"use strict";var n=["item_category","item_category2","item_category3","item_category4","item_category5"],o=["google_","firebase_","ga_"],i=/[^a-zA-Z0-9_]/g;function s(e,t){return e&&e.length>t?e.substring(0,t):e}function a(e){return null==e||!(Object.keys(e)||e).length}function c(){}c.prototype.forwarderSettings=null,c.prototype.mergeObjects=function(){for(var e={},t=0;t<arguments.length;t+=1)for(var r=arguments[t],n=Object.keys(r),o=0;o<n.length;o+=1)e[n[o]]=r[n[o]];return e},c.prototype.truncateAttributes=function(e,t,r){var n={};return a(e)||Object.keys(e).forEach((function(o){var i=s(o,t),a=s(e[o],r);n[i]=a})),n},c.prototype.limitAttributes=function(e,t){if(a(e))return{};var r=Object.keys(e);return r.sort(),r.slice(0,t).reduce((function(t,r){return t[r]=e[r],t}),{})},c.prototype.limitEventAttributes=function(e){return this.limitAttributes(e,100)},c.prototype.limitProductAttributes=function(e){var t={},r={};for(var o in e)n.indexOf(o)>=0?r[o]=e[o]:t[o]=e[o];var i=this.limitAttributes(t,10);return this.mergeObjects(i,r)},c.prototype.truncateEventName=function(e){return s(e,40)},c.prototype.truncateEventAttributes=function(e){return this.truncateAttributes(e,40,100)},c.prototype.standardizeParameters=function(e){var t={};for(var r in e){t[this.standardizeName(r)]=e[r]}return t},c.prototype.standardizeName=function(e){try{e=window.GoogleAnalytics4Kit.setCustomNameStandardization(e)}catch(e){console.error("Error calling setCustomNameStandardization callback. Check your callback.  Data will still be sent without user-defined standardization. See our docs for proper use - https://docs.mparticle.com/integrations/google-analytics-4/event/",e)}function t(e){return!a(e)&&/^[a-zA-Z]/.test(e.charAt(0))}function r(e){var t=!1;if(!a(e))for(var r=0;r<o.length;r++){var n=o[r];if(0===e.indexOf(n)){t=!0;break}}return t}function n(e){for(var t=e.slice();!a(t)&&t.charAt(0).match(/[^a-zA-Z]/i);)t=t.substring(1);return t}function s(e){var t=e.slice();return o.forEach((function(e){0===t.indexOf(e)&&(t=t.replace(e,""))})),t}for(var c=function(e){return e.replace(i,"_")}(e);!t(c)||r(c);)c=s(c=n(c));return c},c.prototype.truncateUserAttributes=function(e){return this.truncateAttributes(e,24,36)},c.prototype.getUserId=function(e,t,r){if(e){var n,o="None",i="Other",s="Other2",a="Other3",c="Other4",u="Other5",d="Other6",l="Other7",g="Other8",p="Other9",m="Other10",f="mpid",v=e.getUserIdentities().userIdentities;if(t!==o){switch(t){case"CustomerId":n=v.customerid;break;case i:n=v.other;break;case s:n=v.other2;break;case a:n=v.other3;break;case c:n=v.other4;break;case u:n=v.other5;break;case d:n=v.other6;break;case l:n=v.other7;break;case g:n=v.other8;break;case p:n=v.other9;break;case m:n=v.other10;break;case f:n=e.getMPID();break;default:console.warn("External identity type not found for setting identity on GA4. User not set. Please double check your implementation.")}return n?"True"==r&&(n=window.mParticle.generateHash(n)):console.warn("External identity type of "+t+" not set on the user"),n}}};var u=c,d="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==r.g?r.g:"undefined"!=typeof self?self:{};function l(e){d.common=this.common=e||{}}var g={Unknown:0,AddToCart:10,Click:14,Checkout:12,CheckoutOption:13,Impression:22,Purchase:16,Refund:17,RemoveFromCart:11,ViewDetail:15,AddToWishlist:20},p={PromotionClick:19,PromotionView:18},m="GA4.CommerceEventType",f="GA4.ShippingTier",v="GA4.PaymentType",h="add_shipping_info",y="add_payment_info",P="view_cart";function b(e){return e.split(/(?=[A-Z])/).join("_").toLowerCase()}function C(e,t){var r=[];return e.forEach((function(e){r.push(function(e,t){var r={};for(var n in t&&(r.affiliation=t),r=d.common.mergeObjects(r,d.common.limitProductAttributes(e.Attributes)),e)switch(n){case"Sku":r.item_id=e.Sku;break;case"Name":r.item_name=e.Name;break;case"Brand":r.item_brand=e.Brand;break;case"Category":r.item_category=e.Category;break;case"CouponCode":r.coupon=e.CouponCode;break;case"Variant":r.item_variant=e.Variant;break;case"Attributes":break;default:r[b(n)]=e[n]}return d.common.forwarderSettings.enableDataCleansing?d.common.standardizeParameters(r):r}(e,t))})),r}function w(e){switch(e.EventCategory){case g.AddToCart:return"add_to_cart";case g.AddToWishlist:return"add_to_wishlist";case g.RemoveFromCart:return"remove_from_cart";case g.Purchase:return"purchase";case g.Checkout:return"begin_checkout";case g.CheckoutOption:return function(e){switch(e[m]){case h:return h;case y:return y;default:return"set_checkout_option"}}(e.CustomFlags);case g.Click:return"select_item";case g.Impression:return"view_item_list";case g.Refund:return"refund";case g.ViewDetail:return"view_item";case p.PromotionClick:return"select_promotion";case p.PromotionView:return"view_promotion";case g.Unknown:if(e.CustomFlags&&e.CustomFlags[m]===P)return"view_cart";break;default:return console.error("Product Action Type not supported"),null}}l.prototype.logCommerceEvent=function(e){var t=!0,r=!0,n={},o=!1,i=e.EventAttributes||{},s=e&&e.ProductAction?e.ProductAction.Affiliation:null;if(e.EventCategory===g.Unknown&&e.CustomFlags&&e.CustomFlags[m]===P)return o=!0,function(e,t){var r=function(e,t){return{items:C(e.ProductAction.ProductList,t)}}(e,t);return r=d.common.mergeObjects(r,d.common.limitEventAttributes(e.EventAttributes)),r.currency=e.CurrencyCode,r.value=e.CustomFlags&&e.CustomFlags["GA4.Value"]||e.ProductAction.TotalAmount||null,gtag("event",w(e),r),!0}(e,s);if(e.EventCategory===g.Impression)return function(e,t){try{var r;e.ProductImpressions.forEach((function(n){r=function(e,t){return{item_list_id:e.ProductImpressionList,item_list_name:e.ProductImpressionList,items:C(e.ProductList,t)}}(n,t),gtag("event",w(e),r)}))}catch(e){return console.log("Error logging Impressions to GA4. Impressions not logged",e),!1}return!0}(e,s);if(e.EventCategory===p.PromotionClick||e.EventCategory===p.PromotionView)return function(e){try{var t;return e.PromotionAction.PromotionList.forEach((function(r){t=function(e){return function(e){var t={};for(var r in e)switch(r){case"Id":t.promotion_id=e.Id;break;case"Creative":t.creative_name=e.Creative;break;case"Name":t.promotion_name=e.Name;break;case"Position":t.creative_slot=e.Position;break;default:t[b(r)]=e[r]}return d.common.forwarderSettings.enableDataCleansing?d.common.standardizeParameters(t):t}(e)}(r),gtag("event",w(e),t)})),!0}catch(e){console.error("Error logging Promotions to GA4. Promotions not logged.",e)}return!1}(e);switch(e.EventCategory){case g.AddToCart:case g.RemoveFromCart:n=function(e,t){return{items:C(e.ProductAction.ProductList,t)}}(e,s);break;case g.Checkout:n=function(e,t){return{items:C(e.ProductAction.ProductList,t),coupon:e.ProductAction?e.ProductAction.CouponCode:null}}(e,s);break;case g.Click:n=function(e,t){return{items:C(e.ProductAction.ProductList,t)}}(e,s),t=!1,r=!1;break;case g.Purchase:case g.Refund:n=function(e,t){return{transaction_id:e.ProductAction.TransactionId,value:e.ProductAction.TotalAmount,coupon:e.ProductAction.CouponCode,shipping:e.ProductAction.ShippingAmount,tax:e.ProductAction.TaxAmount,items:C(e.ProductAction.ProductList,t)}}(e,s);break;case g.ViewDetail:n=function(e,t){return{items:C(e.ProductAction.ProductList,t)}}(e,s);break;case g.AddToWishlist:n=function(e,t){return{value:e.ProductAction.TotalAmount,items:C(e.ProductAction.ProductList,t)}}(e,s);break;case g.CheckoutOption:return function(e,t){try{var r,n=e.CustomFlags,o=n[m];switch(n&&o||console.error('Your checkout option event for the Google Analytics 4 integration is missing a custom flag for "GA4.CommerceEventType". The event was sent using the deprecated set_checkout_option event.  Review mParticle docs for GA4 for the custom flags to add.'),o){case h:r=function(e,t){return{coupon:e.ProductAction&&e.ProductAction.CouponCode?e.ProductAction.CouponCode:null,shipping_tier:e.CustomFlags&&e.CustomFlags[f]?e.CustomFlags[f]:null,items:C(e.ProductAction.ProductList,t)}}(e,t);break;case y:r=function(e,t){return{coupon:e.ProductAction&&e.ProductAction.CouponCode?e.ProductAction.CouponCode:null,payment_type:e.CustomFlags&&e.CustomFlags[v]?e.CustomFlags[v]:null,items:C(e.ProductAction.ProductList,t)}}(e,t);break;default:r=function(e,t){var r=e.EventAttributes;return r.items=C(e.ProductAction.ProductList,t),r.coupon=e.ProductAction?e.ProductAction.CouponCode:null,r}(e,t)}}catch(e){return console.error("There is an issue with the custom flags in your CheckoutOption event. The event was not sent.  Plrease review the docs and fix.",e),!1}return gtag("event",w(e),r),!0}(e,s);default:if(!o)return console.error("Unsupported Commerce Event. Event not sent.",e),!1}return this.common.forwarderSettings.enableDataCleansing&&(i=this.common.standardizeParameters(i)),n=this.common.mergeObjects(n,this.common.limitEventAttributes(i)),t&&(n.currency=e.CurrencyCode),r&&(n.value=e.CustomFlags&&e.CustomFlags["GA4.Value"]||e.ProductAction.TotalAmount||null),gtag("event",w(e),n),!0};var S=l;function _(e){this.common=e||{}}_.prototype.sendEventToGA4=function(e,t){var r,n;this.common.forwarderSettings.enableDataCleansing?(r=this.common.standardizeName(e),n=this.common.standardizeParameters(t)):(r=e,n=t),n=this.common.limitEventAttributes(n),gtag("event",this.common.truncateEventName(r),this.common.truncateEventAttributes(n))},_.prototype.logEvent=function(e){this.sendEventToGA4(e.EventName,e.EventAttributes)},_.prototype.logError=function(){console.warn("Google Analytics 4 does not support error events.")},_.prototype.logPageView=function(e){var t="GA4.Title",r="GA4.Location",n="Google.Title",o="Google.Location",i=location.href,s=document.title;e.CustomFlags&&(e.CustomFlags.hasOwnProperty(t)?s=e.CustomFlags[t]:e.CustomFlags.hasOwnProperty(n)&&(s=e.CustomFlags[n]),e.CustomFlags.hasOwnProperty(r)?i=e.CustomFlags[r]:e.CustomFlags.hasOwnProperty(o)&&(i=e.CustomFlags[o]));var a=this.common.mergeObjects({page_title:s,page_location:i},e.EventAttributes);return this.sendEventToGA4("page_view",a),!0};var I=_;function A(e){this.common=e||{}}A.prototype.onUserIdentified=function(e){var t=this.common.getUserId(e,this.common.forwarderSettings.externalUserIdentityType,this.common.forwarderSettings.hashUserId);gtag("config",this.common.forwarderSettings.measurementId,{send_page_view:!1,user_id:t})},A.prototype.onIdentifyComplete=function(e,t){},A.prototype.onLoginComplete=function(e,t){},A.prototype.onLogoutComplete=function(e,t){},A.prototype.onModifyComplete=function(e,t){},A.prototype.onSetUserIdentity=function(e,t,r){};var E=A,T={name:"GoogleAnalytics4",moduleId:160,initForwarder:function(e,t,r,n,o,i,s,a){mParticle._setIntegrationDelay(this.moduleId,!0),window.GoogleAnalytics4Kit=window.GoogleAnalytics4Kit||{},a.forwarderSettings=e,a.forwarderSettings.enableDataCleansing="True"===a.forwarderSettings.enableDataCleansing;var c=e.measurementId,u=e.externalUserIdentityType,d=e.hashUserId,l={send_page_view:"True"===e.enablePageView};if(window.dataLayer=window.dataLayer||[],window.gtag=function(){window.dataLayer.push(arguments)},gtag("js",new Date),"2"===window.mParticle.getVersion().split(".")[0]){var g=a.getUserId(mParticle.Identity.getCurrentUser(),u,d);g&&(l.user_id=g)}if(gtag("config",c,l),gtag("get",c,"client_id",(function(e){!function(e,t){var r={};r.client_id=e,window.mParticle.setIntegrationAttribute(t,r),window.mParticle._setIntegrationDelay(t,!1)}(e,T.moduleId)})),t)s=!0;else{var p=document.createElement("script");p.type="text/javascript",p.async=!0,p.src="https://www.googletagmanager.com/gtag/js?id="+c,(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(p),p.onload=function(){if(s=!0,window.dataLayer&&gtag&&i.length>0){for(var e=0;e<i.length;e++)o(i[e]);i=[]}}}return s}};var k=T,D={onSessionStart:function(e){},onSessionEnd:function(e){}};function O(e){this.common=e||{}}O.prototype.sendUserPropertiesToGA4=function(e){gtag("set","user_properties",this.common.truncateUserAttributes(e))},O.prototype.onRemoveUserAttribute=function(e){var t={};t[e]=null,this.sendUserPropertiesToGA4(t)},O.prototype.onSetUserAttribute=function(e,t){var r={};r[e]=t,this.sendUserPropertiesToGA4(r)};var U=O,L=k.name,M=k.moduleId,N=1,F=2,V=3,R=4,H=5,x=16,j=20,K=function(){var e,t,r=this,n=!1,o=[];function i(e){var i=!1;if(!n)return o.push(e),"Can't send to forwarder "+L+", not initialized. Event added to queue.";try{return e.EventDataType===N?i=function(e){try{return D.onSessionStart(e),!0}catch(e){return{error:"Error starting session on forwarder "+L+"; "+e}}}(e):e.EventDataType===F?i=function(e){try{return D.onSessionEnd(e),!0}catch(e){return{error:"Error ending session on forwarder "+L+"; "+e}}}(e):e.EventDataType===H?i=function(e){try{return r.eventHandler.logError(e),!0}catch(e){return{error:"Error logging error on forwarder "+L+"; "+e}}}(e):e.EventDataType===V?i=function(e){try{return r.eventHandler.logPageView(e),!0}catch(e){return{error:"Error logging page view on forwarder "+L+"; "+e}}}(e):e.EventDataType===x?i=function(e){try{return r.commerceHandler.logCommerceEvent(e),!0}catch(e){return{error:"Error logging purchase event on forwarder "+L+"; "+e}}}(e):(e.EventDataType===R||e.EventDataType===j)&&(i=s(e)),!0===i&&t?(t(r,e),"Successfully sent to "+L):"Error logging event or event type not supported on forwarder "+L}catch(e){return"Failed to send to "+L+" "+e}}function s(e){try{return r.eventHandler.logEvent(e),!0}catch(e){return{error:"Error logging event on forwarder "+L+"; "+e}}}r.name=k.name,r.moduleId=k.moduleId,r.common=new u,this.init=function(s,a,c,u,d,l,g,p,m,f){e=s,t="undefined"!=typeof window&&window.mParticle.isTestEnvironment?function(){}:a;try{k.initForwarder(s,c,d,l,i,o,n,r.common,g,p,m,f),r.eventHandler=new I(r.common),r.identityHandler=new E(r.common),r.userAttributeHandler=new U(r.common),r.commerceHandler=new S(r.common),n=!0}catch(e){console.log("Failed to initialize "+L+" - "+e)}},this.process=i,this.setUserAttribute=function(t,o){if(!n)return"Can't set user attribute on forwarder "+L+", not initialized";try{return r.userAttributeHandler.onSetUserAttribute(t,o,e),"Successfully set user attribute on forwarder "+L}catch(e){return"Error setting user attribute on forwarder "+L+"; "+e}},this.removeUserAttribute=function(t){if(!n)return"Can't remove user attribute on forwarder "+L+", not initialized";try{return r.userAttributeHandler.onRemoveUserAttribute(t,e),"Successfully removed user attribute on forwarder "+L}catch(e){return"Error removing user attribute on forwarder "+L+"; "+e}},this.onUserIdentified=function(e){if(!n)return"Can't set new user identities on forwader  "+L+", not initialized";try{return r.identityHandler.onUserIdentified(e),"Successfully called onUserIdentified on forwarder "+L}catch(e){return{error:"Error calling onUserIdentified on forwarder "+L+"; "+e}}},this.setUserIdentity=function(t,o){if(!n)return"Can't call setUserIdentity on forwarder "+L+", not initialized";try{return r.identityHandler.onSetUserIdentity(e,t,o),"Successfully set user Identity on forwarder "+L}catch(e){return"Error removing user attribute on forwarder "+L+"; "+e}},this.onIdentifyComplete=function(e,t){if(!n)return"Can't call onIdentifyCompleted on forwader  "+L+", not initialized";try{return r.identityHandler.onIdentifyComplete(e,t),"Successfully called onIdentifyComplete on forwarder "+L}catch(e){return{error:"Error calling onIdentifyComplete on forwarder "+L+"; "+e}}},this.onLoginComplete=function(e,t){if(!n)return"Can't call onLoginComplete on forwader  "+L+", not initialized";try{return r.identityHandler.onLoginComplete(e,t),"Successfully called onLoginComplete on forwarder "+L}catch(e){return{error:"Error calling onLoginComplete on forwarder "+L+"; "+e}}},this.onLogoutComplete=function(e,t){if(!n)return"Can't call onLogoutComplete on forwader  "+L+", not initialized";try{return r.identityHandler.onLogoutComplete(e,t),"Successfully called onLogoutComplete on forwarder "+L}catch(e){return{error:"Error calling onLogoutComplete on forwarder "+L+"; "+e}}},this.onModifyComplete=function(e,t){if(!n)return"Can't call onModifyComplete on forwader  "+L+", not initialized";try{return r.identityHandler.onModifyComplete(e,t),"Successfully called onModifyComplete on forwarder "+L}catch(e){return{error:"Error calling onModifyComplete on forwarder "+L+"; "+e}}},this.setOptOut=function(e){if(!n)return"Can't call setOptOut on forwader  "+L+", not initialized";try{return r.initialization.setOptOut(e),"Successfully called setOptOut on forwarder "+L}catch(e){return{error:"Error calling setOptOut on forwarder "+L+"; "+e}}}};function q(e){return null!=e&&"object"==typeof e&&!1===Array.isArray(e)}"undefined"!=typeof window&&window&&window.mParticle&&window.mParticle.addForwarder&&window.mParticle.addForwarder({name:L,constructor:K,getId:function(){return M}});var B={register:function(e){e?q(e)?(q(e.kits)||(e.kits={}),e.kits[L]={constructor:K},console.log("Successfully registered "+L+" to your mParticle configuration")):console.log("'config' must be an object. You passed in a "+typeof e):console.log("You must pass a config object to register the kit "+L)}},z=B.register;t.ZP=B},943:(e,t)=>{var r="GoogleAnalyticsEventForwarder",n=3,o=4,i=16,s=1,a="None",c="Google.NonInteraction",u="Google.Category",d="Google.Label",l="Google.Title",g="Google.Page",p="Google.Location",m="Google.Hostname",f="Google.Value",v="Google.UserTiming",h="Google.HitType",y="Google.Action",P="Google.CG1",b="Google.CG2",C="Google.CG3",w="Google.CG4",S="Google.CG5",_=function(){var e,t,_=this,I=!1,A=!1,E=null,T={customDimensions:{},customMetrics:{}},k={customDimensions:{},customMetrics:{}},D={customDimensions:{},customMetrics:{}};function O(e){return E+"."+e}function U(e){return mParticle.EventType.getName(e)}function L(e,t,r){for(var n in r.customDimensions)for(var o in e)n===o&&r.customDimensions[n].forEach((function(r){t[r]||(t[r]=e[o])}));for(var i in r.customMetrics)for(var s in e)i===s&&r.customMetrics[i].forEach((function(r){t[r]||(t[r]=e[s])}))}function M(t){if(t){var n,o,i=t.getUserIdentities().userIdentities;if(I){if(e.externalUserIdentityType!==a)switch(e.externalUserIdentityType){case"CustomerId":n=i.customerid;break;case"Other":n=i.other;break;case"Other2":n=i.other2;break;case"Other3":n=i.other3;break;case"Other4":n=i.other4;break;case"Other5":n=i.other5;break;case"Other6":n=i.other6;break;case"Other7":n=i.other7;break;case"Other8":n=i.other8;break;case"Other9":n=i.other9;break;case"Other10":n=i.other10;break;default:console.warn("External identity type not found for setting identity on "+r+". User not set. Please double check your implementation.")}n?("True"==e.hashUserId&&(o=n,n=window.mParticle.generateHash(o)),"True"!==e.classicMode&&ga(O("set"),"userId",n)):console.warn("External identity type of "+e.externalUserIdentityType+" not set on the user")}}}function N(e,t){var r={id:e.Sku,name:e.Name,category:e.Category,brand:e.Brand,variant:e.Variant,price:e.Price,coupon:e.CouponCode,quantity:e.Quantity};for(var n in t)t.hasOwnProperty(n)&&(r[n]=t[n]);ga(O("ec:addProduct"),r)}function F(e,t,r){ga(O("send"),r&&r[h]?r[h]:"event","eCommerce",U(e),t)}function V(e,t){if(e.CustomFlags&&e.CustomFlags[v]&&"number"==typeof e.CustomFlags[v]){var r={hitType:"timing",timingVar:e.EventName,timingValue:e.CustomFlags[v],timingCategory:e.CustomFlags[u]||U(e.EventCategory),timingLabel:e.CustomFlags[d]||null};for(var n in t)t.hasOwnProperty(n)&&(r[n]=t[n]);ga(O("send"),r)}}function R(e,t){if(e){var r=e["Google.CGNumber"],n=e["Google.CGValue"];r&&n&&(console.warn("Setting `Google.CGNumber` and `Google.CGValue` is being deprecated on 3/1/2021.  Please set content groups for each event via the custom Flag `Google.CG#`. See https://docs.mparticle.com/integrations/google-analytics/event/"),ga(O("set"),"contentGroup".concat(r),n)),t&&(e.hasOwnProperty(P)&&(t.contentGroup1=e[P]),e.hasOwnProperty(b)&&(t.contentGroup2=e[b]),e.hasOwnProperty(C)&&(t.contentGroup3=e[C]),e.hasOwnProperty(w)&&(t.contentGroup4=e[w]),e.hasOwnProperty(S)&&(t.contentGroup5=e[S]))}}function H(e,t,r){var n=r.value.replace(/ /g,"").toLowerCase();e[t][r.map]?!e[t][r.map].indexOf(r.value)>=0&&e[t][r.map].push(n):e[t][r.map]=[n]}_.name=r,this.init=function(n,o,i,a,c,u,d,l,g){try{if(t=o,E=a||"mpgaTracker"+s++,"True"==(e=n).classicMode)window._gaq=window._gaq||[],!0!==i&&(window._gaq.push(["_setAccount",e.apiKey]),"True"==e.useLocalhostCookie&&window._gaq.push(["_setDomainName","none"]),function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,"True"==e.useDisplayFeatures?t.src=("https:"==document.location.protocol?"https://":"http://")+"stats.g.doubleclick.net/dc.js":t.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(t,r)}());else{!0!==i&&(m=window,f=document,v="script",h="ga",m.GoogleAnalyticsObject=h,m[h]=m[h]||function(){(m[h].q=m[h].q||[]).push(arguments)},m[h].l=1*new Date,y=f.createElement(v),P=f.getElementsByTagName(v)[0],y.async=1,y.src="//www.google-analytics.com/analytics.js",P.parentNode.insertBefore(y,P));var p={trackingId:e.apiKey,name:E};if("True"==e.useLocalhostCookie&&(p.cookieDomain="none"),"AMP"===e.clientIdentificationType&&(p.useAmpClientId=!0),ga("create",p),R(g,p),"True"==e.useDisplayFeatures&&ga(O("require"),"displayfeatures"),"True"==e.useSecure&&ga(O("set"),"forceSSL",!0),e.customDimensions)JSON.parse(e.customDimensions.replace(/&quot;/g,'"')).forEach((function(e){"EventAttributeClass.Name"===e.maptype?H(T,"customDimensions",e):"UserAttributeClass.Name"===e.maptype?H(k,"customDimensions",e):"ProductAttributeSelector.Name"===e.maptype&&H(D,"customDimensions",e)}));if(e.customMetrics)JSON.parse(e.customMetrics.replace(/&quot;/g,'"')).forEach((function(e){"EventAttributeClass.Name"===e.maptype?H(T,"customMetrics",e):"UserAttributeClass.Name"===e.maptype?H(k,"customMetrics",e):"ProductAttributeSelector.Name"===e.maptype&&H(D,"customMetrics",e)}))}return I=!0,"2"===window.mParticle.getVersion().split(".")[0]&&M(mParticle.Identity.getCurrentUser()),"Successfully initialized: "+r}catch(e){return"Failed to initialize: "+r}var m,f,v,h,y,P},this.process=function(s){var a={},v=!1;if(I){s.ExpandedEventCount=0,function(e,t){e.EventAttributes&&Object.keys(e.EventAttributes).length&&L(e.EventAttributes,t,T),e.UserAttributes&&Object.keys(e.UserAttributes).length&&L(e.UserAttributes,t,k)}(s,a),s.CustomFlags&&Object.keys(s.CustomFlags).length&&(!function(e,t){e.hasOwnProperty(c)&&(t.nonInteraction=e[c])}(s.CustomFlags,a),R(s.CustomFlags,a));try{return s.EventDataType==n?(!function(t,r,n){"True"==e.classicMode?_gaq.push(["_trackPageview"]):(t.CustomFlags&&(t.CustomFlags[g]&&ga(O("set"),"page",t.CustomFlags[g]),t.CustomFlags[m]&&ga(O("set"),"hostname",t.CustomFlags[m]),t.CustomFlags[p]&&ga(O("set"),"location",t.CustomFlags[p]),t.CustomFlags[l]&&ga(O("set"),"title",t.CustomFlags[l])),ga(O("send"),n&&n[h]?n[h]:"pageview",r),V(t,r))}(s,a,s.CustomFlags),v=!0):s.EventDataType==i?(!function(e,t,r){A||(ga(O("require"),"ec"),A=!0);e.CurrencyCode&&ga(O("set"),"&cu",e.CurrencyCode);if(e.ProductImpressions)e.ProductImpressions.forEach((function(e){var t=e.ProductImpressionList;e.ProductList.forEach((function(e){var r={};L(e.Attributes,r,D),function(e,t,r){var n={id:e.Sku,name:e.Name,category:e.Category,brand:e.Brand,variant:e.Variant,price:e.Price,coupon:e.CouponCode,quantity:e.Quantity,list:t,type:"view"};for(var o in r)r.hasOwnProperty(o)&&(n[o]=r[o]);ga(O("ec:addImpression"),n)}(e,t,r)}))})),F(e.EventCategory,t,r);else if(e.PromotionAction)e.PromotionAction.PromotionList.forEach((function(e){ga(O("ec:addPromo"),{id:e.Id,name:e.Name,creative:e.Creative,position:e.Position})})),e.PromotionAction.PromotionActionType==mParticle.PromotionType.PromotionClick&&ga(O("ec:setAction"),"promo_click"),F(e.EventCategory,t,r);else if(e.ProductAction){if(e.ProductAction.ProductActionType==mParticle.ProductActionType.Purchase)e.ProductAction.ProductList.forEach((function(e){var t={};L(e.Attributes,t,D),N(e,t)})),ga(O("ec:setAction"),"purchase",{id:e.ProductAction.TransactionId,affiliation:e.ProductAction.Affiliation,revenue:e.ProductAction.TotalAmount,tax:e.ProductAction.TaxAmount,shipping:e.ProductAction.ShippingAmount,coupon:e.ProductAction.CouponCode}),F(e.EventCategory,t,r);else if(e.ProductAction.ProductActionType==mParticle.ProductActionType.Refund)e.ProductAction.ProductList.length&&e.ProductAction.ProductList.forEach((function(e){var t={id:e.Sku,quantity:e.Quantity};L(e.Attributes,t,D),ga(O("ec:addProduct"),t)})),ga(O("ec:setAction"),"refund",{id:e.ProductAction.TransactionId}),F(e.EventCategory,t,r);else if(e.ProductAction.ProductActionType==mParticle.ProductActionType.AddToCart||e.ProductAction.ProductActionType==mParticle.ProductActionType.RemoveFromCart){var n={};e.ProductAction.ProductList.forEach((function(e){L(e.Attributes,n,D),N(e,n)})),ga(O("ec:setAction"),e.ProductAction.ProductActionType==mParticle.ProductActionType.AddToCart?"add":"remove"),F(e.EventCategory,t,r)}else e.ProductAction.ProductActionType==mParticle.ProductActionType.Checkout||e.ProductAction.ProductActionType==mParticle.ProductActionType.CheckoutOption?(e.ProductAction.ProductList.forEach((function(e){var t={};L(e.Attributes,t,D),N(e,t)})),ga(O("ec:setAction"),e.ProductAction.ProductActionType==mParticle.ProductActionType.Checkout?"checkout":"checkout_option",{step:e.ProductAction.CheckoutStep||e.EventAttributes.step||null,option:e.ProductAction.CheckoutOptions||e.EventAttributes.option||null}),F(e.EventCategory,t,r)):e.ProductAction.ProductActionType==mParticle.ProductActionType.Click?(e.ProductAction.ProductList.forEach((function(e){var t={};L(e.Attributes,t,D),N(e,t)})),ga(O("ec:setAction"),"click"),F(e.EventCategory,t,r)):e.ProductAction.ProductActionType==mParticle.ProductActionType.ViewDetail&&(e.ProductAction.ProductList.forEach((function(e){var t={};L(e.Attributes,t,D),N(e)})),ga(O("ec:setAction"),"detail"),ga(O("send"),r&&r[h]?r[h]:"event","eCommerce",U(e.EventCategory),t));V(e,t)}}(s,a,s.CustomFlags),v=!0):s.EventDataType==o&&(v=!0,function(t,r,n){var o,i,s="",a=U(t.EventCategory);t.EventAttributes&&(t.EventAttributes.label&&(s=t.EventAttributes.label),t.EventAttributes.value&&(o=parseInt(t.EventAttributes.value,10))!=o&&(o=null),t.EventAttributes.category&&(a=t.EventAttributes.category));if(t.CustomFlags){var c=t.CustomFlags[u],l=t.CustomFlags[d],g=parseInt(t.CustomFlags[f],10),p=t.CustomFlags[y];c&&(a=c),l&&(s=l),g==g&&(o=g),p&&"string"==typeof p&&(i=p)}"True"==e.classicMode?_gaq.push(["_trackEvent",a,i||t.EventName,s,o]):(ga(O("send"),n&&n[h]?n[h]:"event",a,i||t.EventName,s,o,r),V(t,r))}(s,a,s.CustomFlags)),v&&t&&t(_,s),"Successfully sent to "+r}catch(e){return"Failed to send to: "+r+" "+e}}return"Can't send to forwarder "+r+", not initialized"},this.setUserIdentity=function(t,n){if("1"===window.mParticle.getVersion().split(".")[0]){if(!I)return"Can't call setUserIdentity on forwarder "+r+", not initialized";"True"==e.hashUserId&&n==window.mParticle.IdentityType.CustomerId&&("True"==e.classicMode||ga(O("set"),"userId",window.mParticle.generateHash(t)))}},this.onUserIdentified=M};function I(e){return null!=e&&"object"==typeof e&&!1===Array.isArray(e)}"undefined"!=typeof window&&window&&window.mParticle&&window.mParticle.addForwarder&&window.mParticle.addForwarder({name:r,constructor:_,getId:function(){return 6}});var A={register:function(e){e?I(e)?(I(e.kits)||(e.kits={}),e.kits[r]={constructor:_},console.log("Successfully registered "+r+" to your mParticle configuration")):console.log("'config' must be an object. You passed in a "+typeof e):console.log("You must pass a config object to register the kit "+r)},getVersion:function(){return"2.1.13"}},E=A.register,T=A.getVersion;t.ZP=A},963:(e,t)=>{"use strict";function r(){this.customDataLayerName=null}r.prototype.buildMPID=function(e,t){var r="";return e&&e.hasOwnProperty("MPID")?r=e.MPID:t&&t.hasOwnProperty("getMPID")&&(r=t.getMPID()),r},r.prototype.buildUserAttributes=function(e,t){var r={};return e&&e.hasOwnProperty("UserAttributes")?r=e.UserAttributes:t&&t.hasOwnProperty("getAllUserAttributes")&&(r=t.getAllUserAttributes()),r},r.prototype.buildUserIdentities=function(e,t){var r={};return e.hasOwnProperty("UserIdentities")?e.UserIdentities.forEach((function(e){var t=mParticle.IdentityType.getIdentityName(e.Type);r[t]=e.Identity})):t.hasOwnProperty("getUserIdentities")&&t.getUserIdentities().userIdentities&&(r=t.getUserIdentities().userIdentities),r},r.prototype.buildConsentObject=function(e){var t={},r=e.ConsentState||mParticle.Identity.getCurrentUser().getConsentState();return r&&r.getGDPRConsentState&&r.getGDPRConsentState()&&(t=r.getGDPRConsentState()),{gdpr:t}},r.prototype.send=function(e){var t,r={},n=e||{},o=n.event||{},i=n.user||{},s=o.EventName||"Custom Event",a={mpid:this.buildMPID(o,i),consent_state:this.buildConsentObject(o),attributes:this.buildUserAttributes(o,i),identities:this.buildUserIdentities(o,i)},c={name:s,type:n.eventType||"custom_event",attributes:o.EventAttributes||{}};if(r.event=s,t={device_application_stamp:o.DeviceId||mParticle.getDeviceId()||"",user:a,event:c},r.mp_data=t,n.eventPayload)for(var u in n.eventPayload)n.eventPayload.hasOwnProperty(u)&&(r[u]=n.eventPayload[u]);window[this.customDataLayerName].push(r)};var n=r,o=10,i=14,s=12,a=13,c=22,u=16,d=17,l=11,g=15,p=19,m=18;function f(e){this.common=e||{}}function v(e){return e.split(/(?=[A-Z])/).join("_").toLowerCase()}function h(e){var t=[];return e.forEach((function(e){t.push(function(e){var t={};for(var r in e)"Sku"===r?t.id=e.Sku:t[v(r)]=e[r];return t}(e))})),t}function y(e){var t=[];return e.forEach((function(e){t.push(function(e){var t={};for(var r in e)t[v(r)]=e[r];return t}(e))})),t}f.prototype.buildAddToCart=function(e){return{event:e,eventType:"commerce_event",eventPayload:{ecommerce:{currencyCode:e.CurrencyCode||"USD",add:{products:h(e.ProductAction.ProductList)}}}}},f.prototype.buildCheckout=function(e){return{event:e,eventType:"commerce_event",eventPayload:{ecommerce:{checkout:{actionField:{step:e.ProductAction.CheckoutStep,option:e.ProductAction.CheckoutOptions},products:h(e.ProductAction.ProductList)}}}}},f.prototype.buildCheckoutOption=function(e){return{event:e,eventType:"commerce_event",eventPayload:{ecommerce:{checkout_option:{actionField:{step:e.ProductAction.CheckoutStep,option:e.ProductAction.CheckoutOptions},products:h(e.ProductAction.ProductList)}}}}},f.prototype.buildRemoveFromCart=function(e){return{event:e,eventType:"commerce_event",eventPayload:{ecommerce:{currencyCode:e.CurrencyCode||"USD",remove:{products:h(e.ProductAction.ProductList)}}}}},f.prototype.buildImpression=function(e,t){return{event:e,eventType:"commerce_event",eventPayload:{ecommerce:{currencyCode:e.CurrencyCode||"USD",impressions:h(t.ProductList)}}}},f.prototype.buildProductClick=function(e){var t={};return e.EventAttributes&&e.EventAttributes.hasOwnProperty("list")&&(t.list=e.EventAttributes.list),{event:e,eventType:"commerce_event",eventPayload:{ecommerce:{click:{actionField:t,products:h(e.ProductAction.ProductList)}}}}},f.prototype.buildProductViewDetail=function(e){var t={};return e.EventAttributes&&e.EventAttributes.hasOwnProperty("list")&&(t.list=e.EventAttributes.list),{event:e,eventType:"commerce_event",eventPayload:{ecommerce:{detail:{actionField:t,products:h(e.ProductAction.ProductList)}}}}},f.prototype.buildPromoClick=function(e){return{event:e,eventType:"commerce_event",eventPayload:{ecommerce:{promoClick:{promotions:y(e.PromotionAction.PromotionList)}}}}},f.prototype.buildPromoView=function(e){return{event:e,eventType:"commerce_event",eventPayload:{ecommerce:{promoView:{promotions:y(e.PromotionAction.PromotionList)}}}}},f.prototype.buildPurchase=function(e){var t=e.ProductAction;return{event:e,eventType:"commerce_event",eventPayload:{ecommerce:{purchase:{actionField:{id:t.TransactionId||"",affiliation:t.Affiliation||"",revenue:t.TotalAmount||"",tax:t.TaxAmount||"",shipping:t.ShippingAmount||"",coupon:t.CouponCode||""},products:h(t.ProductList)}}}}},f.prototype.buildRefund=function(e){return{event:e,eventType:"commerce_event",eventPayload:{ecommerce:{refund:{actionField:{id:e.ProductAction.TransactionId||""},products:h(e.ProductAction.ProductList)}}}}},f.prototype.logCommerceEvent=function(e){var t=this;switch(e.EventCategory){case o:e=t.buildAddToCart(e);break;case s:e=t.buildCheckout(e);break;case a:e=t.buildCheckoutOption(e);break;case i:e=t.buildProductClick(e);break;case c:try{e.ProductImpressions.forEach((function(r){var n=t.buildImpression(e,r);t.common.send(n)}))}catch(e){return console.log("error logging impressions",e),!1}return!0;case u:e=t.buildPurchase(e);break;case d:e=t.buildRefund(e);break;case l:e=t.buildRemoveFromCart(e);break;case g:e=t.buildProductViewDetail(e);break;case p:e=t.buildPromoClick(e);break;case m:e=t.buildPromoView(e);break;default:return console.error("Unknown Commerce Type",e),!1}return t.common.send(e),!0};var P=f;function b(e){this.common=e||{}}b.prototype.logEvent=function(e){return this.common.send({event:e}),!0},b.prototype.logError=function(){},b.prototype.logPageView=function(e){return this.common.send({event:e,eventType:"screen_view"}),!0};var C=b;function w(e){this.common=e||{}}w.prototype.onUserIdentified=function(e){this.common.send({event:{EventName:"User Identified"},user:e})},w.prototype.onIdentifyComplete=function(e,t){this.common.send({event:{EventName:"Identify Complete"},user:e})},w.prototype.onLoginComplete=function(e,t){this.common.send({event:{EventName:"Login Complete"},user:e})},w.prototype.onLogoutComplete=function(e,t){this.common.send({event:{EventName:"Logout Complete"},user:e})},w.prototype.onModifyComplete=function(e,t){this.common.send({event:{EventName:"Modify Complete"},user:e})},w.prototype.onSetUserIdentity=function(e,t,r){};var S=w,_={name:"GoogleTagManager",moduleId:140,initForwarder:function(e,t,r,n,o,i,s,a){var c=function(e){var t=e||"";return t.trim().match(/^[a-zA-Z0-9-_]+$/)?t.trim():""}(e.containerId);if(!c)return console.error("Container ID is not valid and is required for Google Tag Manager Integration"),!1,!1;var u="True"===e.includeContainer,d=function(e){var t=e||"";return t.trim().match(/^[a-zA-Z0-9-_]+$/)?t.trim():""}(e.dataLayerName);if(!d)return console.error("DataLayer Name is not valid. Please check that you have entered it correctly."),!1,!1;var l=function(e){var t=e||"",r=/^(?:http(s)?:\/\/)?[\w.-]+(?:\.[\w\.-]+)+[\w\-\._~:/?#[\]@!\$&'\(\)\*\+,;=.]+$/gm;return t.trim().match(r)?t.trim():""}(e.previewUrl);!l&&e.previewUrl&&console.warn("Invalid previewUrl detected. Please check that you have entered it correctly."),a.customDataLayerName=d,window[a.customDataLayerName]=window[a.customDataLayerName]||[],t||!u||function(e,t,r){var n="https://www.googletagmanager.com/gtm.js",o=function(e){var t=e||"",r={},n=t.split("?");if(!n[1]||n.length>2)return{};return n[1].split("&").forEach((function(e){var t=e.split("=");r[t[0]]=t[1]})),r}(r);r&&o.id===e?n+="?"+function(e){var t=e||"";return t.split("?")[1]}(r)+"&l="+t:n+="?id="+e;n+="&l="+t,function(e,t){window[t].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var r=document.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(r)}(n,t)}(c,a.customDataLayerName,l)}};var I=_,A={onSessionStart:function(e){},onSessionEnd:function(e){}};function E(e){this.common={}}E.prototype.onRemoveUserAttribute=function(e,t){this.common.send({event:{EventName:"Remove User Attribute"},options:{key:e}})},E.prototype.onSetUserAttribute=function(e,t,r){this.common.send({event:{EventName:"Set User Attribute"},options:{key:e,value:t}})},E.prototype.onConsentStateUpdated=function(e,t,r){this.common.send({event:{EventName:"Consent State Update"},options:{old_state:e,new_state:t}})};var T=E,k=I.name,D=I.moduleId,O=1,U=2,L=3,M=4,N=5,F=16,V=20,R=function(){var e,t,r=this,o=!1,i=[];function s(e){var n=!1;if(!o)return i.push(e),"Can't send to forwarder "+k+", not initialized. Event added to queue.";try{return e.EventDataType===O?n=function(e){try{return A.onSessionStart(e),!0}catch(e){return{error:"Error starting session on forwarder "+k+"; "+e}}}(e):e.EventDataType===U?n=function(e){try{return A.onSessionEnd(e),!0}catch(e){return{error:"Error ending session on forwarder "+k+"; "+e}}}(e):e.EventDataType===N?n=function(e){try{return r.eventHandler.logError(e),!0}catch(e){return{error:"Error logging error on forwarder "+k+"; "+e}}}(e):e.EventDataType===L?n=function(e){try{return r.eventHandler.logPageView(e),!0}catch(e){return{error:"Error logging page view on forwarder "+k+"; "+e}}}(e):e.EventDataType===F?n=function(e){try{return r.commerceHandler.logCommerceEvent(e),!0}catch(e){return{error:"Error logging purchase event on forwarder "+k+"; "+e}}}(e):(e.EventDataType===M||e.EventDataType===V)&&(n=a(e)),!0===n&&t?(t(r,e),"Successfully sent to "+k):"Error logging event or event type not supported on forwarder "+k}catch(e){return"Failed to send to "+k+" "+e}}function a(e){try{return r.eventHandler.logEvent(e),!0}catch(e){return{error:"Error logging event on forwarder "+k+"; "+e}}}r.name=I.name,r.moduleId=I.moduleId,r.common=new n,this.init=function(n,a,c,u,d,l,g,p,m,f){e=n,t="undefined"!=typeof window&&window.mParticle.isTestEnvironment?function(){}:a;try{I.initForwarder(n,c,d,l,s,i,o,r.common,g,p,m,f),r.eventHandler=new C(r.common),r.identityHandler=new S(r.common),r.userAttributeHandler=new T(r.common),r.commerceHandler=new P(r.common),o=!0}catch(e){console.log("Failed to initialize "+k+" - "+e)}},this.process=s,this.setUserAttribute=function(t,n){if(!o)return"Can't set user attribute on forwarder "+k+", not initialized";try{return r.userAttributeHandler.onSetUserAttribute(t,n,e),"Successfully set user attribute on forwarder "+k}catch(e){return"Error setting user attribute on forwarder "+k+"; "+e}},this.removeUserAttribute=function(t){if(!o)return"Can't remove user attribute on forwarder "+k+", not initialized";try{return r.userAttributeHandler.onRemoveUserAttribute(t,e),"Successfully removed user attribute on forwarder "+k}catch(e){return"Error removing user attribute on forwarder "+k+"; "+e}},this.onUserIdentified=function(e){if(!o)return"Can't set new user identities on forwader  "+k+", not initialized";try{return r.identityHandler.onUserIdentified(e),"Successfully called onUserIdentified on forwarder "+k}catch(e){return{error:"Error calling onUserIdentified on forwarder "+k+"; "+e}}},this.setUserIdentity=function(t,n){if(!o)return"Can't call setUserIdentity on forwarder "+k+", not initialized";try{return r.identityHandler.onSetUserIdentity(e,t,n),"Successfully set user Identity on forwarder "+k}catch(e){return"Error removing user attribute on forwarder "+k+"; "+e}},this.onIdentifyComplete=function(e,t){if(!o)return"Can't call onIdentifyCompleted on forwader  "+k+", not initialized";try{return r.identityHandler.onIdentifyComplete(e,t),"Successfully called onIdentifyComplete on forwarder "+k}catch(e){return{error:"Error calling onIdentifyComplete on forwarder "+k+"; "+e}}},this.onLoginComplete=function(e,t){if(!o)return"Can't call onLoginComplete on forwader  "+k+", not initialized";try{return r.identityHandler.onLoginComplete(e,t),"Successfully called onLoginComplete on forwarder "+k}catch(e){return{error:"Error calling onLoginComplete on forwarder "+k+"; "+e}}},this.onLogoutComplete=function(e,t){if(!o)return"Can't call onLogoutComplete on forwader  "+k+", not initialized";try{return r.identityHandler.onLogoutComplete(e,t),"Successfully called onLogoutComplete on forwarder "+k}catch(e){return{error:"Error calling onLogoutComplete on forwarder "+k+"; "+e}}},this.onModifyComplete=function(e,t){if(!o)return"Can't call onModifyComplete on forwader  "+k+", not initialized";try{return r.identityHandler.onModifyComplete(e,t),"Successfully called onModifyComplete on forwarder "+k}catch(e){return{error:"Error calling onModifyComplete on forwarder "+k+"; "+e}}},this.setOptOut=function(e){if(!o)return"Can't call setOptOut on forwader  "+k+", not initialized";try{return r.initialization.setOptOut(e),"Successfully called setOptOut on forwarder "+k}catch(e){return{error:"Error calling setOptOut on forwarder "+k+"; "+e}}}};function H(e){return null!=e&&"object"==typeof e&&!1===Array.isArray(e)}"undefined"!=typeof window&&window&&window.mParticle&&window.mParticle.addForwarder&&window.mParticle.addForwarder({name:k,constructor:R,getId:function(){return D}});var x={register:function(e){e?H(e)?(H(e.kits)||(e.kits={}),e.kits[k]={constructor:R},console.log("Successfully registered "+k+" to your mParticle configuration")):console.log("'config' must be an object. You passed in a "+typeof e):console.log("You must pass a config object to register the kit "+k)}},j=x.register;t.ZP=x},438:(e,t)=>{var r="gdpr",n="ccpa";var o={initialization:{name:"OneTrust",moduleId:134,consentMapping:{},googleVendorConsentMapping:{},iabVendorConsentMapping:{},generalVendorConsentMapping:{},getConsentGroupIds:function(){return window.OnetrustActiveGroups?window.OnetrustActiveGroups.split(","):[]},parseConsentMapping:function(e){var t={};e&&JSON.parse(e.replace(/&quot;/g,'"')).forEach((function(e){var o=e.map;t[e.value]={purpose:o,regulation:"data_sale_opt_out"===o?n:r}}));return t},initForwarder:function(e){var t=this;t.consentMapping=t.parseConsentMapping(e.consentGroups),t.googleVendorConsentMapping=t.parseConsentMapping(e.vendorGoogleConsentGroups),t.iabVendorConsentMapping=t.parseConsentMapping(e.vendorIABConsentGroups),t.generalVendorConsentMapping=t.parseConsentMapping(e.vendorGeneralConsentGroups);var r=window.OptanonWrapper;window.OptanonWrapper=function(){window.Optanon&&window.Optanon.OnConsentChanged&&window.Optanon.OnConsentChanged((function(){t.createConsentEvents(),t.createVendorConsentEvents()})),r()}},createConsentEvents:function(){if(window.Optanon){var e,t,o=window.location.href,i=mParticle.Identity.getCurrentUser();if(i){for(var s in(t=i.getConsentState())||(t=mParticle.Consent.createConsentState()),this.consentMapping){var a,c=this.consentMapping[s].purpose,u=this.consentMapping[s].regulation;switch(s.indexOf("group")>=0&&(s=s.replace(/\D/g,"")),a=this.getConsentGroupIds().indexOf(s)>-1,u){case n:e=mParticle.Consent.createCCPAConsent(a,Date.now(),c,o),t.setCCPAConsentState(e);break;case r:e=mParticle.Consent.createGDPRConsent(a,Date.now(),c,o),t.addGDPRConsentState(c,e);break;default:console.error("Unknown Consent Regulation",u)}}i.setConsentState(t)}}},createVendorConsentEvents:function(){var e=this;if(window.OneTrust&&window.OneTrust.getVendorConsentsRequestV2){var t,r=window.location.href,n=mParticle.Identity.getCurrentUser();n&&((t=n.getConsentState())||(t=mParticle.Consent.createConsentState()),OneTrust.getVendorConsentsRequestV2((function(n){!function(e,t,r,n){try{var o=e?e.addtlConsent.slice().split("~")[1].split("."):null;if(o&&o.length)for(var i in t){var s=t[i].purpose,a=o.indexOf(i)>-1,c=mParticle.Consent.createGDPRConsent(a,Date.now(),s,n);r.addGDPRConsentState(s,c)}}catch(e){console.error("There was a problem setting Google Vendor Consents: ",e)}}(n,e.googleVendorConsentMapping,t,r),function(e,t,r,n){try{var o=e?e.vendor.consents:null;for(var i in t){var s=t[i].purpose,a="1"===o[parseInt(i)-1],c=mParticle.Consent.createGDPRConsent(a,Date.now(),s,n);r.addGDPRConsentState(s,c)}}catch(e){console.error("There was a problem setting IAB Vendor Consents: ",e)}}(n,e.iabVendorConsentMapping,t,r),function(e,t,r,n){try{if(window.Optanon)for(var o in t){var i=t[o].purpose,s=e.indexOf(o)>-1,a=mParticle.Consent.createGDPRConsent(s,Date.now(),i,n);r.addGDPRConsentState(i,a)}}catch(e){console.error("There was a problem setting General Vendor Consents: ",e)}}(e.getConsentGroupIds(),e.generalVendorConsentMapping,t,r)})),n.setConsentState(t))}}}}.initialization,i=o.name,s=o.moduleId,a=function(){var e,t=!1;this.name=o.name,this.init=function(r){if(e=r,!t){try{o.initForwarder(e,t),t=!0}catch(e){console.log("Failed to initialize "+i+" - "+e)}o.createConsentEvents(),o.createVendorConsentEvents()}},this.onUserIdentified=function(){if(!t)return"Can't set new user identities on forwader "+i+", not initialized";try{o.createConsentEvents(),o.createVendorConsentEvents()}catch(e){return{error:"Error setting user identity on forwarder "+i+"; "+e}}},this.process=function(){}};function c(e){return null!=e&&"object"==typeof e&&!1===Array.isArray(e)}"undefined"!=typeof window&&window&&window.mParticle&&window.mParticle.addForwarder&&window.mParticle.addForwarder({name:i,constructor:a,getId:function(){return s}});var u={register:function(e){e?c(e)?(c(e.kits)||(e.kits={}),e.kits[i]={constructor:a},console.log("Successfully registered "+i+" to your mParticle configuration")):console.log("'config' must be an object. You passed in a "+typeof e):console.log("You must pass a config object to register the kit "+i)}},d=u.register;t.ZP=u}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,r),i.exports}r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{"use strict";"undefined"!=typeof globalThis&&(globalThis.regeneratorRuntime=void 0);var e={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){try{if(window.btoa&&window.atob)return window.btoa(unescape(encodeURIComponent(e)))}catch(e){console.error("Error encoding cookie values into Base64:"+e)}return this._encode(e)},_encode:function(r){var n,o,i,s,a,c,u,d="",l=0;for(r=t.encode(r);l<r.length;)s=(n=r.charCodeAt(l++))>>2,a=(3&n)<<4|(o=r.charCodeAt(l++))>>4,c=(15&o)<<2|(i=r.charCodeAt(l++))>>6,u=63&i,isNaN(o)?c=u=64:isNaN(i)&&(u=64),d=d+e._keyStr.charAt(s)+e._keyStr.charAt(a)+e._keyStr.charAt(c)+e._keyStr.charAt(u);return d},decode:function(t){try{if(window.btoa&&window.atob)return decodeURIComponent(escape(window.atob(t)))}catch(t){}return e._decode(t)},_decode:function(r){var n,o,i,s,a,c,u="",d=0;for(r=r.replace(/[^A-Za-z0-9\+\/\=]/g,"");d<r.length;)n=e._keyStr.indexOf(r.charAt(d++))<<2|(s=e._keyStr.indexOf(r.charAt(d++)))>>4,o=(15&s)<<4|(a=e._keyStr.indexOf(r.charAt(d++)))>>2,i=(3&a)<<6|(c=e._keyStr.indexOf(r.charAt(d++))),u+=String.fromCharCode(n),64!==a&&(u+=String.fromCharCode(o)),64!==c&&(u+=String.fromCharCode(i));return u=t.decode(u)}},t={encode:function(e){for(var t,r="",n=0;n<e.length;n++)128>(t=e.charCodeAt(n))?r+=String.fromCharCode(t):127<t&&2048>t?(r+=String.fromCharCode(192|t>>6),r+=String.fromCharCode(128|63&t)):(r+=String.fromCharCode(224|t>>12),r+=String.fromCharCode(128|63&t>>6),r+=String.fromCharCode(128|63&t));return r},decode:function(e){for(var t="",r=0,n=0,o=0,i=0;r<e.length;)128>(n=e.charCodeAt(r))?(t+=String.fromCharCode(n),r++):191<n&&224>n?(o=e.charCodeAt(r+1),t+=String.fromCharCode((31&n)<<6|63&o),r+=2):(o=e.charCodeAt(r+1),i=e.charCodeAt(r+2),t+=String.fromCharCode((15&n)<<12|(63&o)<<6|63&i),r+=3);return t}},n={forEach:function(e,t){var r,n;if(null==this)throw new TypeError(" this is null or not defined");var o=Object(this),i=o.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(1<arguments.length&&(r=t),n=0;n<i;){var s;n in o&&(s=o[n],e.call(r,s,n,o)),n++}},map:function(e,t){var r,n,o;if(null===this)throw new TypeError(" this is null or not defined");var i=Object(this),s=i.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(1<arguments.length&&(r=t),n=Array(s),o=0;o<s;){var a,c;o in i&&(a=i[o],c=e.call(r,a,o,i),n[o]=c),o++}return n},filter:function(e){if(null==this)throw new TypeError;var t=Object(this),r=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var n=[],o=2<=arguments.length?arguments[1]:void 0,i=0;i<r;i++)if(i in t){var s=t[i];e.call(o,s,i,t)&&n.push(s)}return n},isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},Base64:e};function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function i(e){var t=function(e,t){if("object"!==o(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===o(t)?t:String(t)}function s(e,t,r){return(t=i(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var a,c={SessionStart:1,SessionEnd:2,PageView:3,PageEvent:4,CrashReport:5,OptOut:6,AppStateTransition:10,Profile:14,Commerce:16,Media:20,UserAttributeChange:17,UserIdentityChange:18},u=(s(a={},c.Commerce,1),s(a,c.UserIdentityChange,1),a),d={Unknown:0,Navigation:1,Location:2,Search:3,Transaction:4,UserContent:5,UserPreference:6,Social:7,Other:8,Media:9,getName:function(e){return e===d.Unknown?"Unknown":e===d.Navigation?"Navigation":e===d.Location?"Location":e===d.Search?"Search":e===d.Transaction?"Transaction":e===d.UserContent?"User Content":e===d.UserPreference?"User Preference":e===d.Social?"Social":e===l.ProductAddToCart?"Product Added to Cart":e===l.ProductAddToWishlist?"Product Added to Wishlist":e===l.ProductCheckout?"Product Checkout":e===l.ProductCheckoutOption?"Product Checkout Options":e===l.ProductClick?"Product Click":e===l.ProductImpression?"Product Impression":e===l.ProductPurchase?"Product Purchased":e===l.ProductRefund?"Product Refunded":e===l.ProductRemoveFromCart?"Product Removed From Cart":e===l.ProductRemoveFromWishlist?"Product Removed from Wishlist":e===l.ProductViewDetail?"Product View Details":e===l.PromotionClick?"Promotion Click":e===l.PromotionView?"Promotion View":"Other"}},l={ProductAddToCart:10,ProductRemoveFromCart:11,ProductCheckout:12,ProductCheckoutOption:13,ProductClick:14,ProductViewDetail:15,ProductPurchase:16,ProductRefund:17,PromotionView:18,PromotionClick:19,ProductAddToWishlist:20,ProductRemoveFromWishlist:21,ProductImpression:22},g={Other:0,CustomerId:1,Facebook:2,Twitter:3,Google:4,Microsoft:5,Yahoo:6,Email:7,FacebookCustomAudienceId:9,Other2:10,Other3:11,Other4:12,Other5:13,Other6:14,Other7:15,Other8:16,Other9:17,Other10:18,MobileNumber:19,PhoneNumber2:20,PhoneNumber3:21,isValid:function(e){if("number"==typeof e)for(var t in g)if(g.hasOwnProperty(t)&&g[t]===e)return!0;return!1},getName:function(e){return e===window.mParticle.IdentityType.CustomerId?"Customer ID":e===window.mParticle.IdentityType.Facebook?"Facebook ID":e===window.mParticle.IdentityType.Twitter?"Twitter ID":e===window.mParticle.IdentityType.Google?"Google ID":e===window.mParticle.IdentityType.Microsoft?"Microsoft ID":e===window.mParticle.IdentityType.Yahoo?"Yahoo ID":e===window.mParticle.IdentityType.Email?"Email":e===window.mParticle.IdentityType.FacebookCustomAudienceId?"Facebook App User ID":"Other ID"},getIdentityType:function(e){return"other"===e?g.Other:"customerid"===e?g.CustomerId:"facebook"===e?g.Facebook:"twitter"===e?g.Twitter:"google"===e?g.Google:"microsoft"===e?g.Microsoft:"yahoo"===e?g.Yahoo:"email"===e?g.Email:"facebookcustomaudienceid"===e?g.FacebookCustomAudienceId:"other2"===e?g.Other2:"other3"===e?g.Other3:"other4"===e?g.Other4:"other5"===e?g.Other5:"other6"===e?g.Other6:"other7"===e?g.Other7:"other8"===e?g.Other8:"other9"===e?g.Other9:"other10"===e?g.Other10:"mobile_number"===e?g.MobileNumber:"phone_number_2"===e?g.PhoneNumber2:!("phone_number_3"!=e)&&g.PhoneNumber3},getIdentityName:function(e){return e===g.Other?"other":e===g.CustomerId?"customerid":e===g.Facebook?"facebook":e===g.Twitter?"twitter":e===g.Google?"google":e===g.Microsoft?"microsoft":e===g.Yahoo?"yahoo":e===g.Email?"email":e===g.FacebookCustomAudienceId?"facebookcustomaudienceid":e===g.Other2?"other2":e===g.Other3?"other3":e===g.Other4?"other4":e===g.Other5?"other5":e===g.Other6?"other6":e===g.Other7?"other7":e===g.Other8?"other8":e===g.Other9?"other9":e===g.Other10?"other10":e===g.MobileNumber?"mobile_number":e===g.PhoneNumber2?"phone_number_2":e===g.PhoneNumber3?"phone_number_3":void 0}},p={Unknown:0,AddToCart:1,RemoveFromCart:2,Checkout:3,CheckoutOption:4,Click:5,ViewDetail:6,Purchase:7,Refund:8,AddToWishlist:9,RemoveFromWishlist:10,getName:function(e){return e===p.AddToCart?"Add to Cart":e===p.RemoveFromCart?"Remove from Cart":e===p.Checkout?"Checkout":e===p.CheckoutOption?"Checkout Option":e===p.Click?"Click":e===p.ViewDetail?"View Detail":e===p.Purchase?"Purchase":e===p.Refund?"Refund":e===p.AddToWishlist?"Add to Wishlist":e===p.RemoveFromWishlist?"Remove from Wishlist":"Unknown"},getExpansionName:function(e){return e===p.AddToCart?"add_to_cart":e===p.RemoveFromCart?"remove_from_cart":e===p.Checkout?"checkout":e===p.CheckoutOption?"checkout_option":e===p.Click?"click":e===p.ViewDetail?"view_detail":e===p.Purchase?"purchase":e===p.Refund?"refund":e===p.AddToWishlist?"add_to_wishlist":e===p.RemoveFromWishlist?"remove_from_wishlist":"unknown"}},m={Unknown:0,PromotionView:1,PromotionClick:2,getName:function(e){return e===m.PromotionView?"view":e===m.PromotionClick?"click":"unknown"},getExpansionName:function(e){return e===m.PromotionView?"view":e===m.PromotionClick?"click":"unknown"}},f={MessageType:c,EventType:d,CommerceEventType:l,IdentityType:g,ProfileMessageType:{Logout:3},ApplicationTransitionType:{AppInit:1},ProductActionType:p,PromotionActionType:m,TriggerUploadType:u,Environment:{Production:"production",Development:"development"}},v={sdkVersion:"2.23.7",sdkVendor:"mparticle",platform:"web",Messages:{DeprecationMessages:{MethodIsDeprecatedPostfix:"is a deprecated method and will be removed in future releases",AlternativeMethodPrefix:"Please use the alternate method:"},ErrorMessages:{NoToken:"A token must be specified.",EventNameInvalidType:"Event name must be a valid string value.",EventDataInvalidType:"Event data must be a valid object hash.",LoggingDisabled:"Event logging is currently disabled.",CookieParseError:"Could not parse cookie",EventEmpty:"Event object is null or undefined, cancelling send",APIRequestEmpty:"APIRequest is null or undefined, cancelling send",NoEventType:"Event type must be specified.",TransactionIdRequired:"Transaction ID is required",TransactionRequired:"A transaction attributes object is required",PromotionIdRequired:"Promotion ID is required",BadAttribute:"Attribute value cannot be object or array",BadKey:"Key value cannot be object or array",BadLogPurchase:"Transaction attributes and a product are both required to log a purchase, https://docs.mparticle.com/?javascript#measuring-transactions"},InformationMessages:{CookieSearch:"Searching for cookie",CookieFound:"Cookie found, parsing values",CookieNotFound:"Cookies not found",CookieSet:"Setting cookie",CookieSync:"Performing cookie sync",SendBegin:"Starting to send event",SendIdentityBegin:"Starting to send event to identity server",SendWindowsPhone:"Sending event to Windows Phone container",SendIOS:"Calling iOS path: ",SendAndroid:"Calling Android JS interface method: ",SendHttp:"Sending event to mParticle HTTP service",SendAliasHttp:"Sending alias request to mParticle HTTP service",SendIdentityHttp:"Sending event to mParticle HTTP service",StartingNewSession:"Starting new Session",StartingLogEvent:"Starting to log event",StartingLogOptOut:"Starting to log user opt in/out",StartingEndSession:"Starting to end session",StartingInitialization:"Starting to initialize",StartingLogCommerceEvent:"Starting to log commerce event",StartingAliasRequest:"Starting to Alias MPIDs",LoadingConfig:"Loading configuration options",AbandonLogEvent:"Cannot log event, logging disabled or developer token not set",AbandonAliasUsers:"Cannot Alias Users, logging disabled or developer token not set",AbandonStartSession:"Cannot start session, logging disabled or developer token not set",AbandonEndSession:"Cannot end session, logging disabled or developer token not set",NoSessionToEnd:"Cannot end session, no active session found"},ValidationMessages:{ModifyIdentityRequestUserIdentitiesPresent:"identityRequests to modify require userIdentities to be present. Request not sent to server. Please fix and try again",IdentityRequesetInvalidKey:"There is an invalid key on your identityRequest object. It can only contain a `userIdentities` object and a `onUserAlias` function. Request not sent to server. Please fix and try again.",OnUserAliasType:"The onUserAlias value must be a function.",UserIdentities:"The userIdentities key must be an object with keys of identityTypes and values of strings. Request not sent to server. Please fix and try again.",UserIdentitiesInvalidKey:"There is an invalid identity key on your `userIdentities` object within the identityRequest. Request not sent to server. Please fix and try again.",UserIdentitiesInvalidValues:"All user identity values must be strings or null. Request not sent to server. Please fix and try again.",AliasMissingMpid:"Alias Request must contain both a destinationMpid and a sourceMpid",AliasNonUniqueMpid:"Alias Request's destinationMpid and sourceMpid must be unique",AliasMissingTime:"Alias Request must have both a startTime and an endTime",AliasStartBeforeEndTime:"Alias Request's endTime must be later than its startTime"}},NativeSdkPaths:{LogEvent:"logEvent",SetUserTag:"setUserTag",RemoveUserTag:"removeUserTag",SetUserAttribute:"setUserAttribute",RemoveUserAttribute:"removeUserAttribute",SetSessionAttribute:"setSessionAttribute",AddToCart:"addToCart",RemoveFromCart:"removeFromCart",ClearCart:"clearCart",LogOut:"logOut",SetUserAttributeList:"setUserAttributeList",RemoveAllUserAttributes:"removeAllUserAttributes",GetUserAttributesLists:"getUserAttributesLists",GetAllUserAttributes:"getAllUserAttributes",Identify:"identify",Logout:"logout",Login:"login",Modify:"modify",Alias:"aliasUsers",Upload:"upload"},StorageNames:{localStorageName:"mprtcl-api",localStorageNameV3:"mprtcl-v3",cookieName:"mprtcl-api",cookieNameV2:"mprtcl-v2",cookieNameV3:"mprtcl-v3",localStorageNameV4:"mprtcl-v4",localStorageProductsV4:"mprtcl-prodv4",cookieNameV4:"mprtcl-v4",currentStorageName:"mprtcl-v4",currentStorageProductsName:"mprtcl-prodv4"},DefaultConfig:{cookieDomain:null,cookieExpiration:365,logLevel:null,timeout:300,sessionTimeout:30,maxProducts:20,forwarderStatsTimeout:5e3,integrationDelayTimeout:5e3,maxCookieSize:3e3,aliasMaxWindow:90,uploadInterval:0},DefaultUrls:{v1SecureServiceUrl:"jssdks.mparticle.com/v1/JS/",v2SecureServiceUrl:"jssdks.mparticle.com/v2/JS/",v3SecureServiceUrl:"jssdks.mparticle.com/v3/JS/",configUrl:"jssdkcdns.mparticle.com/JS/v2/",identityUrl:"identity.mparticle.com/v1/",aliasUrl:"jssdks.mparticle.com/v1/identity/"},Base64CookieKeys:{csm:1,sa:1,ss:1,ua:1,ui:1,csd:1,ia:1,con:1},SDKv2NonMPIDCookieKeys:{gs:1,cu:1,l:1,globalSettings:1,currentUserMPID:1},HTTPCodes:{noHttpCoverage:-1,activeIdentityRequest:-2,activeSession:-3,validationIssue:-4,nativeIdentityRequest:-5,loggingDisabledOrMissingAPIKey:-6,tooManyRequests:429},FeatureFlags:{ReportBatching:"reportBatching",EventBatchingIntervalMillis:"eventBatchingIntervalMillis",OfflineStorage:"offlineStorage"},DefaultInstance:"default_instance",CCPAPurpose:"data_sale_opt_out"},h=function(e,t){return h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},h(e,t)};function y(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}h(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var P,b,C,w=function(){return w=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},w.apply(this,arguments)};function S(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function a(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,a)}c((n=n.apply(e,t||[])).next())}))}function _(e,t){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(c){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,n=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}"function"==typeof SuppressedError&&SuppressedError,(b=P||(P={}))[b.Unknown=0]="Unknown",b[b.AddToCart=1]="AddToCart",b[b.RemoveFromCart=2]="RemoveFromCart",b[b.Checkout=3]="Checkout",b[b.CheckoutOption=4]="CheckoutOption",b[b.Click=5]="Click",b[b.ViewDetail=6]="ViewDetail",b[b.Purchase=7]="Purchase",b[b.Refund=8]="Refund",b[b.AddToWishlist=9]="AddToWishlist",b[b.RemoveFromWishlist=10]="RemoveFromWishlist",function(e){e.other="other",e.customerId="customerid",e.facebook="facebook",e.twitter="twitter",e.google="google",e.microsoft="microsoft",e.yahoo="yahoo",e.email="email",e.alias="alias",e.facebookCustomAudienceId="facebookcustomaudienceid",e.otherId2="other2",e.otherId3="other3",e.otherId4="other4",e.otherId5="other5",e.otherId6="other6",e.otherId7="other7",e.otherId8="other8",e.otherId9="other9",e.otherId10="other10",e.mobileNumber="mobile_number",e.phoneNumber2="phone_number_2",e.phoneNumber3="phone_number_3"}(C||(C={}));var I,A,E,T,k,D,O,U,L,M,N,F,V,R,H,x,j,K={};I=K,Object.defineProperty(I,"__esModule",{value:!0}),(A=I.ApplicationInformationOsEnum||(I.ApplicationInformationOsEnum={})).unknown="Unknown",A.iOS="IOS",A.android="Android",A.windowsPhone="WindowsPhone",A.mobileWeb="MobileWeb",A.unityIOS="UnityIOS",A.unityAndroid="UnityAndroid",A.desktop="Desktop",A.tvOS="TVOS",A.roku="Roku",A.outOfBand="OutOfBand",A.alexa="Alexa",A.smartTV="SmartTV",A.fireTV="FireTV",A.xbox="Xbox",(I.ApplicationStateTransitionEventEventTypeEnum||(I.ApplicationStateTransitionEventEventTypeEnum={})).applicationStateTransition="application_state_transition",(E=I.ApplicationStateTransitionEventDataApplicationTransitionTypeEnum||(I.ApplicationStateTransitionEventDataApplicationTransitionTypeEnum={})).applicationInitialized="application_initialized",E.applicationExit="application_exit",E.applicationBackground="application_background",E.applicationForeground="application_foreground",(T=I.BatchEnvironmentEnum||(I.BatchEnvironmentEnum={})).unknown="unknown",T.development="development",T.production="production",(I.BreadcrumbEventEventTypeEnum||(I.BreadcrumbEventEventTypeEnum={})).breadcrumb="breadcrumb",(I.CommerceEventEventTypeEnum||(I.CommerceEventEventTypeEnum={})).commerceEvent="commerce_event",(k=I.CommerceEventDataCustomEventTypeEnum||(I.CommerceEventDataCustomEventTypeEnum={})).addToCart="add_to_cart",k.removeFromCart="remove_from_cart",k.checkout="checkout",k.checkoutOption="checkout_option",k.click="click",k.viewDetail="view_detail",k.purchase="purchase",k.refund="refund",k.promotionView="promotion_view",k.promotionClick="promotion_click",k.addToWishlist="add_to_wishlist",k.removeFromWishlist="remove_from_wishlist",k.impression="impression",(I.CrashReportEventEventTypeEnum||(I.CrashReportEventEventTypeEnum={})).crashReport="crash_report",(I.CustomEventEventTypeEnum||(I.CustomEventEventTypeEnum={})).customEvent="custom_event",(D=I.CustomEventDataCustomEventTypeEnum||(I.CustomEventDataCustomEventTypeEnum={})).navigation="navigation",D.location="location",D.search="search",D.transaction="transaction",D.userContent="user_content",D.userPreference="user_preference",D.social="social",D.media="media",D.other="other",D.unknown="unknown",(O=I.DeviceCurrentStateDeviceOrientationEnum||(I.DeviceCurrentStateDeviceOrientationEnum={})).portrait="portrait",O.portraitUpsideDown="portrait_upside_down",O.landscape="landscape",O.landscapeLeft="LandscapeLeft",O.landscapeRight="LandscapeRight",O.faceUp="FaceUp",O.faceDown="FaceDown",O.square="Square",(U=I.DeviceCurrentStateStatusBarOrientationEnum||(I.DeviceCurrentStateStatusBarOrientationEnum={})).portrait="portrait",U.portraitUpsideDown="portrait_upside_down",U.landscape="landscape",U.landscapeLeft="LandscapeLeft",U.landscapeRight="LandscapeRight",U.faceUp="FaceUp",U.faceDown="FaceDown",U.square="Square",(L=I.DeviceInformationPlatformEnum||(I.DeviceInformationPlatformEnum={})).iOS="iOS",L.android="Android",L.web="web",L.desktop="desktop",L.tvOS="tvOS",L.roku="roku",L.outOfBand="out_of_band",L.smartTV="smart_tv",L.xbox="xbox",function(e){e.unknown="unknown",e.sessionStart="session_start",e.sessionEnd="session_end",e.screenView="screen_view",e.customEvent="custom_event",e.crashReport="crash_report",e.optOut="opt_out",e.firstRun="first_run",e.preAttribution="pre_attribution",e.pushRegistration="push_registration",e.applicationStateTransition="application_state_transition",e.pushMessage="push_message",e.networkPerformance="network_performance",e.breadcrumb="breadcrumb",e.profile="profile",e.pushReaction="push_reaction",e.commerceEvent="commerce_event",e.userAttributeChange="user_attribute_change",e.userIdentityChange="user_identity_change",e.uninstall="uninstall",e.validationResult="validation_result"}(I.EventTypeEnum||(I.EventTypeEnum={})),(M=I.IdentityTypeEnum||(I.IdentityTypeEnum={})).other="other",M.customerId="customer_id",M.facebook="facebook",M.twitter="twitter",M.google="google",M.microsoft="microsoft",M.yahoo="yahoo",M.email="email",M.alias="alias",M.facebookCustomAudienceId="facebook_custom_audience_id",M.otherId2="other_id_2",M.otherId3="other_id_3",M.otherId4="other_id_4",M.otherId5="other_id_5",M.otherId6="other_id_6",M.otherId7="other_id_7",M.otherId8="other_id_8",M.otherId9="other_id_9",M.otherId10="other_id_10",M.mobileNumber="mobile_number",M.phoneNumber2="phone_number_2",M.phoneNumber3="phone_number_3",(I.NetworkPerformanceEventEventTypeEnum||(I.NetworkPerformanceEventEventTypeEnum={})).networkPerformance="network_performance",(I.OptOutEventEnum||(I.OptOutEventEnum={})).optOut="opt_out",(N=I.ProductActionActionEnum||(I.ProductActionActionEnum={})).unknown="unknown",N.addToCart="add_to_cart",N.removeFromCart="remove_from_cart",N.checkout="checkout",N.checkoutOption="checkout_option",N.click="click",N.viewDetail="view_detail",N.purchase="purchase",N.refund="refund",N.addToWishlist="add_to_wishlist",N.removeFromWishlist="remove_from_wish_list",(I.ProfileEventEventTypeEnum||(I.ProfileEventEventTypeEnum={})).profile="profile",(F=I.ProfileEventDataProfileEventTypeEnum||(I.ProfileEventDataProfileEventTypeEnum={})).signup="signup",F.login="login",F.logout="logout",F.update="update",F.delete="delete",(V=I.PromotionActionActionEnum||(I.PromotionActionActionEnum={})).view="view",V.click="click",(I.PushMessageEventEventTypeEnum||(I.PushMessageEventEventTypeEnum={})).pushMessage="push_message",(R=I.PushMessageEventDataPushMessageTypeEnum||(I.PushMessageEventDataPushMessageTypeEnum={})).sent="sent",R.received="received",R.action="action",(H=I.PushMessageEventDataApplicationStateEnum||(I.PushMessageEventDataApplicationStateEnum={})).notRunning="not_running",H.background="background",H.foreground="foreground",(x=I.PushMessageEventDataPushMessageBehaviorEnum||(I.PushMessageEventDataPushMessageBehaviorEnum={})).received="Received",x.directOpen="DirectOpen",x.read="Read",x.influencedOpen="InfluencedOpen",x.displayed="Displayed",(I.PushRegistrationEventEventTypeEnum||(I.PushRegistrationEventEventTypeEnum={})).pushRegistration="push_registration",(I.SessionEndEventEventTypeEnum||(I.SessionEndEventEventTypeEnum={})).sessionEnd="session_end",(I.SessionStartEventEventTypeEnum||(I.SessionStartEventEventTypeEnum={})).sessionStart="session_start",(j=I.SourceInformationChannelEnum||(I.SourceInformationChannelEnum={})).native="native",j.javascript="javascript",j.pixel="pixel",j.desktop="desktop",j.partner="partner",j.serverToServer="server_to_server",(I.UserAttributeChangeEventEventTypeEnum||(I.UserAttributeChangeEventEventTypeEnum={})).userAttributeChange="user_attribute_change",(I.UserIdentityChangeEventEventTypeEnum||(I.UserIdentityChangeEventEventTypeEnum={})).userIdentityChange="user_identity_change";var q=v.Messages,B=function(e){return ee(ne(e))},z=function(e){return te(re(e))},G=function(e,t){var r=0;if(Array.prototype.indexOf)return 0<=e.indexOf(t,0);for(var n=e.length;r<n;r++)if(r in e&&e[r]===t)return!0;return!1},W=function(e,t){if(t&&e)for(var r in e)if(e.hasOwnProperty(r)&&r.toLowerCase()===t.toLowerCase())return r;return null},J=function(e,t){var r=[e,q.DeprecationMessages.MethodIsDeprecatedPostfix];return t&&(r.push(t),r.push(q.DeprecationMessages.MethodIsDeprecatedPostfix)),r.join(" ")};function Q(e){var t=0;if(null==e)return 0;if(e=e.toString().toLowerCase(),Array.prototype.reduce)return e.split("").reduce((function(e,t){return(e=(e<<5)-e+t.charCodeAt(0))&e}),0);if(0===e.length)return t;for(var r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t&=t;return t}var Y=function(e){return void 0===e&&(e=""),e?function(){var e,t;return window.crypto&&window.crypto.getRandomValues&&(e=window.crypto.getRandomValues(new Uint8Array(1))),e?(t^e[0]%16>>NaN).toString(16):(t^16*Math.random()>>NaN).toString(16)}():"".concat(1e7,"-").concat(1e3,"-").concat(4e3,"-").concat(8e3,"-").concat(1e11).replace(/[018]/g,Y)},Z=function(e){var t=Object.prototype.toString.call(e);return"[object Object]"===t||"[object Error]"===t},X=function(e){if(isNaN(e)||!isFinite(e))return 0;var t=parseFloat(e);return isNaN(t)?0:t},$=function(e){return ue(e)?e:null},ee=function(e){return e.replace(/,/g,"|")},te=function(e){return e.replace(/\|/g,",")},re=function(e){return e.replace(/\'/g,'"')},ne=function(e){return e.replace(/\"/g,"'")},oe=function(e){return"false"!==e&&"0"!==e&&!!e},ie=function(e){return decodeURIComponent(e.replace(/\+/g," "))},se=function(e){return 0===e.indexOf('"')&&(e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\")),e},ae=function(e){return"number"==typeof e},ce=function(e){return e===function(e){return ue(e)?e.toString().toLowerCase().replace(/[^0-9a-zA-Z]+/g,"_"):""}(e)},ue=function(e){return function(e){return"string"==typeof e}(e)||ae(e)},de=function(e){return null==e||!(Object.keys(e)||e).length};function le(e,t,r){if(!e)return null;if(!t||1>t.length)return null;for(var n,o=r.Identity.getCurrentUser(),i=[],s=null,a=0,c=t;a<c.length;a++)if(n=c[a]){s=n;var u=ve(n);u&&i.push(u)}if(!s)return null;var d=null;de(s.ConsentState)?!de(o)&&(d=o.getConsentState()):d=s.ConsentState;var l={source_request_id:r._Helpers.generateUniqueId(),mpid:e,timestamp_unixtime_ms:(new Date).getTime(),environment:s.Debug?K.BatchEnvironmentEnum.development:K.BatchEnvironmentEnum.production,events:i,mp_deviceid:s.DeviceId,sdk_version:s.SDKVersion,application_info:{application_version:s.AppVersion,application_name:s.AppName,package:s.Package,sideloaded_kits_count:r._Store.sideloadedKitsCount},device_info:{platform:K.DeviceInformationPlatformEnum.web,screen_width:window.screen.width,screen_height:window.screen.height},user_attributes:s.UserAttributes,user_identities:fe(s.UserIdentities),consent_state:ge(d),integration_attributes:s.IntegrationAttributes};return s.DataPlan&&s.DataPlan.PlanId&&(l.context={data_plan:{plan_id:s.DataPlan.PlanId,plan_version:s.DataPlan.PlanVersion||void 0}}),l}function ge(e){return de(e)?null:{gdpr:pe(e.getGDPRConsentState()),ccpa:me(e.getCCPAConsentState())}}function pe(e){if(!e)return null;var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]={consented:e[r].Consented,hardware_id:e[r].HardwareId,document:e[r].ConsentDocument,timestamp_unixtime_ms:e[r].Timestamp,location:e[r].Location});return t}function me(e){return e?{data_sale_opt_out:{consented:e.Consented,hardware_id:e.HardwareId,document:e.ConsentDocument,timestamp_unixtime_ms:e.Timestamp,location:e.Location}}:null}function fe(e){if(!e||!e.length)return null;for(var t,r={},n=0,o=e;n<o.length;n++)switch(t=o[n],t.Type){case f.IdentityType.CustomerId:r.customer_id=t.Identity;break;case f.IdentityType.Email:r.email=t.Identity;break;case f.IdentityType.Facebook:r.facebook=t.Identity;break;case f.IdentityType.FacebookCustomAudienceId:r.facebook_custom_audience_id=t.Identity;break;case f.IdentityType.Google:r.google=t.Identity;break;case f.IdentityType.Microsoft:r.microsoft=t.Identity;break;case f.IdentityType.Other:r.other=t.Identity;break;case f.IdentityType.Other2:r.other_id_2=t.Identity;break;case f.IdentityType.Other3:r.other_id_3=t.Identity;break;case f.IdentityType.Other4:r.other_id_4=t.Identity;break;case f.IdentityType.Other5:r.other_id_5=t.Identity;break;case f.IdentityType.Other6:r.other_id_6=t.Identity;break;case f.IdentityType.Other7:r.other_id_7=t.Identity;break;case f.IdentityType.Other8:r.other_id_8=t.Identity;break;case f.IdentityType.Other9:r.other_id_9=t.Identity;break;case f.IdentityType.Other10:r.other_id_10=t.Identity;break;case f.IdentityType.MobileNumber:r.mobile_number=t.Identity;break;case f.IdentityType.PhoneNumber2:r.phone_number_2=t.Identity;break;case f.IdentityType.PhoneNumber3:r.phone_number_3=t.Identity}return r}function ve(e){if(!e)return null;switch(e.EventDataType){case f.MessageType.AppStateTransition:return function(e){var t=Ie(e),r={application_transition_type:K.ApplicationStateTransitionEventDataApplicationTransitionTypeEnum.applicationInitialized,is_first_run:e.IsFirstRun,is_upgrade:!1,launch_referral:e.LaunchReferral};return r=Object.assign(r,t),{event_type:K.EventTypeEnum.applicationStateTransition,data:r}}(e);case f.MessageType.Commerce:return function(e){var t=Ie(e),r={custom_flags:e.CustomFlags,product_action:ye(e),promotion_action:be(e),product_impressions:we(e),shopping_cart:Se(e),currency_code:e.CurrencyCode};return r=Object.assign(r,t),{event_type:K.EventTypeEnum.commerceEvent,data:r}}(e);case f.MessageType.CrashReport:return function(e){var t=Ie(e),r={message:e.EventName};return r=Object.assign(r,t),{event_type:K.EventTypeEnum.crashReport,data:r}}(e);case f.MessageType.OptOut:return function(e){var t=Ie(e),r={is_opted_out:e.OptOut};return r=Object.assign(r,t),{event_type:K.EventTypeEnum.optOut,data:r}}(e);case f.MessageType.PageEvent:return function(e){var t=Ie(e),r={custom_event_type:_e(e.EventCategory),custom_flags:e.CustomFlags,event_name:e.EventName};return r=Object.assign(r,t),{event_type:K.EventTypeEnum.customEvent,data:r}}(e);case f.MessageType.PageView:return function(e){var t=Ie(e),r={custom_flags:e.CustomFlags,screen_name:e.EventName};return r=Object.assign(r,t),{event_type:K.EventTypeEnum.screenView,data:r}}(e);case f.MessageType.Profile:return null;case f.MessageType.SessionEnd:return function(e){var t=Ie(e),r={session_duration_ms:e.SessionLength};return r=Object.assign(r,t),{event_type:K.EventTypeEnum.sessionEnd,data:r}}(e);case f.MessageType.SessionStart:return function(e){var t=Ie(e),r={};return r=Object.assign(r,t),{event_type:K.EventTypeEnum.sessionStart,data:r}}(e);case f.MessageType.UserAttributeChange:return function(e){var t=Ie(e),r={user_attribute_name:e.UserAttributeChanges.UserAttributeName,new:e.UserAttributeChanges.New,old:e.UserAttributeChanges.Old,deleted:e.UserAttributeChanges.Deleted,is_new_attribute:e.UserAttributeChanges.IsNewAttribute};return r=w(w({},r),t),{event_type:K.EventTypeEnum.userAttributeChange,data:r}}(e);case f.MessageType.UserIdentityChange:return function(e){var t=Ie(e),r={new:{identity_type:Ee(e.UserIdentityChanges.New.IdentityType),identity:e.UserIdentityChanges.New.Identity||null,timestamp_unixtime_ms:e.Timestamp,created_this_batch:e.UserIdentityChanges.New.CreatedThisBatch},old:{identity_type:Ee(e.UserIdentityChanges.Old.IdentityType),identity:e.UserIdentityChanges.Old.Identity||null,timestamp_unixtime_ms:e.Timestamp,created_this_batch:e.UserIdentityChanges.Old.CreatedThisBatch}};return r=Object.assign(r,t),{event_type:K.EventTypeEnum.userIdentityChange,data:r}}(e)}return null}function he(e){return e?e===P.AddToCart?K.ProductActionActionEnum.addToCart:e===P.AddToWishlist?K.ProductActionActionEnum.addToWishlist:e===P.Checkout?K.ProductActionActionEnum.checkout:e===P.CheckoutOption?K.ProductActionActionEnum.checkoutOption:e===P.Click?K.ProductActionActionEnum.click:e===P.Purchase?K.ProductActionActionEnum.purchase:e===P.Refund?K.ProductActionActionEnum.refund:e===P.RemoveFromCart?K.ProductActionActionEnum.removeFromCart:e===P.RemoveFromWishlist?K.ProductActionActionEnum.removeFromWishlist:e===P.ViewDetail?K.ProductActionActionEnum.viewDetail:K.ProductActionActionEnum.unknown:K.ProductActionActionEnum.unknown}function ye(e){return e.ProductAction?{action:he(e.ProductAction.ProductActionType),checkout_step:e.ProductAction.CheckoutStep,checkout_options:e.ProductAction.CheckoutOptions,transaction_id:e.ProductAction.TransactionId,affiliation:e.ProductAction.Affiliation,total_amount:e.ProductAction.TotalAmount,tax_amount:e.ProductAction.TaxAmount,shipping_amount:e.ProductAction.ShippingAmount,coupon_code:e.ProductAction.CouponCode,products:Pe(e.ProductAction.ProductList)}:null}function Pe(e){if(!e||!e.length)return null;for(var t=[],r=0,n=e;r<n.length;r++){var o=n[r],i={id:o.Sku,name:o.Name,brand:o.Brand,category:o.Category,variant:o.Variant,total_product_amount:o.TotalAmount,position:o.Position,price:o.Price,quantity:o.Quantity,coupon_code:o.CouponCode,custom_attributes:o.Attributes};t.push(i)}return t}function be(e){return e.PromotionAction?{action:e.PromotionAction.PromotionActionType,promotions:Ce(e.PromotionAction.PromotionList)}:null}function Ce(e){if(!e||!e.length)return null;for(var t=[],r=0,n=e;r<n.length;r++){var o=n[r],i={id:o.Id,name:o.Name,creative:o.Creative,position:o.Position};t.push(i)}return t}function we(e){if(!e.ProductImpressions)return null;for(var t=[],r=0,n=e.ProductImpressions;r<n.length;r++){var o=n[r],i={product_impression_list:o.ProductImpressionList,products:Pe(o.ProductList)};t.push(i)}return t}function Se(e){return e.ShoppingCart&&e.ShoppingCart.ProductList&&e.ShoppingCart.ProductList.length?{products:Pe(e.ShoppingCart.ProductList)}:null}function _e(e){return e===f.EventType.Other?K.CustomEventDataCustomEventTypeEnum.other:e===f.EventType.Location?K.CustomEventDataCustomEventTypeEnum.location:e===f.EventType.Navigation?K.CustomEventDataCustomEventTypeEnum.navigation:e===f.EventType.Search?K.CustomEventDataCustomEventTypeEnum.search:e===f.EventType.Social?K.CustomEventDataCustomEventTypeEnum.social:e===f.EventType.Transaction?K.CustomEventDataCustomEventTypeEnum.transaction:e===f.EventType.UserContent?K.CustomEventDataCustomEventTypeEnum.userContent:e===f.EventType.UserPreference?K.CustomEventDataCustomEventTypeEnum.userPreference:e===f.EventType.Media?K.CustomEventDataCustomEventTypeEnum.media:e===f.CommerceEventType.ProductAddToCart?K.CommerceEventDataCustomEventTypeEnum.addToCart:e===f.CommerceEventType.ProductAddToWishlist?K.CommerceEventDataCustomEventTypeEnum.addToWishlist:e===f.CommerceEventType.ProductCheckout?K.CommerceEventDataCustomEventTypeEnum.checkout:e===f.CommerceEventType.ProductCheckoutOption?K.CommerceEventDataCustomEventTypeEnum.checkoutOption:e===f.CommerceEventType.ProductClick?K.CommerceEventDataCustomEventTypeEnum.click:e===f.CommerceEventType.ProductImpression?K.CommerceEventDataCustomEventTypeEnum.impression:e===f.CommerceEventType.ProductPurchase?K.CommerceEventDataCustomEventTypeEnum.purchase:e===f.CommerceEventType.ProductRefund?K.CommerceEventDataCustomEventTypeEnum.refund:e===f.CommerceEventType.ProductRemoveFromCart?K.CommerceEventDataCustomEventTypeEnum.removeFromCart:e===f.CommerceEventType.ProductRemoveFromWishlist?K.CommerceEventDataCustomEventTypeEnum.removeFromWishlist:e===f.CommerceEventType.ProductViewDetail?K.CommerceEventDataCustomEventTypeEnum.viewDetail:e===f.CommerceEventType.PromotionClick?K.CommerceEventDataCustomEventTypeEnum.promotionClick:e===f.CommerceEventType.PromotionView?K.CommerceEventDataCustomEventTypeEnum.promotionView:K.CustomEventDataCustomEventTypeEnum.unknown}function Ie(e){return{timestamp_unixtime_ms:e.Timestamp,session_uuid:e.SessionId,session_start_unixtime_ms:e.SessionStartDate,custom_attributes:e.EventAttributes,location:Ae(e.Location),source_message_id:e.SourceMessageId}}function Ae(e){return e&&Object.keys(e).length?{latitude:e.lat,longitude:e.lng}:null}function Ee(e){return e===C.other?K.IdentityTypeEnum.other:e===C.customerId?K.IdentityTypeEnum.customerId:e===C.facebook?K.IdentityTypeEnum.facebook:e===C.twitter?K.IdentityTypeEnum.twitter:e===C.google?K.IdentityTypeEnum.google:e===C.microsoft?K.IdentityTypeEnum.microsoft:e===C.yahoo?K.IdentityTypeEnum.yahoo:e===C.email?K.IdentityTypeEnum.email:e===C.alias?K.IdentityTypeEnum.alias:e===C.facebookCustomAudienceId?K.IdentityTypeEnum.facebookCustomAudienceId:e===C.otherId2?K.IdentityTypeEnum.otherId2:e===C.otherId3?K.IdentityTypeEnum.otherId3:e===C.otherId4?K.IdentityTypeEnum.otherId4:e===C.otherId5?K.IdentityTypeEnum.otherId5:e===C.otherId6?K.IdentityTypeEnum.otherId6:e===C.otherId7?K.IdentityTypeEnum.otherId7:e===C.otherId8?K.IdentityTypeEnum.otherId8:e===C.otherId9?K.IdentityTypeEnum.otherId9:e===C.otherId10?K.IdentityTypeEnum.otherId10:e===C.mobileNumber?K.IdentityTypeEnum.mobileNumber:e===C.phoneNumber2?K.IdentityTypeEnum.phoneNumber2:e===C.phoneNumber3?K.IdentityTypeEnum.phoneNumber3:void 0}var Te=function(){function e(e,t,r){this._storageKey=e,this.storageObject=t,this.logger=(null==r?void 0:r.logger)||{verbose:function(){},warning:function(){},error:function(){}},this.contents=this.retrieve()}return e.prototype.store=function(e){this.contents=e;var t=de(e)?"":JSON.stringify(e);try{this.storageObject.setItem(this._storageKey,t),this.logger.verbose("Saving item to Storage: ".concat(t))}catch(e){this.logger.error("Cannot Save items to Storage: ".concat(t)),this.logger.error(e)}},e.prototype.retrieve=function(){var e=this.storageObject.getItem(this._storageKey);return this.contents=e?JSON.parse(e):null,this.logger.verbose("Retrieving item from Storage: ".concat(e)),this.contents},e.prototype.purge=function(){this.logger.verbose("Purging Storage"),this.contents=null,this.storageObject.removeItem(this._storageKey)},e}(),ke=function(e){function t(t,r){return e.call(this,t,window.localStorage,r)||this}return y(t,e),t}(Te),De=function(e){function t(t,r){return e.call(this,t,window.sessionStorage,r)||this}return y(t,e),t}(Te),Oe=function(){function e(t,r){var n;this.offlineStorageEnabled=!1,this.mpInstance=t,this.uploadIntervalMillis=r,this.batchingEnabled=r>=e.MINIMUM_INTERVAL_MILLIS,this.uploadIntervalMillis<e.MINIMUM_INTERVAL_MILLIS&&(this.uploadIntervalMillis=e.MINIMUM_INTERVAL_MILLIS),this.eventsQueuedForProcessing=[],this.batchesQueuedForProcessing=[],this.offlineStorageEnabled=this.isOfflineStorageAvailable(),this.offlineStorageEnabled&&(this.eventVault=new De("".concat(t._Store.storageName,"-events"),{logger:t.Logger}),this.batchVault=new ke("".concat(t._Store.storageName,"-batches"),{logger:t.Logger}),(n=this.eventsQueuedForProcessing).push.apply(n,this.eventVault.retrieve()));var o=this.mpInstance._Store,i=o.SDKConfig,s=o.devToken,a=this.mpInstance._Helpers.createServiceUrl(i.v3SecureServiceUrl,s);this.uploadUrl="".concat(a,"/events"),this.uploader=window.fetch?new Le(this.uploadUrl):new Me(this.uploadUrl),this.triggerUploadInterval(!0,!1),this.addEventListeners()}return e.prototype.isOfflineStorageAvailable=function(){var e=this.mpInstance,t=e._Helpers.getFeatureFlag,r=e._Store.deviceId,n=t(v.FeatureFlags.OfflineStorage),o=parseInt(n,10),i=function(e){if(!e)return 100;var t=Q(e);return Math.abs(t%100)+1}(r);return o>=i},e.prototype.addEventListeners=function(){var e=this;document.addEventListener("visibilitychange",(function(){e.prepareAndUpload(!1,e.isBeaconAvailable())})),window.addEventListener("beforeunload",(function(){e.prepareAndUpload(!1,e.isBeaconAvailable())})),window.addEventListener("pagehide",(function(){e.prepareAndUpload(!1,e.isBeaconAvailable())}))},e.prototype.isBeaconAvailable=function(){return!!navigator.sendBeacon},e.prototype.triggerUploadInterval=function(e,t){var r=this;void 0===e&&(e=!1),void 0===t&&(t=!1),setTimeout((function(){r.prepareAndUpload(e,t)}),this.uploadIntervalMillis)},e.prototype.queueEvent=function(e){de(e)||(this.eventsQueuedForProcessing.push(e),this.offlineStorageEnabled&&this.eventVault&&this.eventVault.store(this.eventsQueuedForProcessing),this.mpInstance.Logger.verbose("Queuing event: ".concat(JSON.stringify(e))),this.mpInstance.Logger.verbose("Queued event count: ".concat(this.eventsQueuedForProcessing.length)),(!this.batchingEnabled||f.TriggerUploadType[e.EventDataType])&&this.prepareAndUpload(!1,!1))},e.createNewBatches=function(e,t,r){if(!t||!e||!e.length)return null;for(var n=[],o=new Map,i=0,s=e;i<s.length;i++){if(!(v=s[i]).MPID){var a=t.getMPID();v.MPID=a}(f=o.get(v.MPID))||(f=[]),f.push(v),o.set(v.MPID,f)}for(var c=0,u=Array.from(o.entries());c<u.length;c++){for(var d=u[c],l=(a=d[0],d[1]),g=new Map,p=0,m=l;p<m.length;p++){var f,v=m[p];(f=g.get(v.SessionId))||(f=[]),f.push(v),g.set(v.SessionId,f)}for(var h=0,y=Array.from(g.entries());h<y.length;h++){var P=le(a,y[h][1],r),b=r._Store.SDKConfig.onCreateBatch;b&&((P=b(P))?P.modified=!0:r.Logger.warning("Skiping batch upload because no batch was returned from onCreateBatch callback")),P&&n.push(P)}}return n},e.prototype.prepareAndUpload=function(t,r){return S(this,void 0,void 0,(function(){var n,o,i,s,a,c,u,d;return _(this,(function(l){switch(l.label){case 0:return n=this.mpInstance.Identity.getCurrentUser(),o=this.eventsQueuedForProcessing,this.eventsQueuedForProcessing=[],this.offlineStorageEnabled&&this.eventVault&&this.eventVault.store([]),i=[],de(o)||(i=e.createNewBatches(o,n,this.mpInstance)),this.offlineStorageEnabled&&this.batchVault&&((c=this.batchesQueuedForProcessing).unshift.apply(c,this.batchVault.retrieve()),this.batchVault.purge()),de(i)||(u=this.batchesQueuedForProcessing).push.apply(u,i),s=this.batchesQueuedForProcessing,this.batchesQueuedForProcessing=[],[4,this.uploadBatches(this.mpInstance.Logger,s,r)];case 1:return a=l.sent(),de(a)||(d=this.batchesQueuedForProcessing).unshift.apply(d,a),!r&&this.offlineStorageEnabled&&this.batchVault&&(this.batchVault.store(this.batchesQueuedForProcessing),this.batchesQueuedForProcessing=[]),t&&this.triggerUploadInterval(t,!1),[2]}}))}))},e.prototype.uploadBatches=function(t,r,n){return S(this,void 0,void 0,(function(){var o,i,s,a,c,u;return _(this,(function(d){switch(d.label){case 0:if(o=r.filter((function(e){return!de(e.events)})),de(o))return[2,null];t.verbose("Uploading batches: ".concat(JSON.stringify(o))),t.verbose("Batch count: ".concat(o.length)),i=0,d.label=1;case 1:return i<o.length?(s={method:"POST",headers:{Accept:e.CONTENT_TYPE,"Content-Type":"text/plain;charset=UTF-8"},body:JSON.stringify(o[i])},n&&this.isBeaconAvailable()?(a=new Blob([s.body],{type:"text/plain;charset=UTF-8"}),navigator.sendBeacon(this.uploadUrl,a),[3,5]):[3,2]):[3,6];case 2:return d.trys.push([2,4,,5]),[4,this.uploader.upload(s)];case 3:if(!(200<=(c=d.sent()).status&&300>c.status)){if(500<=c.status||429===c.status)return t.error("HTTP error status ".concat(c.status," received")),[2,o.slice(i,o.length)];if(401<=c.status)return t.error("HTTP error status ".concat(c.status," while uploading - please verify your API key.")),[2,null];throw console.error("HTTP error status ".concat(c.status," while uploading events."),c),new Error("Uncaught HTTP Error ".concat(c.status,".  Batch upload will be re-attempted."))}return t.verbose("Upload success for request ID: ".concat(o[i].source_request_id)),[3,5];case 4:return u=d.sent(),t.error("Error sending event to mParticle servers. ".concat(u)),[2,o.slice(i,o.length)];case 5:return i++,[3,1];case 6:return[2,null]}}))}))},e.CONTENT_TYPE="text/plain;charset=UTF-8",e.MINIMUM_INTERVAL_MILLIS=500,e}(),Ue=function(e){this.url=e},Le=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return y(t,e),t.prototype.upload=function(e){return S(this,void 0,void 0,(function(){return _(this,(function(t){switch(t.label){case 0:return[4,fetch(this.url,e)];case 1:return[2,t.sent()]}}))}))},t}(Ue),Me=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return y(t,e),t.prototype.upload=function(e){return S(this,void 0,void 0,(function(){return _(this,(function(t){switch(t.label){case 0:return[4,this.makeRequest(this.url,e.body)];case 1:return[2,t.sent()]}}))}))},t.prototype.makeRequest=function(e,t){return S(this,void 0,void 0,(function(){var r;return _(this,(function(){return r=new XMLHttpRequest,[2,new Promise((function(n,o){r.onreadystatechange=function(){4!==r.readyState||(200<=r.status&&300>r.status?n(r):o(r))},r.open("post",e),r.send(t)}))]}))}))},t}(Ue);function Ne(e,t){this.uploader=null;var r=this;this.queueEventForBatchUpload=function(t){if(!this.uploader){var r=e._Helpers.getFeatureFlag(v.FeatureFlags.EventBatchingIntervalMillis);this.uploader=new Oe(e,r)}this.uploader.queueEvent(t),e._Persistence.update()},this.processQueuedEvents=function(){var t,n=e.Identity.getCurrentUser();if(n&&(t=n.getMPID()),e._Store.eventQueue.length&&t){var o=e._Store.eventQueue;e._Store.eventQueue=[],this.appendUserInfoToEvents(n,o),o.forEach((function(e){r.sendEventToServer(e)}))}},this.appendUserInfoToEvents=function(t,r){r.forEach((function(r){r.MPID||e._ServerModel.appendUserInfo(t,r)}))},this.sendEventToServer=function(r,n){var o=e._Helpers.extend({shouldUploadEvent:!0},n);if(!e._Store.webviewBridgeEnabled){var i,s=e.Identity.getCurrentUser();return s&&(i=s.getMPID()),e._Store.requireDelay=e._Helpers.isDelayedByIntegration(e._preInit.integrationDelays,e._Store.integrationDelayTimeoutStart,Date.now()),i&&!e._Store.requireDelay&&e._Store.configurationLoaded?(this.processQueuedEvents(),void(de(r)||(o.shouldUploadEvent&&this.queueEventForBatchUpload(r),r.EventName!==f.MessageType.AppStateTransition&&(t&&t.kitBlockingEnabled&&(r=t.createBlockedEvent(r)),r&&e._Forwarders.sendEventToForwarders(r))))):(e.Logger.verbose("Event was added to eventQueue. eventQueue will be processed once a valid MPID is returned or there is no more integration imposed delay."),void e._Store.eventQueue.push(r))}e._NativeSdkHelpers.sendToNative(v.NativeSdkPaths.LogEvent,JSON.stringify(r))},this.sendBatchForwardingStatsToServer=function(t,r){var n,o;try{n=e._Helpers.createServiceUrl(e._Store.SDKConfig.v2SecureServiceUrl,e._Store.devToken),o={uuid:e._Helpers.generateUniqueId(),data:t},r&&(r.open("post",n+"/Forwarding"),r.send(JSON.stringify(o)))}catch(t){e.Logger.error("Error sending forwarding stats to mParticle servers.")}},this.sendSingleForwardingStatsToServer=function(t){var r,n;try{var o=e._Helpers.createXHR((function(){4===o.readyState&&202===o.status&&e.Logger.verbose("Successfully sent  "+o.statusText+" from server")}));r=e._Helpers.createServiceUrl(e._Store.SDKConfig.v1SecureServiceUrl,e._Store.devToken),n=t,o&&(o.open("post",r+"/Forwarding"),o.send(JSON.stringify(n)))}catch(t){e.Logger.error("Error sending forwarding stats to mParticle servers.")}},this.prepareForwardingStats=function(t,n){var o,i=e._Forwarders.getForwarderStatsQueue();t&&t.isVisible&&(o={mid:t.id,esid:t.eventSubscriptionId,n:n.EventName,attrs:n.EventAttributes,sdk:n.SDKVersion,dt:n.EventDataType,et:n.EventCategory,dbg:n.Debug,ct:n.Timestamp,eec:n.ExpandedEventCount,dp:n.DataPlan},e._Helpers.getFeatureFlag(v.FeatureFlags.ReportBatching)?(i.push(o),e._Forwarders.setForwarderStatsQueue(i)):r.sendSingleForwardingStatsToServer(o))}}var Fe={isNumber:ae,isFunction:function(e){return"function"==typeof e},isStringOrNumber:ue,isValidAttributeValue:function(e){return void 0!==e&&!Z(e)&&!Array.isArray(e)},isValidKeyValue:function(e){return!(!e||Z(e)||Array.isArray(e)||this.isFunction(e))},validateIdentities:function(e,t){var r={userIdentities:1,onUserAlias:1,copyUserAttributes:1};if(e){if("modify"===t&&(Z(e.userIdentities)&&!Object.keys(e.userIdentities).length||!Z(e.userIdentities)))return{valid:!1,error:v.Messages.ValidationMessages.ModifyIdentityRequestUserIdentitiesPresent};for(var n in e)if(e.hasOwnProperty(n)){if(!r[n])return{valid:!1,error:v.Messages.ValidationMessages.IdentityRequesetInvalidKey};if("onUserAlias"===n&&!Fe.isFunction(e[n]))return{valid:!1,error:v.Messages.ValidationMessages.OnUserAliasType}}if(0===Object.keys(e).length)return{valid:!0};if(void 0===e.userIdentities)return{valid:!1,error:v.Messages.ValidationMessages.UserIdentities};if(null!==e.userIdentities&&!Z(e.userIdentities))return{valid:!1,error:v.Messages.ValidationMessages.UserIdentities};if(Z(e.userIdentities)&&Object.keys(e.userIdentities).length)for(var o in e.userIdentities)if(e.userIdentities.hasOwnProperty(o)){if(!1===f.IdentityType.getIdentityType(o))return{valid:!1,error:v.Messages.ValidationMessages.UserIdentitiesInvalidKey};if("string"!=typeof e.userIdentities[o]&&null!==e.userIdentities[o])return{valid:!1,error:v.Messages.ValidationMessages.UserIdentitiesInvalidValues}}}return{valid:!0}}},Ve=function(){function e(){}return e.hashEventType=function(e){return Q(e)},e.hashEventName=function(e,t){return Q(t+e)},e.hashEventAttributeKey=function(e,t,r){return Q(e+t+r)},e.hashUserAttribute=function(e){return Q(e)},e.hashUserIdentity=function(e){return e},e.hashConsentPurpose=function(e,t){return Q(e+t)},e.hashAttributeConditionalForwarding=function(e){return Q(e).toString()},e.hashConsentPurposeConditionalForwarding=function(e,t){return this.hashConsentPurpose(e,t).toString()},e}(),Re=v.StorageNames;function He(e){var t=this;this.canLog=function(){return!(!e._Store.isEnabled||!e._Store.devToken&&!e._Store.webviewBridgeEnabled)},this.getFeatureFlag=function(t){return e._Store.SDKConfig.flags.hasOwnProperty(t)?e._Store.SDKConfig.flags[t]:null},this.invokeCallback=function(r,n,o,i,s){r||e.Logger.warning("There is no callback provided");try{t.Validators.isFunction(r)&&r({httpCode:n,body:o,getUser:function(){return i||e.Identity.getCurrentUser()},getPreviousUser:function(){if(!s){var t=e.Identity.getUsers(),r=t.shift(),n=i||e.Identity.getCurrentUser();return r&&n&&r.getMPID()===n.getMPID()&&(r=t.shift()),r||null}return e.Identity.getUser(s)}})}catch(t){e.Logger.error("There was an error with your callback: "+t)}},this.invokeAliasCallback=function(r,n,o){r||e.Logger.warning("There is no callback provided");try{if(t.Validators.isFunction(r)){var i={httpCode:n};o&&(i.message=o),r(i)}}catch(t){e.Logger.error("There was an error with your callback: "+t)}},this.extend=function(){var e,r,n,i,s,a,c=arguments[0]||{},u=1,d=arguments.length,l=!1,g={hasOwn:Object.prototype.hasOwnProperty,class2type:{},type:function(e){return null==e?e+"":g.class2type[Object.prototype.toString.call(e)]||"object"},isPlainObject:function(e){if(!e||"object"!==g.type(e)||e.nodeType||g.isWindow(e))return!1;try{if(e.constructor&&!g.hasOwn.call(e,"constructor")&&!g.hasOwn.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}for(var t in e);return void 0===t||g.hasOwn.call(e,t)},isArray:Array.isArray||function(e){return"array"===g.type(e)},isFunction:function(e){return"function"===g.type(e)},isWindow:function(e){return null!=e&&e==e.window}};for("boolean"==typeof c&&(l=c,c=arguments[1]||{},u=2),"object"===o(c)||g.isFunction(c)||(c={}),d===u&&(c=this,--u);u<d;u++)if(null!=(e=arguments[u]))for(r in e)n=c[r],c!==(i=e[r])&&(l&&i&&(g.isPlainObject(i)||(s=g.isArray(i)))?(s?(s=!1,a=n&&g.isArray(n)?n:[]):a=n&&g.isPlainObject(n)?n:{},c[r]=t.extend(l,a,i)):void 0!==i&&(c[r]=i));return c},this.createServiceUrl=function(t,r){var n,o=window.mParticle&&e._Store.SDKConfig.forceHttps?"https://":window.location.protocol+"//";return n=e._Store.SDKConfig.forceHttps?"https://"+t:o+t,r&&(n+=r),n},this.createXHR=function(t){var r;try{r=new window.XMLHttpRequest}catch(t){e.Logger.error("Error creating XMLHttpRequest object.")}if(r&&t&&"withCredentials"in r)r.onreadystatechange=t;else if(void 0!==window.XDomainRequest){e.Logger.verbose("Creating XDomainRequest object");try{(r=new window.XDomainRequest).onload=t}catch(t){e.Logger.error("Error creating XDomainRequest object")}}return r},this.filterUserIdentities=function(e,r){var n=[];if(e&&Object.keys(e).length)for(var o in e)if(e.hasOwnProperty(o)){var i=f.IdentityType.getIdentityType(o);if(!t.inArray(r,i)){var s={Type:i,Identity:e[o]};i===f.IdentityType.CustomerId?n.unshift(s):n.push(s)}}return n},this.filterUserIdentitiesForForwarders=function(e,r){var n={};if(e&&Object.keys(e).length)for(var o in e)if(e.hasOwnProperty(o)){var i=Ve.hashUserIdentity(f.IdentityType.getIdentityType(o));t.inArray(r,i)||(n[o]=e[o])}return n},this.filterUserAttributes=function(e,r){var n={};if(e&&Object.keys(e).length)for(var o in e)if(e.hasOwnProperty(o)){var i=Ve.hashUserAttribute(o);t.inArray(r,i)||(n[o]=e[o])}return n},this.isFilteredUserAttribute=function(e,r){var n=Ve.hashUserAttribute(e);return r&&t.inArray(r,n)},this.isEventType=function(e){for(var t in f.EventType)if(f.EventType.hasOwnProperty(t)&&f.EventType[t]===e)return!0;return!1},this.sanitizeAttributes=function(r,n){if(!r||!t.isObject(r))return null;var o={};for(var i in r)r.hasOwnProperty(i)&&t.Validators.isValidAttributeValue(r[i])?o[i]=r[i]:e.Logger.warning("For '"+n+"', the corresponding attribute value of '"+i+"' must be a string, number, boolean, or null.");return o},this.isDelayedByIntegration=function(t,r,n){if(n-r>e._Store.SDKConfig.integrationDelayTimeout)return!1;for(var o in t)if(!0===t[o])return!0;return!1},this.createMainStorageName=function(e){return e?Re.currentStorageName+"_"+e:Re.currentStorageName},this.createProductStorageName=function(e){return e?Re.currentStorageProductsName+"_"+e:Re.currentStorageProductsName},this.converted=se,this.findKeyInObject=W,this.parseNumber=X,this.inArray=G,this.isObject=Z,this.decoded=ie,this.returnConvertedBoolean=oe,this.parseStringOrNumber=$,this.generateHash=Q,this.generateUniqueId=Y,this.Validators=Fe}var xe=v.Messages,je="mParticleAndroid",Ke="mParticle";function qe(e){var t=this;this.isBridgeV2Available=function(e){if(!e)return!1;var t=Ke+"_"+e+"_v2";return!!(window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.hasOwnProperty(t))||!(!window.mParticle||!window.mParticle.uiwebviewBridgeName||window.mParticle.uiwebviewBridgeName!==t)||!!window.hasOwnProperty(je+"_"+e+"_v2")},this.isWebviewEnabled=function(r,n){return e._Store.bridgeV2Available=t.isBridgeV2Available(r),e._Store.bridgeV1Available=t.isBridgeV1Available(),2===n?e._Store.bridgeV2Available:!(window.mParticle&&window.mParticle.uiwebviewBridgeName&&window.mParticle.uiwebviewBridgeName!==Ke+"_"+r+"_v2")&&!!(2>n)&&(e._Store.bridgeV2Available||e._Store.bridgeV1Available)},this.isBridgeV1Available=function(){return!!(e._Store.SDKConfig.useNativeSdk||window.mParticleAndroid||e._Store.SDKConfig.isIOS)},this.sendToNative=function(r,n){return e._Store.bridgeV2Available&&2===e._Store.SDKConfig.minWebviewBridgeVersion||e._Store.bridgeV2Available&&2>e._Store.SDKConfig.minWebviewBridgeVersion?void t.sendViaBridgeV2(r,n,e._Store.SDKConfig.requiredWebviewBridgeName):e._Store.bridgeV1Available&&2>e._Store.SDKConfig.minWebviewBridgeVersion?void t.sendViaBridgeV1(r,n):void 0},this.sendViaBridgeV1=function(r,n){window.mParticleAndroid&&window.mParticleAndroid.hasOwnProperty(r)?(e.Logger.verbose(xe.InformationMessages.SendAndroid+r),window.mParticleAndroid[r](n)):e._Store.SDKConfig.isIOS&&(e.Logger.verbose(xe.InformationMessages.SendIOS+r),t.sendViaIframeToIOS(r,n))},this.sendViaIframeToIOS=function(e,t){var r=document.createElement("IFRAME");r.setAttribute("src","mp-sdk://"+e+"/"+encodeURIComponent(t)),document.documentElement.appendChild(r),r.parentNode.removeChild(r)},this.sendViaBridgeV2=function(r,n,o){if(o){var i,s,a=window[je+"_"+o+"_v2"],c=Ke+"_"+o+"_v2";return window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers[c]&&(i=window.webkit.messageHandlers[c]),e.uiwebviewBridgeName===c&&(s=e[c]),a&&a.hasOwnProperty(r)?(e.Logger.verbose(xe.InformationMessages.SendAndroid+r),void a[r](n)):void(i?(e.Logger.verbose(xe.InformationMessages.SendIOS+r),i.postMessage(JSON.stringify({path:r,value:n?JSON.parse(n):null}))):s&&(e.Logger.verbose(xe.InformationMessages.SendIOS+r),t.sendViaIframeToIOS(r,n)))}}}var Be=v.Messages;function ze(e){var t=this;this.attemptCookieSync=function(r,n,o){var i,s,a,c,u,d;n&&!e._Store.webviewBridgeEnabled&&e._Store.pixelConfigurations.forEach((function(l){d=!1,l.filteringConsentRuleValues&&l.filteringConsentRuleValues.values&&l.filteringConsentRuleValues.values.length&&(d=!0),i={moduleId:l.moduleId,frequencyCap:l.frequencyCap,pixelUrl:t.replaceAmp(l.pixelUrl),redirectUrl:l.redirectUrl?t.replaceAmp(l.redirectUrl):null,filteringConsentRuleValues:l.filteringConsentRuleValues},a=t.replaceMPID(i.pixelUrl,n),c=i.redirectUrl?t.replaceMPID(i.redirectUrl,n):"",u=a+encodeURIComponent(c);var g=e._Persistence.getPersistence();return r&&r!==n?void(g&&g[n]&&(!g[n].csd&&(g[n].csd={}),t.performCookieSync(u,i.moduleId,n,g[n].csd,i.filteringConsentRuleValues,o,d))):void(g[n]&&(!g[n].csd&&(g[n].csd={}),s=g[n].csd[i.moduleId.toString()]?g[n].csd[i.moduleId.toString()]:null,s?(new Date).getTime()>new Date(s).getTime()+60*i.frequencyCap*1e3*60*24&&t.performCookieSync(u,i.moduleId,n,g[n].csd,i.filteringConsentRuleValues,o,d):t.performCookieSync(u,i.moduleId,n,g[n].csd,i.filteringConsentRuleValues,o,d)))}))},this.replaceMPID=function(e,t){return e.replace("%%mpid%%",t)},this.replaceAmp=function(e){return e.replace(/&amp;/g,"&")},this.performCookieSync=function(t,r,n,o,i,s,a){if((!a||!s)&&e._Consent.isEnabledForUserConsent(i,e.Identity.getCurrentUser())){var c=document.createElement("img");e.Logger.verbose(Be.InformationMessages.CookieSync),c.onload=function(){o[r.toString()]=(new Date).getTime(),e._Persistence.saveUserCookieSyncDatesToPersistence(n,o)},c.src=t}}}var Ge=v.Messages;function We(e){function t(){e._Store.sessionId=null,e._Store.dateLastEventSent=null,e._Store.sessionAttributes={},e._Persistence.update()}var r=this;this.initialize=function(){if(e._Store.sessionId){var t=6e4*e._Store.SDKConfig.sessionTimeout;if(new Date>new Date(e._Store.dateLastEventSent.getTime()+t))r.endSession(),r.startNewSession();else{var n=e._Persistence.getPersistence();n&&!n.cu&&(e.Identity.identify(e._Store.SDKConfig.identifyRequest,e._Store.SDKConfig.identityCallback),e._Store.identifyCalled=!0,e._Store.SDKConfig.identityCallback=null)}}else r.startNewSession()},this.getSession=function(){return e.Logger.warning(J("SessionManager.getSession()","SessionManager.getSessionId()")),this.getSessionId()},this.getSessionId=function(){return e._Store.sessionId},this.startNewSession=function(){if(e.Logger.verbose(Ge.InformationMessages.StartingNewSession),e._Helpers.canLog()){e._Store.sessionId=e._Helpers.generateUniqueId().toUpperCase();var t=e.Identity.getCurrentUser(),n=t?t.getMPID():null;if(n&&(e._Store.currentSessionMPIDs=[n]),!e._Store.sessionStartDate){var o=new Date;e._Store.sessionStartDate=o,e._Store.dateLastEventSent=o}r.setSessionTimer(),e._Store.identifyCalled||(e.Identity.identify(e._Store.SDKConfig.identifyRequest,e._Store.SDKConfig.identityCallback),e._Store.identifyCalled=!0,e._Store.SDKConfig.identityCallback=null),e._Events.logEvent({messageType:f.MessageType.SessionStart})}else e.Logger.verbose(Ge.InformationMessages.AbandonStartSession)},this.endSession=function(n){var o;if(e.Logger.verbose(Ge.InformationMessages.StartingEndSession),n)return e._Events.logEvent({messageType:f.MessageType.SessionEnd}),void t();if(e._Helpers.canLog()){var i,s=e._Persistence.getPersistence();if(s){if(s.gs&&!s.gs.sid)return void e.Logger.verbose(Ge.InformationMessages.NoSessionToEnd);if(s.gs.sid&&e._Store.sessionId!==s.gs.sid&&(e._Store.sessionId=s.gs.sid),null===(o=null==s?void 0:s.gs)||void 0===o?void 0:o.les)i=6e4*e._Store.SDKConfig.sessionTimeout,(new Date).getTime()-s.gs.les<i?r.setSessionTimer():(e._Events.logEvent({messageType:f.MessageType.SessionEnd}),e._Store.sessionStartDate=null,t())}}else e.Logger.verbose(Ge.InformationMessages.AbandonEndSession)},this.setSessionTimer=function(){var t=6e4*e._Store.SDKConfig.sessionTimeout;e._Store.globalTimer=window.setTimeout((function(){r.endSession()}),t)},this.resetSessionTimer=function(){e._Store.webviewBridgeEnabled||(!e._Store.sessionId&&r.startNewSession(),r.clearSessionTimeout(),r.setSessionTimer()),r.startNewSessionIfNeeded()},this.clearSessionTimeout=function(){clearTimeout(e._Store.globalTimer)},this.startNewSessionIfNeeded=function(){if(!e._Store.webviewBridgeEnabled){var t=e._Persistence.getPersistence();!e._Store.sessionId&&t&&(t.sid?e._Store.sessionId=t.sid:r.startNewSession())}}}var Je=v.Messages;function Qe(e){var t=this;this.convertTransactionAttributesToProductAction=function(e,t){e.hasOwnProperty("Id")&&(t.TransactionId=e.Id),e.hasOwnProperty("Affiliation")&&(t.Affiliation=e.Affiliation),e.hasOwnProperty("CouponCode")&&(t.CouponCode=e.CouponCode),e.hasOwnProperty("Revenue")&&(t.TotalAmount=this.sanitizeAmount(e.Revenue,"Revenue")),e.hasOwnProperty("Shipping")&&(t.ShippingAmount=this.sanitizeAmount(e.Shipping,"Shipping")),e.hasOwnProperty("Tax")&&(t.TaxAmount=this.sanitizeAmount(e.Tax,"Tax")),e.hasOwnProperty("Step")&&(t.CheckoutStep=e.Step),e.hasOwnProperty("Option")&&(t.CheckoutOptions=e.Option)},this.getProductActionEventName=function(e){switch(e){case f.ProductActionType.AddToCart:return"AddToCart";case f.ProductActionType.AddToWishlist:return"AddToWishlist";case f.ProductActionType.Checkout:return"Checkout";case f.ProductActionType.CheckoutOption:return"CheckoutOption";case f.ProductActionType.Click:return"Click";case f.ProductActionType.Purchase:return"Purchase";case f.ProductActionType.Refund:return"Refund";case f.ProductActionType.RemoveFromCart:return"RemoveFromCart";case f.ProductActionType.RemoveFromWishlist:return"RemoveFromWishlist";case f.ProductActionType.ViewDetail:return"ViewDetail";case f.ProductActionType.Unknown:default:return"Unknown"}},this.getPromotionActionEventName=function(e){return e===f.PromotionActionType.PromotionClick?"PromotionClick":e===f.PromotionActionType.PromotionView?"PromotionView":"Unknown"},this.convertProductActionToEventType=function(t){return t===f.ProductActionType.AddToCart?f.CommerceEventType.ProductAddToCart:t===f.ProductActionType.AddToWishlist?f.CommerceEventType.ProductAddToWishlist:t===f.ProductActionType.Checkout?f.CommerceEventType.ProductCheckout:t===f.ProductActionType.CheckoutOption?f.CommerceEventType.ProductCheckoutOption:t===f.ProductActionType.Click?f.CommerceEventType.ProductClick:t===f.ProductActionType.Purchase?f.CommerceEventType.ProductPurchase:t===f.ProductActionType.Refund?f.CommerceEventType.ProductRefund:t===f.ProductActionType.RemoveFromCart?f.CommerceEventType.ProductRemoveFromCart:t===f.ProductActionType.RemoveFromWishlist?f.CommerceEventType.ProductRemoveFromWishlist:t===f.ProductActionType.Unknown?f.EventType.Unknown:t===f.ProductActionType.ViewDetail?f.CommerceEventType.ProductViewDetail:(e.Logger.error("Could not convert product action type "+t+" to event type"),null)},this.convertPromotionActionToEventType=function(t){return t===f.PromotionActionType.PromotionClick?f.CommerceEventType.PromotionClick:t===f.PromotionActionType.PromotionView?f.CommerceEventType.PromotionView:(e.Logger.error("Could not convert promotion action type "+t+" to event type"),null)},this.generateExpandedEcommerceName=function(e,t){return"eCommerce - "+e+" - "+(t?"Total":"Item")},this.extractProductAttributes=function(e,t){t.CouponCode&&(e["Coupon Code"]=t.CouponCode),t.Brand&&(e.Brand=t.Brand),t.Category&&(e.Category=t.Category),t.Name&&(e.Name=t.Name),t.Sku&&(e.Id=t.Sku),t.Price&&(e["Item Price"]=t.Price),t.Quantity&&(e.Quantity=t.Quantity),t.Position&&(e.Position=t.Position),t.Variant&&(e.Variant=t.Variant),e["Total Product Amount"]=t.TotalAmount||0},this.extractTransactionId=function(e,t){t.TransactionId&&(e["Transaction Id"]=t.TransactionId)},this.extractActionAttributes=function(e,r){t.extractTransactionId(e,r),r.Affiliation&&(e.Affiliation=r.Affiliation),r.CouponCode&&(e["Coupon Code"]=r.CouponCode),r.TotalAmount&&(e["Total Amount"]=r.TotalAmount),r.ShippingAmount&&(e["Shipping Amount"]=r.ShippingAmount),r.TaxAmount&&(e["Tax Amount"]=r.TaxAmount),r.CheckoutOptions&&(e["Checkout Options"]=r.CheckoutOptions),r.CheckoutStep&&(e["Checkout Step"]=r.CheckoutStep)},this.extractPromotionAttributes=function(e,t){t.Id&&(e.Id=t.Id),t.Creative&&(e.Creative=t.Creative),t.Name&&(e.Name=t.Name),t.Position&&(e.Position=t.Position)},this.buildProductList=function(e,t){return t?Array.isArray(t)?t:[t]:e.ShoppingCart.ProductList},this.createProduct=function(t,r,n,o,i,s,a,c,u,d){return d=e._Helpers.sanitizeAttributes(d,t),"string"!=typeof t?(e.Logger.error("Name is required when creating a product"),null):e._Helpers.Validators.isStringOrNumber(r)?e._Helpers.Validators.isStringOrNumber(n)?(n=e._Helpers.parseNumber(n),c&&!e._Helpers.Validators.isNumber(c)&&(e.Logger.error("Position must be a number, it will be set to null."),c=null),{Name:t,Sku:r,Price:n,Quantity:o=e._Helpers.Validators.isStringOrNumber(o)?e._Helpers.parseNumber(o):1,Brand:a,Variant:i,Category:s,Position:c,CouponCode:u,TotalAmount:o*n,Attributes:d}):(e.Logger.error("Price is required when creating a product, and must be a string or a number"),null):(e.Logger.error("SKU is required when creating a product, and must be a string or a number"),null)},this.createPromotion=function(t,r,n,o){return e._Helpers.Validators.isStringOrNumber(t)?{Id:t,Creative:r,Name:n,Position:o}:(e.Logger.error(Je.ErrorMessages.PromotionIdRequired),null)},this.createImpression=function(t,r){return"string"==typeof t?r?{Name:t,Product:r}:(e.Logger.error("Product is required when creating an impression."),null):(e.Logger.error("Name is required when creating an impression."),null)},this.createTransactionAttributes=function(t,r,n,o,i,s){return e._Helpers.Validators.isStringOrNumber(t)?{Id:t,Affiliation:r,CouponCode:n,Revenue:o,Shipping:i,Tax:s}:(e.Logger.error(Je.ErrorMessages.TransactionIdRequired),null)},this.expandProductImpression=function(r){var n=[];return r.ProductImpressions?(r.ProductImpressions.forEach((function(o){o.ProductList&&o.ProductList.forEach((function(i){var s=e._Helpers.extend(!1,{},r.EventAttributes);if(i.Attributes)for(var a in i.Attributes)s[a]=i.Attributes[a];t.extractProductAttributes(s,i),o.ProductImpressionList&&(s["Product Impression List"]=o.ProductImpressionList);var c=e._ServerModel.createEventObject({messageType:f.MessageType.PageEvent,name:t.generateExpandedEcommerceName("Impression"),data:s,eventType:f.EventType.Transaction});n.push(c)}))})),n):n},this.expandCommerceEvent=function(e){return e?t.expandProductAction(e).concat(t.expandPromotionAction(e)).concat(t.expandProductImpression(e)):null},this.expandPromotionAction=function(r){var n=[];return r.PromotionAction?(r.PromotionAction.PromotionList.forEach((function(o){var i=e._Helpers.extend(!1,{},r.EventAttributes);t.extractPromotionAttributes(i,o);var s=e._ServerModel.createEventObject({messageType:f.MessageType.PageEvent,name:t.generateExpandedEcommerceName(f.PromotionActionType.getExpansionName(r.PromotionAction.PromotionActionType)),data:i,eventType:f.EventType.Transaction});n.push(s)})),n):n},this.expandProductAction=function(r){var n=[];if(!r.ProductAction)return n;var o=!1;if(r.ProductAction.ProductActionType===f.ProductActionType.Purchase||r.ProductAction.ProductActionType===f.ProductActionType.Refund){var i=e._Helpers.extend(!1,{},r.EventAttributes);i["Product Count"]=r.ProductAction.ProductList?r.ProductAction.ProductList.length:0,t.extractActionAttributes(i,r.ProductAction),r.CurrencyCode&&(i["Currency Code"]=r.CurrencyCode);var s=e._ServerModel.createEventObject({messageType:f.MessageType.PageEvent,name:t.generateExpandedEcommerceName(f.ProductActionType.getExpansionName(r.ProductAction.ProductActionType),!0),data:i,eventType:f.EventType.Transaction});n.push(s)}else o=!0;var a=r.ProductAction.ProductList;return a?(a.forEach((function(i){var s=e._Helpers.extend(!1,r.EventAttributes,i.Attributes);o?t.extractActionAttributes(s,r.ProductAction):t.extractTransactionId(s,r.ProductAction),t.extractProductAttributes(s,i);var a=e._ServerModel.createEventObject({messageType:f.MessageType.PageEvent,name:t.generateExpandedEcommerceName(f.ProductActionType.getExpansionName(r.ProductAction.ProductActionType)),data:s,eventType:f.EventType.Transaction});n.push(a)})),n):n},this.createCommerceEventObject=function(t){var r;return e.Logger.verbose(Je.InformationMessages.StartingLogCommerceEvent),e._Helpers.canLog()?((r=e._ServerModel.createEventObject({messageType:f.MessageType.Commerce})).EventName="eCommerce - ",r.CurrencyCode=e._Store.currencyCode,r.ShoppingCart=[],r.CustomFlags=t,r):(e.Logger.verbose(Je.InformationMessages.AbandonLogEvent),null)},this.sanitizeAmount=function(t,r){if(!e._Helpers.Validators.isStringOrNumber(t)){var n=[r,"must be of type number. A",o(t),"was passed. Converting to 0"].join(" ");return e.Logger.warning(n),0}return e._Helpers.parseNumber(t)}}function Ye(e,t){var r={isEnabled:!0,sessionAttributes:{},currentSessionMPIDs:[],consentState:null,sessionId:null,isFirstRun:null,clientId:null,deviceId:null,devToken:null,serverSettings:{},dateLastEventSent:null,sessionStartDate:null,currentPosition:null,isTracking:!1,watchPositionId:null,cartProducts:[],eventQueue:[],currencyCode:null,globalTimer:null,context:null,configurationLoaded:!1,identityCallInFlight:!1,SDKConfig:{},nonCurrentUserMPIDs:{},identifyCalled:!1,isLoggedIn:!1,cookieSyncDates:{},integrationAttributes:{},requireDelay:!0,isLocalStorageAvailable:null,storageName:null,prodStorageName:null,activeForwarders:[],kits:{},sideloadedKits:[],configuredForwarders:[],pixelConfigurations:[],wrapperSDKInfo:{name:"none",version:null,isInfoSet:!1}};for(var n in r)this[n]=r[n];if(this.integrationDelayTimeoutStart=Date.now(),this.SDKConfig=function(e){var t={};for(var r in v.DefaultConfig)v.DefaultConfig.hasOwnProperty(r)&&(t[r]=v.DefaultConfig[r]);if(e)for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);for(var r in v.DefaultUrls)t[r]=v.DefaultUrls[r];return t}(e),e){if(e.deviceId&&(this.deviceId=e.deviceId),this.SDKConfig.isDevelopmentMode=!!e.hasOwnProperty("isDevelopmentMode")&&t._Helpers.returnConvertedBoolean(e.isDevelopmentMode),e.hasOwnProperty("v1SecureServiceUrl")&&(this.SDKConfig.v1SecureServiceUrl=e.v1SecureServiceUrl),e.hasOwnProperty("v2SecureServiceUrl")&&(this.SDKConfig.v2SecureServiceUrl=e.v2SecureServiceUrl),e.hasOwnProperty("v3SecureServiceUrl")&&(this.SDKConfig.v3SecureServiceUrl=e.v3SecureServiceUrl),e.hasOwnProperty("identityUrl")&&(this.SDKConfig.identityUrl=e.identityUrl),e.hasOwnProperty("aliasUrl")&&(this.SDKConfig.aliasUrl=e.aliasUrl),e.hasOwnProperty("configUrl")&&(this.SDKConfig.configUrl=e.configUrl),e.hasOwnProperty("logLevel")&&(this.SDKConfig.logLevel=e.logLevel),this.SDKConfig.useNativeSdk=!!e.useNativeSdk,this.SDKConfig.kits=e.kits||{},this.SDKConfig.sideloadedKits=e.sideloadedKits||[],this.SDKConfig.isIOS=e.hasOwnProperty("isIOS")?e.isIOS:!(!window.mParticle||!window.mParticle.isIOS)&&window.mParticle.isIOS,this.SDKConfig.useCookieStorage=!!e.hasOwnProperty("useCookieStorage")&&e.useCookieStorage,this.SDKConfig.maxProducts=e.hasOwnProperty("maxProducts")?e.maxProducts:v.DefaultConfig.maxProducts,this.SDKConfig.maxCookieSize=e.hasOwnProperty("maxCookieSize")?e.maxCookieSize:v.DefaultConfig.maxCookieSize,e.hasOwnProperty("appName")&&(this.SDKConfig.appName=e.appName),e.hasOwnProperty("package")&&(this.SDKConfig.package=e.package),this.SDKConfig.integrationDelayTimeout=e.hasOwnProperty("integrationDelayTimeout")?e.integrationDelayTimeout:v.DefaultConfig.integrationDelayTimeout,e.hasOwnProperty("identifyRequest")&&(this.SDKConfig.identifyRequest=e.identifyRequest),e.hasOwnProperty("identityCallback")){var i=e.identityCallback;t._Helpers.Validators.isFunction(i)?this.SDKConfig.identityCallback=e.identityCallback:t.Logger.warning("The optional callback must be a function. You tried entering a(n) "+o(i)+" . Callback not set. Please set your callback again.")}if(e.hasOwnProperty("appVersion")&&(this.SDKConfig.appVersion=e.appVersion),e.hasOwnProperty("appName")&&(this.SDKConfig.appName=e.appName),e.hasOwnProperty("sessionTimeout")&&(this.SDKConfig.sessionTimeout=e.sessionTimeout),e.hasOwnProperty("dataPlan")){this.SDKConfig.dataPlan={PlanVersion:null,PlanId:null};var s=e.dataPlan;s.planId&&(ce(s.planId)?this.SDKConfig.dataPlan.PlanId=s.planId:t.Logger.error("Your data plan id must be a string and match the data plan slug format (i.e. under_case_slug)")),s.planVersion&&(ae(s.planVersion)?this.SDKConfig.dataPlan.PlanVersion=s.planVersion:t.Logger.error("Your data plan version must be a number"))}else this.SDKConfig.dataPlan={};if(this.SDKConfig.forceHttps=!e.hasOwnProperty("forceHttps")||e.forceHttps,this.SDKConfig.customFlags=e.customFlags||{},this.SDKConfig.minWebviewBridgeVersion=e.hasOwnProperty("minWebviewBridgeVersion")?e.minWebviewBridgeVersion:1,this.SDKConfig.aliasMaxWindow=e.hasOwnProperty("aliasMaxWindow")?e.aliasMaxWindow:v.DefaultConfig.aliasMaxWindow,e.hasOwnProperty("dataPlanOptions")){var a=e.dataPlanOptions;a.hasOwnProperty("dataPlanVersion")&&a.hasOwnProperty("blockUserAttributes")&&a.hasOwnProperty("blockEventAttributes")&&a.hasOwnProperty("blockEvents")&&a.hasOwnProperty("blockUserIdentities")||t.Logger.error('Ensure your config.dataPlanOptions object has the following keys: a "dataPlanVersion" object, and "blockUserAttributes", "blockEventAttributes", "blockEvents", "blockUserIdentities" booleans')}e.hasOwnProperty("onCreateBatch")&&("function"==typeof e.onCreateBatch?this.SDKConfig.onCreateBatch=e.onCreateBatch:(t.Logger.error("config.onCreateBatch must be a function"),this.SDKConfig.onCreateBatch=void 0)),e.hasOwnProperty("flags")||(this.SDKConfig.flags={}),this.SDKConfig.flags.hasOwnProperty(v.FeatureFlags.EventBatchingIntervalMillis)||(this.SDKConfig.flags[v.FeatureFlags.EventBatchingIntervalMillis]=v.DefaultConfig.uploadInterval),this.SDKConfig.flags.hasOwnProperty(v.FeatureFlags.ReportBatching)||(this.SDKConfig.flags[v.FeatureFlags.ReportBatching]=!1),this.SDKConfig.flags.hasOwnProperty(v.FeatureFlags.OfflineStorage)||(this.SDKConfig.flags[v.FeatureFlags.OfflineStorage]=0)}}function Ze(e){var t=this,r=e.logLevel||"warning";this.logger=e.hasOwnProperty("logger")?e.logger:new Xe,this.verbose=function(e){"none"!==r&&t.logger.verbose&&"verbose"===r&&t.logger.verbose(e)},this.warning=function(e){"none"!==r&&t.logger.warning&&("verbose"===r||"warning"===r)&&t.logger.warning(e)},this.error=function(e){"none"!==r&&t.logger.error&&t.logger.error(e)},this.setLogLevel=function(e){r=e}}function Xe(){this.verbose=function(e){console&&console.info&&console.info(e)},this.error=function(e){console&&console.error&&console.error(e)},this.warning=function(e){console&&console.warn&&console.warn(e)}}var $e=n.Base64,et=v.Messages,tt=v.Base64CookieKeys,rt=v.SDKv2NonMPIDCookieKeys,nt=v.StorageNames;function ot(e){function t(t){var r=e._Store;return t.gs.sid=r.sessionId,t.gs.ie=r.isEnabled,t.gs.sa=r.sessionAttributes,t.gs.ss=r.serverSettings,t.gs.dt=r.devToken,t.gs.les=r.dateLastEventSent?r.dateLastEventSent.getTime():null,t.gs.av=r.SDKConfig.appVersion,t.gs.cgid=r.clientId,t.gs.das=r.deviceId,t.gs.c=r.context,t.gs.ssd=r.sessionStartDate?r.sessionStartDate.getTime():0,t.gs.ia=r.integrationAttributes,t}function r(e){localStorage.removeItem(e)}function n(e,t,r){return o.encodePersistence(JSON.stringify(e))+";expires="+t+";path=/"+r}var o=this;this.useLocalStorage=function(){return!e._Store.SDKConfig.useCookieStorage&&e._Store.isLocalStorageAvailable},this.initializeStorage=function(){try{var t,r,n=o.getLocalStorage(),i=o.getCookie();n||i?e._Store.isFirstRun=!1:(e._Store.isFirstRun=!0,e._Store.mpid=0),e._Store.isLocalStorageAvailable||(e._Store.SDKConfig.useCookieStorage=!0),e._Store.isLocalStorageAvailable?(t=window.localStorage,e._Store.SDKConfig.useCookieStorage?(n?(r=i?e._Helpers.extend(!1,n,i):n,t.removeItem(e._Store.storageName)):i&&(r=i),o.storeDataInMemory(r)):i?(r=n?e._Helpers.extend(!1,n,i):i,o.storeDataInMemory(r),o.expireCookies(e._Store.storageName)):o.storeDataInMemory(n)):o.storeDataInMemory(i);try{if(e._Store.isLocalStorageAvailable){var s=localStorage.getItem(e._Store.prodStorageName);if(s)var a=JSON.parse($e.decode(s));e._Store.mpid&&o.storeProductsInMemory(a,e._Store.mpid)}}catch(t){e._Store.isLocalStorageAvailable&&localStorage.removeItem(e._Store.prodStorageName),e._Store.cartProducts=[],e.Logger.error("Error loading products in initialization: "+t)}for(var c in r)r.hasOwnProperty(c)&&(rt[c]||(e._Store.nonCurrentUserMPIDs[c]=r[c]));o.update()}catch(t){o.useLocalStorage()&&e._Store.isLocalStorageAvailable?localStorage.removeItem(e._Store.storageName):o.expireCookies(e._Store.storageName),e.Logger.error("Error initializing storage: "+t)}},this.update=function(){e._Store.webviewBridgeEnabled||(e._Store.SDKConfig.useCookieStorage&&o.setCookie(),o.setLocalStorage())},this.storeProductsInMemory=function(t,r){if(t)try{e._Store.cartProducts=t[r]&&t[r].cp?t[r].cp:[]}catch(t){e.Logger.error(et.ErrorMessages.CookieParseError)}},this.storeDataInMemory=function(t,r){try{t?(e._Store.mpid=r||(t.cu||0),t.gs=t.gs||{},e._Store.sessionId=t.gs.sid||e._Store.sessionId,e._Store.isEnabled=void 0===t.gs.ie?e._Store.isEnabled:t.gs.ie,e._Store.sessionAttributes=t.gs.sa||e._Store.sessionAttributes,e._Store.serverSettings=t.gs.ss||e._Store.serverSettings,e._Store.devToken=e._Store.devToken||t.gs.dt,e._Store.SDKConfig.appVersion=e._Store.SDKConfig.appVersion||t.gs.av,e._Store.clientId=t.gs.cgid||e._Store.clientId||e._Helpers.generateUniqueId(),e._Store.deviceId=e._Store.deviceId||t.gs.das||e._Helpers.generateUniqueId(),e._Store.integrationAttributes=t.gs.ia||{},e._Store.context=t.gs.c||e._Store.context,e._Store.currentSessionMPIDs=t.gs.csm||e._Store.currentSessionMPIDs,e._Store.isLoggedIn=!0===t.l,t.gs.les&&(e._Store.dateLastEventSent=new Date(t.gs.les)),e._Store.sessionStartDate=t.gs.ssd?new Date(t.gs.ssd):new Date,t=r?t[r]:t[t.cu]):(e.Logger.verbose(et.InformationMessages.CookieNotFound),e._Store.clientId=e._Store.clientId||e._Helpers.generateUniqueId(),e._Store.deviceId=e._Store.deviceId||e._Helpers.generateUniqueId())}catch(t){e.Logger.error(et.ErrorMessages.CookieParseError)}},this.determineLocalStorageAvailability=function(e){var t;window.mParticle&&window.mParticle._forceNoLocalStorage&&(e=void 0);try{return e.setItem("mparticle","test"),t="test"===e.getItem("mparticle"),e.removeItem("mparticle"),t&&e}catch(e){return!1}},this.getUserProductsFromLS=function(t){if(!e._Store.isLocalStorageAvailable)return[];var r,n,o=localStorage.getItem(e._Store.prodStorageName);if(o&&(r=$e.decode(o)),!t)return[];try{return r&&(n=JSON.parse(r)),r&&n[t]&&n[t].cp&&Array.isArray(n[t].cp)?n[t].cp:[]}catch(e){return[]}},this.getAllUserProductsFromLS=function(){var t,r,n=localStorage.getItem(e._Store.prodStorageName);n&&(t=$e.decode(n));try{r=JSON.parse(t)}catch(e){r={}}return r},this.setLocalStorage=function(){if(e._Store.isLocalStorageAvailable){var r=e._Store.storageName,n=o.getAllUserProductsFromLS(),i=o.getLocalStorage()||{},s=e.Identity.getCurrentUser(),a=s?s.getMPID():null,c={cp:n[a]?n[a].cp:[]};if(a){(n=n||{})[a]=c;try{window.localStorage.setItem(encodeURIComponent(e._Store.prodStorageName),$e.encode(JSON.stringify(n)))}catch(t){e.Logger.error("Error with setting products on localStorage.")}}if(!e._Store.SDKConfig.useCookieStorage){i.gs=i.gs||{},i.l=e._Store.isLoggedIn?1:0,e._Store.sessionId&&(i.gs.csm=e._Store.currentSessionMPIDs),i.gs.ie=e._Store.isEnabled,a&&(i.cu=a),Object.keys(e._Store.nonCurrentUserMPIDs).length&&(i=e._Helpers.extend({},i,e._Store.nonCurrentUserMPIDs),e._Store.nonCurrentUserMPIDs={}),i=t(i);try{window.localStorage.setItem(encodeURIComponent(r),o.encodePersistence(JSON.stringify(i)))}catch(t){e.Logger.error("Error with setting localStorage item.")}}}},this.getLocalStorage=function(){if(!e._Store.isLocalStorageAvailable)return null;var t,r=e._Store.storageName,n=o.decodePersistence(window.localStorage.getItem(r)),i={};if(n)for(t in n=JSON.parse(n))n.hasOwnProperty(t)&&(i[t]=n[t]);return Object.keys(i).length?i:null},this.expireCookies=function(e){var t,r,n,i=new Date;r=""===(n=o.getCookieDomain())?"":";domain="+n,i.setTime(i.getTime()-864e5),t="; expires="+i.toUTCString(),document.cookie=e+"="+t+"; path=/"+r},this.getCookie=function(){var t,r,n,i,s,a=window.document.cookie.split("; "),c=e._Store.storageName,u=c?void 0:{};for(e.Logger.verbose(et.InformationMessages.CookieSearch),t=0,r=a.length;t<r;t++){try{i=(n=a[t].split("=")).shift(),s=n.join("=")}catch(t){e.Logger.verbose("Unable to parse cookie: "+i+". Skipping.")}if(c&&c===i){u=e._Helpers.converted(s);break}c||(u[i]=e._Helpers.converted(s))}return u?(e.Logger.verbose(et.InformationMessages.CookieFound),JSON.parse(o.decodePersistence(u))):null},this.setCookie=function(){var r,n=e.Identity.getCurrentUser();n&&(r=n.getMPID());var i,s,a,c=new Date,u=e._Store.storageName,d=o.getCookie()||{},l=new Date(c.getTime()+24*e._Store.SDKConfig.cookieExpiration*60*60*1e3).toGMTString();s=""===(i=o.getCookieDomain())?"":";domain="+i,d.gs=d.gs||{},e._Store.sessionId&&(d.gs.csm=e._Store.currentSessionMPIDs),r&&(d.cu=r),d.l=e._Store.isLoggedIn?1:0,d=t(d),Object.keys(e._Store.nonCurrentUserMPIDs).length&&(d=e._Helpers.extend({},d,e._Store.nonCurrentUserMPIDs),e._Store.nonCurrentUserMPIDs={}),a=o.reduceAndEncodePersistence(d,l,s,e._Store.SDKConfig.maxCookieSize),e.Logger.verbose(et.InformationMessages.CookieSet),window.document.cookie=encodeURIComponent(u)+"="+a},this.reduceAndEncodePersistence=function(t,r,o,i){var s,a=t.gs.csm?t.gs.csm:[];if(a.length){var c={};for(var u in t)t.hasOwnProperty(u)&&(rt[u]||u===t.cu||(c[u]=1));if(Object.keys(c).length)for(var d in c)(s=n(t,r,o)).length>i&&c.hasOwnProperty(d)&&-1===a.indexOf(d)&&delete t[d];for(var l,g=0;g<a.length&&(s=n(t,r,o)).length>i;g++)t[l=a[g]]?(e.Logger.verbose("Size of new encoded cookie is larger than maxCookieSize setting of "+i+". Removing from cookie the earliest logged in MPID containing: "+JSON.stringify(t[l],0,2)),delete t[l]):e.Logger.error("Unable to save MPID data to cookies because the resulting encoded cookie is larger than the maxCookieSize setting of "+i+". We recommend using a maxCookieSize of 1500.")}else for(var p in t)t.hasOwnProperty(p)&&((s=n(t,r,o)).length>i&&!rt[p]&&p!==t.cu&&delete t[p]);return s},this.findPrevCookiesBasedOnUI=function(t){var r,n=e._Persistence.getPersistence();if(t)for(var i in t.userIdentities)if(n&&Object.keys(n).length)for(var s in n)if(n[s].mpid){var a=n[s].ui;for(var c in a)if(i===c&&t.userIdentities[i]===a[c]){r=s;break}}r&&o.storeDataInMemory(n,r)},this.encodePersistence=function(t){for(var r in(t=JSON.parse(t)).gs)t.gs.hasOwnProperty(r)&&(tt[r]?t.gs[r]&&(Array.isArray(t.gs[r])&&t.gs[r].length||e._Helpers.isObject(t.gs[r])&&Object.keys(t.gs[r]).length)?t.gs[r]=$e.encode(JSON.stringify(t.gs[r])):delete t.gs[r]:"ie"===r?t.gs[r]=t.gs[r]?1:0:!t.gs[r]&&delete t.gs[r]);for(var n in t)if(t.hasOwnProperty(n)&&!rt[n])for(r in t[n])t[n].hasOwnProperty(r)&&tt[r]&&(e._Helpers.isObject(t[n][r])&&Object.keys(t[n][r]).length?t[n][r]=$e.encode(JSON.stringify(t[n][r])):delete t[n][r]);return B(JSON.stringify(t))},this.decodePersistence=function(t){try{if(t){if(t=JSON.parse(z(t)),e._Helpers.isObject(t)&&Object.keys(t).length){for(var r in t.gs)t.gs.hasOwnProperty(r)&&(tt[r]?t.gs[r]=JSON.parse($e.decode(t.gs[r])):"ie"===r&&(t.gs[r]=!!t.gs[r]));for(var n in t)if(t.hasOwnProperty(n))if(rt[n])"l"===n&&(t[n]=!!t[n]);else for(r in t[n])t[n].hasOwnProperty(r)&&tt[r]&&t[n][r].length&&(t[n][r]=JSON.parse($e.decode(t[n][r])))}return JSON.stringify(t)}}catch(t){e.Logger.error("Problem with decoding cookie",t)}},this.getCookieDomain=function(){if(e._Store.SDKConfig.cookieDomain)return e._Store.SDKConfig.cookieDomain;var t=o.getDomain(document,location.hostname);return""===t?"":"."+t},this.getDomain=function(e,t){var r,n,o=t.split(".");for(r=o.length-1;0<=r;r--)if(n=o.slice(r).join("."),e.cookie="mptest=cookie;domain=."+n+";",-1<e.cookie.indexOf("mptest=cookie"))return e.cookie="mptest=;domain=."+n+";expires=Thu, 01 Jan 1970 00:00:01 GMT;",n;return""},this.getUserIdentities=function(e){var t=o.getPersistence();return t&&t[e]&&t[e].ui?t[e].ui:{}},this.getAllUserAttributes=function(e){var t=o.getPersistence();return t&&t[e]&&t[e].ua?t[e].ua:{}},this.getCartProducts=function(t){var r,n=localStorage.getItem(e._Store.prodStorageName);return n&&((r=JSON.parse($e.decode(n)))&&r[t]&&r[t].cp)?r[t].cp:[]},this.setCartProducts=function(t){if(e._Store.isLocalStorageAvailable)try{window.localStorage.setItem(encodeURIComponent(e._Store.prodStorageName),$e.encode(JSON.stringify(t)))}catch(t){e.Logger.error("Error with setting products on localStorage.")}},this.saveUserIdentitiesToPersistence=function(e,t){if(t){var r=o.getPersistence();r&&(r[e]?r[e].ui=t:r[e]={ui:t},o.savePersistence(r))}},this.saveUserAttributesToPersistence=function(e,t){var r=o.getPersistence();t&&(r&&(r[e]?r[e].ui=t:r[e]={ui:t}),o.savePersistence(r))},this.saveUserCookieSyncDatesToPersistence=function(e,t){if(t){var r=o.getPersistence();r&&(r[e]?r[e].csd=t:r[e]={csd:t}),o.savePersistence(r)}},this.saveUserConsentStateToCookies=function(t,r){if(r||null===r){var n=o.getPersistence();n&&(n[t]?n[t].con=e._Consent.ConsentSerialization.toMinifiedJsonObject(r):n[t]={con:e._Consent.ConsentSerialization.toMinifiedJsonObject(r)},o.savePersistence(n))}},this.savePersistence=function(t){var r,n=o.encodePersistence(JSON.stringify(t)),i=new Date,s=e._Store.storageName,a=new Date(i.getTime()+24*e._Store.SDKConfig.cookieExpiration*60*60*1e3).toGMTString(),c=o.getCookieDomain();if(r=""===c?"":";domain="+c,e._Store.SDKConfig.useCookieStorage){var u=o.reduceAndEncodePersistence(t,a,r,e._Store.SDKConfig.maxCookieSize);window.document.cookie=encodeURIComponent(s)+"="+u}else e._Store.isLocalStorageAvailable&&localStorage.setItem(e._Store.storageName,n)},this.getPersistence=function(){return this.useLocalStorage()?this.getLocalStorage():this.getCookie()},this.getConsentState=function(t){var r=o.getPersistence();return r&&r[t]&&r[t].con?e._Consent.ConsentSerialization.fromMinifiedJsonObject(r[t].con):null},this.getFirstSeenTime=function(e){if(!e)return null;var t=o.getPersistence();return t&&t[e]&&t[e].fst?t[e].fst:null},this.setFirstSeenTime=function(e,t){if(e){t||(t=(new Date).getTime());var r=o.getPersistence();r&&(!r[e]&&(r[e]={}),!r[e].fst&&(r[e].fst=t,o.savePersistence(r)))}},this.getLastSeenTime=function(t){if(!t)return null;if(t===e.Identity.getCurrentUser().getMPID())return(new Date).getTime();var r=o.getPersistence();return r&&r[t]&&r[t].lst?r[t].lst:null},this.setLastSeenTime=function(e,t){if(e){t||(t=(new Date).getTime());var r=o.getPersistence();r&&r[e]&&(r[e].lst=t,o.savePersistence(r))}},this.getDeviceId=function(){return e._Store.deviceId},this.setDeviceId=function(t){e._Store.deviceId=t,o.update()},this.resetPersistence=function(){r(nt.localStorageName),r(nt.localStorageNameV3),r(nt.localStorageNameV4),r(e._Store.prodStorageName),r(e._Store.storageName),r(nt.localStorageProductsV4),o.expireCookies(nt.cookieName),o.expireCookies(nt.cookieNameV2),o.expireCookies(nt.cookieNameV3),o.expireCookies(nt.cookieNameV4),o.expireCookies(e._Store.prodStorageName),o.expireCookies(e._Store.storageName),mParticle._isTestEnv&&(r(e._Helpers.createMainStorageName("abcdef")),o.expireCookies(e._Helpers.createMainStorageName("abcdef")),r(e._Helpers.createProductStorageName("abcdef")))},this.forwardingStatsBatches={uploadsTable:{},forwardingStatsEventQueue:[]}}var it=v.Messages;function st(e){var t=this;this.logEvent=function(t,r){if(e.Logger.verbose(it.InformationMessages.StartingLogEvent+": "+t.name),e._Helpers.canLog()){var n=e._ServerModel.createEventObject(t);e._APIClient.sendEventToServer(n,r)}else e.Logger.verbose(it.InformationMessages.AbandonLogEvent)},this.startTracking=function(t){function r(t,r){if(t)try{r?t(r):t()}catch(t){e.Logger.error("Error invoking the callback passed to startTrackingLocation."),e.Logger.error(t)}}if(e._Store.isTracking){var n={coords:{latitude:e._Store.currentPosition.lat,longitude:e._Store.currentPosition.lng}};r(t,n)}else"geolocation"in navigator&&(e._Store.watchPositionId=navigator.geolocation.watchPosition((function(n){e._Store.currentPosition={lat:n.coords.latitude,lng:n.coords.longitude},r(t,n),t=null,e._Store.isTracking=!0}),(function(){r(t),t=null,e._Store.isTracking=!1})))},this.stopTracking=function(){e._Store.isTracking&&(navigator.geolocation.clearWatch(e._Store.watchPositionId),e._Store.currentPosition=null,e._Store.isTracking=!1)},this.logOptOut=function(){e.Logger.verbose(it.InformationMessages.StartingLogOptOut);var t=e._ServerModel.createEventObject({messageType:f.MessageType.OptOut,eventType:f.EventType.Other});e._APIClient.sendEventToServer(t)},this.logAST=function(){t.logEvent({messageType:f.MessageType.AppStateTransition})},this.logCheckoutEvent=function(r,n,o,i){var s=e._Ecommerce.createCommerceEventObject(i);s&&(s.EventName+=e._Ecommerce.getProductActionEventName(f.ProductActionType.Checkout),s.EventCategory=f.CommerceEventType.ProductCheckout,s.ProductAction={ProductActionType:f.ProductActionType.Checkout,CheckoutStep:r,CheckoutOptions:n,ProductList:[]},t.logCommerceEvent(s,o))},this.logProductActionEvent=function(r,n,o,i,s,a){var c=e._Ecommerce.createCommerceEventObject(i),u=Array.isArray(n)?n:[n];u.forEach((function(t){t.TotalAmount&&(t.TotalAmount=e._Ecommerce.sanitizeAmount(t.TotalAmount,"TotalAmount")),t.Position&&(t.Position=e._Ecommerce.sanitizeAmount(t.Position,"Position")),t.Price&&(t.Price=e._Ecommerce.sanitizeAmount(t.Price,"Price")),t.Quantity&&(t.Quantity=e._Ecommerce.sanitizeAmount(t.Quantity,"Quantity"))})),c&&(c.EventCategory=e._Ecommerce.convertProductActionToEventType(r),c.EventName+=e._Ecommerce.getProductActionEventName(r),c.ProductAction={ProductActionType:r,ProductList:u},e._Helpers.isObject(s)&&e._Ecommerce.convertTransactionAttributesToProductAction(s,c.ProductAction),t.logCommerceEvent(c,o,a))},this.logPurchaseEvent=function(r,n,o,i){var s=e._Ecommerce.createCommerceEventObject(i);s&&(s.EventName+=e._Ecommerce.getProductActionEventName(f.ProductActionType.Purchase),s.EventCategory=f.CommerceEventType.ProductPurchase,s.ProductAction={ProductActionType:f.ProductActionType.Purchase},s.ProductAction.ProductList=e._Ecommerce.buildProductList(s,n),e._Ecommerce.convertTransactionAttributesToProductAction(r,s.ProductAction),t.logCommerceEvent(s,o))},this.logRefundEvent=function(r,n,o,i){if(r){var s=e._Ecommerce.createCommerceEventObject(i);s&&(s.EventName+=e._Ecommerce.getProductActionEventName(f.ProductActionType.Refund),s.EventCategory=f.CommerceEventType.ProductRefund,s.ProductAction={ProductActionType:f.ProductActionType.Refund},s.ProductAction.ProductList=e._Ecommerce.buildProductList(s,n),e._Ecommerce.convertTransactionAttributesToProductAction(r,s.ProductAction),t.logCommerceEvent(s,o))}else e.Logger.error(it.ErrorMessages.TransactionRequired)},this.logPromotionEvent=function(r,n,o,i,s){var a=e._Ecommerce.createCommerceEventObject(i);a&&(a.EventName+=e._Ecommerce.getPromotionActionEventName(r),a.EventCategory=e._Ecommerce.convertPromotionActionToEventType(r),a.PromotionAction={PromotionActionType:r,PromotionList:Array.isArray(n)?n:[n]},t.logCommerceEvent(a,o,s))},this.logImpressionEvent=function(r,n,o,i){var s=e._Ecommerce.createCommerceEventObject(o);s&&(s.EventName+="Impression",s.EventCategory=f.CommerceEventType.ProductImpression,!Array.isArray(r)&&(r=[r]),s.ProductImpressions=[],r.forEach((function(e){s.ProductImpressions.push({ProductImpressionList:e.Name,ProductList:Array.isArray(e.Product)?e.Product:[e.Product]})})),t.logCommerceEvent(s,n,i))},this.logCommerceEvent=function(t,r,n){return e.Logger.verbose(it.InformationMessages.StartingLogCommerceEvent),t.ProductAction&&null===t.EventCategory?void e.Logger.error("Commerce event not sent.  The mParticle.ProductActionType you passed was invalid. Re-check your code."):(r=e._Helpers.sanitizeAttributes(r,t.EventName),void(e._Helpers.canLog()?(e._Store.webviewBridgeEnabled&&(t.ShoppingCart={}),r&&(t.EventAttributes=r),e._APIClient.sendEventToServer(t,n),e._Persistence.update()):e.Logger.verbose(it.InformationMessages.AbandonLogEvent)))},this.addEventHandler=function(r,n,o,i,s){var a,c,u=[],d=function(r){e.Logger.verbose("DOM event triggered, handling event"),t.logEvent({messageType:f.MessageType.PageEvent,name:"function"==typeof o?o(a):o,data:"function"==typeof i?i(a):i,eventType:s||f.EventType.Other}),(a.href&&"_blank"!==a.target||a.submit)&&(r.preventDefault?r.preventDefault():r.returnValue=!1,setTimeout((function(){a.href?window.location.href=a.href:a.submit&&a.submit()}),e._Store.SDKConfig.timeout))};if(n)if("string"==typeof n?u=document.querySelectorAll(n):n.nodeType&&(u=[n]),u.length)for(e.Logger.verbose("Found "+u.length+" element"+(1<u.length?"s":"")+", attaching event handlers"),c=0;c<u.length;c++)(a=u[c]).addEventListener?a.addEventListener(r,d,!1):a.attachEvent?a.attachEvent("on"+r,d):a["on"+r]=d;else e.Logger.verbose("No elements found");else e.Logger.error("Can't bind event, selector is required")}}function at(e,t,r,n){var o=this;return{getUserIdentities:function(){var o={},i=r._Persistence.getUserIdentities(e);for(var s in i)if(i.hasOwnProperty(s)){var a=f.IdentityType.getIdentityName(r._Helpers.parseNumber(s));n&&(!n||n.isIdentityBlocked(a))||(o[a]=i[s])}return{userIdentities:o=r._Helpers.filterUserIdentitiesForForwarders(o,t.userIdentityFilters)}},getMPID:function(){return e},getUserAttributesLists:function(e){var t,i={};for(var s in t=o.getAllUserAttributes())t.hasOwnProperty(s)&&Array.isArray(t[s])&&(n&&(!n||n.isAttributeKeyBlocked(s))||(i[s]=t[s].slice()));return i=r._Helpers.filterUserAttributes(i,e.userAttributeFilters)},getAllUserAttributes:function(){var o={},i=r._Persistence.getAllUserAttributes(e);if(i)for(var s in i)i.hasOwnProperty(s)&&(n&&(!n||n.isAttributeKeyBlocked(s))||(Array.isArray(i[s])?o[s]=i[s].slice():o[s]=i[s]));return o=r._Helpers.filterUserAttributes(o,t.userAttributeFilters)}}}function ct(e,t){var r=this,n="setUserAttribute",o="removeUserAttribute";this.initForwarders=function(t,n){var o=e.Identity.getCurrentUser();!e._Store.webviewBridgeEnabled&&e._Store.configuredForwarders&&(e._Store.configuredForwarders.sort((function(e,t){return e.settings.PriorityValue=e.settings.PriorityValue||0,t.settings.PriorityValue=t.settings.PriorityValue||0,-1*(e.settings.PriorityValue-t.settings.PriorityValue)})),e._Store.activeForwarders=e._Store.configuredForwarders.filter((function(i){if(!e._Consent.isEnabledForUserConsent(i.filteringConsentRuleValues,o))return!1;if(!r.isEnabledForUserAttributes(i.filteringUserAttributeValue,o))return!1;if(!r.isEnabledForUnknownUser(i.excludeAnonymousUser,o))return!1;var s=e._Helpers.filterUserIdentities(t,i.userIdentityFilters),a=e._Helpers.filterUserAttributes(o?o.getAllUserAttributes():{},i.userAttributeFilters);return i.initialized||(i.logger=e.Logger,i.init(i.settings,n,!1,null,a,s,e._Store.SDKConfig.appVersion,e._Store.SDKConfig.appName,e._Store.SDKConfig.customFlags,e._Store.clientId),i.initialized=!0),!0})))},this.isEnabledForUserAttributes=function(t,r){if(!t||!e._Helpers.isObject(t)||!Object.keys(t).length)return!0;var n,o,i;if(!r)return!1;i=r.getAllUserAttributes();var s=!1;try{if(i&&e._Helpers.isObject(i)&&Object.keys(i).length)for(var a in i)if(i.hasOwnProperty(a)&&(n=Ve.hashAttributeConditionalForwarding(a),o=Ve.hashAttributeConditionalForwarding(i[a]),n===t.userAttributeName&&o===t.userAttributeValue)){s=!0;break}return!t||t.includeOnMatch===s}catch(e){return!0}},this.isEnabledForUnknownUser=function(e,t){return!!(t&&t.isLoggedIn()||!e)},this.applyToForwarders=function(t,r){e._Store.activeForwarders.length&&e._Store.activeForwarders.forEach((function(n){if(n[t])try{var o=n[t](r);o&&e.Logger.verbose(o)}catch(t){e.Logger.verbose(t)}}))},this.sendEventToForwarders=function(t){var r,n,o,i=function(t,r){t.UserIdentities&&t.UserIdentities.length&&t.UserIdentities.forEach((function(n,o){e._Helpers.inArray(r,Ve.hashUserIdentity(n.Type))&&(t.UserIdentities.splice(o,1),0<o&&o--)}))},s=function(t,r){var n;if(r)for(var o in t.EventAttributes)t.EventAttributes.hasOwnProperty(o)&&(n=Ve.hashEventAttributeKey(t.EventCategory,t.EventName,o),e._Helpers.inArray(r,n)&&delete t.EventAttributes[o])},a=function(t,r){return!!(t&&t.length&&e._Helpers.inArray(t,r))},c=[f.MessageType.PageEvent,f.MessageType.PageView,f.MessageType.Commerce];if(!e._Store.webviewBridgeEnabled&&e._Store.activeForwarders){n=Ve.hashEventName(t.EventName,t.EventCategory),o=Ve.hashEventType(t.EventCategory);for(var u=0;u<e._Store.activeForwarders.length;u++){if(-1<c.indexOf(t.EventDataType)&&e._Store.activeForwarders[u].filteringEventAttributeValue&&e._Store.activeForwarders[u].filteringEventAttributeValue.eventAttributeName&&e._Store.activeForwarders[u].filteringEventAttributeValue.eventAttributeValue){var d=null;if(t.EventAttributes)for(var l in t.EventAttributes){var g;if((g=Ve.hashAttributeConditionalForwarding(l))===e._Store.activeForwarders[u].filteringEventAttributeValue.eventAttributeName&&(d={name:g,value:Ve.hashAttributeConditionalForwarding(t.EventAttributes[l])}),d)break}var p=null!==d&&d.value===e._Store.activeForwarders[u].filteringEventAttributeValue.eventAttributeValue;if(!(!0===e._Store.activeForwarders[u].filteringEventAttributeValue.includeOnMatch?p:!p))continue}if((r={},r=e._Helpers.extend(!0,r,t),t.EventDataType!==f.MessageType.PageEvent||!a(e._Store.activeForwarders[u].eventNameFilters,n)&&!a(e._Store.activeForwarders[u].eventTypeFilters,o))&&((t.EventDataType!==f.MessageType.Commerce||!a(e._Store.activeForwarders[u].eventTypeFilters,o))&&(t.EventDataType!==f.MessageType.PageView||!a(e._Store.activeForwarders[u].screenNameFilters,n))&&(r.EventAttributes&&(t.EventDataType===f.MessageType.PageEvent?s(r,e._Store.activeForwarders[u].attributeFilters):t.EventDataType===f.MessageType.PageView&&s(r,e._Store.activeForwarders[u].screenAttributeFilters)),i(r,e._Store.activeForwarders[u].userIdentityFilters),r.UserAttributes=e._Helpers.filterUserAttributes(r.UserAttributes,e._Store.activeForwarders[u].userAttributeFilters),e._Store.activeForwarders[u].process))){e.Logger.verbose("Sending message to forwarder: "+e._Store.activeForwarders[u].name);var m=e._Store.activeForwarders[u].process(r);m&&e.Logger.verbose(m)}}}},this.handleForwarderUserAttributes=function(r,i,s){t&&t.isAttributeKeyBlocked(i)||!e._Store.activeForwarders.length||e._Store.activeForwarders.forEach((function(t){if(t[r]&&!e._Helpers.isFilteredUserAttribute(i,t.userAttributeFilters))try{var a;r===n?a=t.setUserAttribute(i,s):r===o&&(a=t.removeUserAttribute(i)),a&&e.Logger.verbose(a)}catch(t){e.Logger.error(t)}}))},this.setForwarderUserIdentities=function(t){e._Store.activeForwarders.forEach((function(r){var n=e._Helpers.filterUserIdentities(t,r.userIdentityFilters);r.setUserIdentity&&n.forEach((function(t){var n=r.setUserIdentity(t.Identity,t.Type);n&&e.Logger.verbose(n)}))}))},this.setForwarderOnUserIdentified=function(r){e._Store.activeForwarders.forEach((function(n){var o=at(r.getMPID(),n,e,t);if(n.onUserIdentified){var i=n.onUserIdentified(o);i&&e.Logger.verbose(i)}}))},this.setForwarderOnIdentityComplete=function(r,n){var o;e._Store.activeForwarders.forEach((function(i){var s=at(r.getMPID(),i,e,t);"identify"===n?i.onIdentifyComplete&&((o=i.onIdentifyComplete(s))&&e.Logger.verbose(o)):"login"===n?i.onLoginComplete&&((o=i.onLoginComplete(s))&&e.Logger.verbose(o)):"logout"===n?i.onLogoutComplete&&((o=i.onLogoutComplete(s))&&e.Logger.verbose(o)):"modify"==n&&i.onModifyComplete&&((o=i.onModifyComplete(s))&&e.Logger.verbose(o))}))},this.getForwarderStatsQueue=function(){return e._Persistence.forwardingStatsBatches.forwardingStatsEventQueue},this.setForwarderStatsQueue=function(t){e._Persistence.forwardingStatsBatches.forwardingStatsEventQueue=t},this.processForwarders=function(t,n){t?(this.processUIEnabledKits(t),this.processSideloadedKits(t),r.initForwarders(e._Store.SDKConfig.identifyRequest.userIdentities,n)):e.Logger.warning("No config was passed. Cannot process forwarders")},this.processUIEnabledKits=function(t){var n=this.returnKitConstructors();try{Array.isArray(t.kitConfigs)&&t.kitConfigs.length&&t.kitConfigs.forEach((function(e){r.configureUIEnabledKit(e,n)}))}catch(t){e.Logger.error("MP Kits not configured propertly. Kits may not be initialized. "+t)}},this.returnKitConstructors=function(){var t={};return de(e._Store.SDKConfig.kits)?!de(e._preInit.forwarderConstructors)&&e._preInit.forwarderConstructors.forEach((function(e){if(e.suffix){var r="".concat(e.name,"-").concat(e.suffix);t[r]=e}else t[e.name]=e})):t=e._Store.SDKConfig.kits,t},this.configureUIEnabledKit=function(t,r){var n=null,o=t;for(var i in r){var s=void 0;if(o.suffix&&(s="".concat(o.name,"-").concat(o.suffix)),!(i!==s&&i!==o.name||o.isDebug!==e._Store.SDKConfig.isDevelopmentMode&&o.isSandbox!==e._Store.SDKConfig.isDevelopmentMode)){n=this.returnConfiguredKit(r[i],o),e._Store.configuredForwarders.push(n);break}}},this.processSideloadedKits=function(t){try{if(Array.isArray(t.sideloadedKits)){var n={kits:{}},o=t.sideloadedKits;for(var i in o.forEach((function(e){try{e.kitInstance.register(n);var t=e.kitInstance.name;n.kits[t].filters=e.filterDictionary}catch(t){console.error("Error registering sideloaded kit "+e.kitInstance.name)}})),n.kits){var s=n.kits[i];r.configureSideloadedKit(s)}if(!de(n.kits)){var a=Object.keys(n.kits);e._Store.sideloadedKitsCount=a.length}}}catch(t){e.Logger.error("Sideloaded Kits not configured propertly. Kits may not be initialized. "+t)}},this.configureSideloadedKit=function(t){e._Store.configuredForwarders.push(this.returnConfiguredKit(t,t.filters))},this.returnConfiguredKit=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=new e.constructor;return r.id=t.moduleId,r.isSandbox=t.isDebug||t.isSandbox,r.hasSandbox="true"===t.hasDebugString,r.isVisible=t.isVisible||!0,r.settings=t.settings||{},r.eventNameFilters=t.eventNameFilters||[],r.eventTypeFilters=t.eventTypeFilters||[],r.attributeFilters=t.attributeFilters||[],r.screenNameFilters=t.screenNameFilters||[],r.screenAttributeFilters=t.screenAttributeFilters||[],r.userIdentityFilters=t.userIdentityFilters||[],r.userAttributeFilters=t.userAttributeFilters||[],r.filteringEventAttributeValue=t.filteringEventAttributeValue||{},r.filteringUserAttributeValue=t.filteringUserAttributeValue||{},r.eventSubscriptionId=t.eventSubscriptionId||null,r.filteringConsentRuleValues=t.filteringConsentRuleValues||{},r.excludeAnonymousUser=t.excludeAnonymousUser||!1,r},this.configurePixel=function(t){(t.isDebug===e._Store.SDKConfig.isDevelopmentMode||t.isProduction!==e._Store.SDKConfig.isDevelopmentMode)&&e._Store.pixelConfigurations.push(t)},this.processPixelConfigs=function(t){try{de(t.pixelConfigs)||t.pixelConfigs.forEach((function(e){r.configurePixel(e)}))}catch(t){e.Logger.error("Cookie Sync configs not configured propertly. Cookie Sync may not be initialized. "+t)}}}var ut=f.MessageType,dt=f.ApplicationTransitionType;function lt(e){return e?e.map((function(e){return function(e){return{id:$(e.Sku),nm:$(e.Name),pr:X(e.Price),qt:X(e.Quantity),br:$(e.Brand),va:$(e.Variant),ca:$(e.Category),ps:X(e.Position),cc:$(e.CouponCode),tpa:X(e.TotalAmount),attrs:e.Attributes}}(e)})):[]}function gt(e){var t=this;this.appendUserInfo=function(t,r){if(r){if(!t)return r.MPID=null,r.ConsentState=null,r.UserAttributes=null,void(r.UserIdentities=null);if(!r.MPID||r.MPID!==t.getMPID()){r.MPID=t.getMPID(),r.ConsentState=t.getConsentState(),r.UserAttributes=t.getAllUserAttributes();var n=t.getUserIdentities().userIdentities,o={};for(var i in n){var s=f.IdentityType.getIdentityType(i);!1!==s&&(o[s]=n[i])}var a=[];if(e._Helpers.isObject(o)&&Object.keys(o).length)for(var c in o){var u={};u.Identity=o[c],u.Type=e._Helpers.parseNumber(c),a.push(u)}r.UserIdentities=a}}},this.convertToConsentStateV2DTO=function(e){if(!e)return null;var t={},r=e.getGDPRConsentState();if(r){var n={};for(var o in t.gdpr=n,r)if(r.hasOwnProperty(o)){var i=r[o];t.gdpr[o]={},"boolean"==typeof i.Consented&&(n[o].c=i.Consented),"number"==typeof i.Timestamp&&(n[o].ts=i.Timestamp),"string"==typeof i.ConsentDocument&&(n[o].d=i.ConsentDocument),"string"==typeof i.Location&&(n[o].l=i.Location),"string"==typeof i.HardwareId&&(n[o].h=i.HardwareId)}}var s=e.getCCPAConsentState();return s&&(t.ccpa={data_sale_opt_out:{c:s.Consented,ts:s.Timestamp,d:s.ConsentDocument,l:s.Location,h:s.HardwareId}}),t},this.createEventObject=function(r,n){var o={},i={},s=r.messageType===f.MessageType.OptOut?!e._Store.isEnabled:null;if(e._Store.sessionId||r.messageType===f.MessageType.OptOut||e._Store.webviewBridgeEnabled){i=r.hasOwnProperty("toEventAPIObject")?r.toEventAPIObject():{EventName:r.name||r.messageType,EventCategory:r.eventType,EventAttributes:e._Helpers.sanitizeAttributes(r.data,r.name),SourceMessageId:r.sourceMessageId||e._Helpers.generateUniqueId(),EventDataType:r.messageType,CustomFlags:r.customFlags||{},UserAttributeChanges:r.userAttributeChanges,UserIdentityChanges:r.userIdentityChanges},r.messageType!==f.MessageType.SessionEnd&&(e._Store.dateLastEventSent=new Date),o={Store:e._Store.serverSettings,SDKVersion:v.sdkVersion,SessionId:e._Store.sessionId,SessionStartDate:e._Store.sessionStartDate?e._Store.sessionStartDate.getTime():0,Debug:e._Store.SDKConfig.isDevelopmentMode,Location:e._Store.currentPosition,OptOut:s,ExpandedEventCount:0,AppVersion:e.getAppVersion(),AppName:e.getAppName(),Package:e._Store.SDKConfig.package,ClientGeneratedId:e._Store.clientId,DeviceId:e._Store.deviceId,IntegrationAttributes:e._Store.integrationAttributes,CurrencyCode:e._Store.currencyCode,DataPlan:e._Store.SDKConfig.dataPlan?e._Store.SDKConfig.dataPlan:{}},i.EventDataType===ut.AppStateTransition&&(i.IsFirstRun=e._Store.isFirstRun,i.LaunchReferral=window.location.href||null),i.CurrencyCode=e._Store.currencyCode;var a=n||e.Identity.getCurrentUser();return t.appendUserInfo(a,i),r.messageType===f.MessageType.SessionEnd&&(i.SessionLength=e._Store.dateLastEventSent.getTime()-e._Store.sessionStartDate.getTime(),i.currentSessionMPIDs=e._Store.currentSessionMPIDs,i.EventAttributes=e._Store.sessionAttributes,e._Store.currentSessionMPIDs=[],e._Store.sessionStartDate=null),o.Timestamp=e._Store.dateLastEventSent.getTime(),e._Helpers.extend({},i,o)}return null},this.convertEventToV2DTO=function(r){var n={n:r.EventName,et:r.EventCategory,ua:r.UserAttributes,ui:r.UserIdentities,ia:r.IntegrationAttributes,str:r.Store,attrs:r.EventAttributes,sdk:r.SDKVersion,sid:r.SessionId,sl:r.SessionLength,ssd:r.SessionStartDate,dt:r.EventDataType,dbg:r.Debug,ct:r.Timestamp,lc:r.Location,o:r.OptOut,eec:r.ExpandedEventCount,av:r.AppVersion,cgid:r.ClientGeneratedId,das:r.DeviceId,mpid:r.MPID,smpids:r.currentSessionMPIDs};r.DataPlan&&r.DataPlan.PlanId&&(n.dp_id=r.DataPlan.PlanId,r.DataPlan.PlanVersion&&(n.dp_v=r.DataPlan.PlanVersion));var o=t.convertToConsentStateV2DTO(r.ConsentState);return o&&(n.con=o),r.EventDataType===ut.AppStateTransition&&(n.fr=r.IsFirstRun,n.iu=!1,n.at=dt.AppInit,n.lr=r.LaunchReferral,n.attrs=null),r.CustomFlags&&function(e,t){var r=[];for(var n in t.flags={},e.CustomFlags)r=[],e.CustomFlags.hasOwnProperty(n)&&(Array.isArray(e.CustomFlags[n])?e.CustomFlags[n].forEach((function(e){("number"==typeof e||"string"==typeof e||"boolean"==typeof e)&&r.push(e.toString())})):("number"==typeof e.CustomFlags[n]||"string"==typeof e.CustomFlags[n]||"boolean"==typeof e.CustomFlags[n])&&r.push(e.CustomFlags[n].toString()),r.length&&(t.flags[n]=r))}(r,n),r.EventDataType===ut.Commerce?(n.cu=r.CurrencyCode,r.ShoppingCart&&(n.sc={pl:lt(r.ShoppingCart.ProductList)}),r.ProductAction?n.pd={an:r.ProductAction.ProductActionType,cs:e._Helpers.parseNumber(r.ProductAction.CheckoutStep),co:r.ProductAction.CheckoutOptions,pl:lt(r.ProductAction.ProductList),ti:r.ProductAction.TransactionId,ta:r.ProductAction.Affiliation,tcc:r.ProductAction.CouponCode,tr:e._Helpers.parseNumber(r.ProductAction.TotalAmount),ts:e._Helpers.parseNumber(r.ProductAction.ShippingAmount),tt:e._Helpers.parseNumber(r.ProductAction.TaxAmount)}:r.PromotionAction?n.pm={an:r.PromotionAction.PromotionActionType,pl:r.PromotionAction.PromotionList.map((function(e){return{id:e.Id,nm:e.Name,cr:e.Creative,ps:e.Position?e.Position:0}}))}:r.ProductImpressions&&(n.pi=r.ProductImpressions.map((function(e){return{pil:e.ProductImpressionList,pl:lt(e.ProductList)}})))):r.EventDataType===ut.Profile&&(n.pet=r.ProfileMessageType),n}}function pt(e){this.startForwardingStatsTimer=function(){mParticle._forwardingStatsTimer=setInterval((function(){!function(){var t=e._Forwarders.getForwarderStatsQueue(),r=e._Persistence.forwardingStatsBatches.uploadsTable,n=Date.now();for(var o in t.length&&(r[n]={uploading:!1,data:t},e._Forwarders.setForwarderStatsQueue([])),r)!function(t){if(r.hasOwnProperty(t)&&!1===r[t].uploading){var n=e._Helpers.createXHR((function(){4===n.readyState&&(200===n.status||202===n.status?(e.Logger.verbose("Successfully sent  "+n.statusText+" from server"),delete r[t]):"4"===n.status.toString()[0]?429!==n.status&&delete r[t]:r[t].uploading=!1)})),o=r[t].data;r[t].uploading=!0,e._APIClient.sendBatchForwardingStatsToServer(o,n)}}(o)}()}),e._Store.SDKConfig.forwarderStatsTimeout)}}var mt=v.Messages,ft=v.HTTPCodes;function vt(e){var t=this;this.checkIdentitySwap=function(t,r,n){if(t&&r&&t!==r){var o=e._Persistence.getPersistence();o&&(o.cu=r,o.gs.csm=n,e._Persistence.savePersistence(o))}},this.IdentityRequest={createKnownIdentities:function(t,r){var n={};if(t&&t.userIdentities&&e._Helpers.isObject(t.userIdentities))for(var o in t.userIdentities)n[o]=t.userIdentities[o];return n.device_application_stamp=r,n},preProcessIdentityRequest:function(t,r,n){e.Logger.verbose(mt.InformationMessages.StartingLogEvent+": "+n);var i=e._Helpers.Validators.validateIdentities(t,n);if(!i.valid)return e.Logger.error("ERROR: "+i.error),{valid:!1,error:i.error};if(r&&!e._Helpers.Validators.isFunction(r)){var s="The optional callback must be a function. You tried entering a(n) "+o(r);return e.Logger.error(s),{valid:!1,error:s}}return{valid:!0}},createIdentityRequest:function(t,r,n,o,i,s,a){return{client_sdk:{platform:r,sdk_vendor:n,sdk_version:o},context:s,environment:e._Store.SDKConfig.isDevelopmentMode?"development":"production",request_id:e._Helpers.generateUniqueId(),request_timestamp_ms:(new Date).getTime(),previous_mpid:a||null,known_identities:this.createKnownIdentities(t,i)}},createModifyIdentityRequest:function(t,r,n,o,i,s){return{client_sdk:{platform:n,sdk_vendor:o,sdk_version:i},context:s,environment:e._Store.SDKConfig.isDevelopmentMode?"development":"production",request_id:e._Helpers.generateUniqueId(),request_timestamp_ms:(new Date).getTime(),identity_changes:this.createIdentityChanges(t,r)}},createIdentityChanges:function(t,r){var n,o=[];if(r&&e._Helpers.isObject(r)&&t&&e._Helpers.isObject(t))for(n in r)o.push({old_value:t[n]||null,new_value:r[n],identity_type:n});return o},combineUserIdentities:function(t,r){var n={},o=e._Helpers.extend(t,r);for(var i in o){var s=f.IdentityType.getIdentityType(i);!1!==s&&0<=s&&(n[f.IdentityType.getIdentityType(i)]=o[i])}return n},createAliasNetworkRequest:function(t){return{request_id:e._Helpers.generateUniqueId(),request_type:"alias",environment:e._Store.SDKConfig.isDevelopmentMode?"development":"production",api_key:e._Store.devToken,data:{destination_mpid:t.destinationMpid,source_mpid:t.sourceMpid,start_unixtime_ms:t.startTime,end_unixtime_ms:t.endTime,scope:t.scope,device_application_stamp:e._Store.deviceId}}},convertAliasToNative:function(e){return{DestinationMpid:e.destinationMpid,SourceMpid:e.sourceMpid,StartUnixtimeMs:e.startTime,EndUnixtimeMs:e.endTime}},convertToNative:function(e){var t=[];if(e&&e.userIdentities){for(var r in e.userIdentities)e.userIdentities.hasOwnProperty(r)&&t.push({Type:f.IdentityType.getIdentityType(r),Identity:e.userIdentities[r]});return{UserIdentities:t}}}},this.IdentityAPI={HTTPCodes:ft,identify:function(r,n){var o,i=e.Identity.getCurrentUser(),s=e._Identity.IdentityRequest.preProcessIdentityRequest(r,n,"identify");if(i&&(o=i.getMPID()),s.valid){var a=e._Identity.IdentityRequest.createIdentityRequest(r,v.platform,v.sdkVendor,v.sdkVersion,e._Store.deviceId,e._Store.context,o);e._Helpers.canLog()?e._Store.webviewBridgeEnabled?(e._NativeSdkHelpers.sendToNative(v.NativeSdkPaths.Identify,JSON.stringify(e._Identity.IdentityRequest.convertToNative(r))),e._Helpers.invokeCallback(n,ft.nativeIdentityRequest,"Identify request sent to native sdk")):e._IdentityAPIClient.sendIdentityRequest(a,"identify",n,r,t.parseIdentityResponse,o):(e._Helpers.invokeCallback(n,ft.loggingDisabledOrMissingAPIKey,mt.InformationMessages.AbandonLogEvent),e.Logger.verbose(mt.InformationMessages.AbandonLogEvent))}else e._Helpers.invokeCallback(n,ft.validationIssue,s.error),e.Logger.verbose(s)},logout:function(r,n){var o,i=e.Identity.getCurrentUser(),s=e._Identity.IdentityRequest.preProcessIdentityRequest(r,n,"logout");if(i&&(o=i.getMPID()),s.valid){var a,c=e._Identity.IdentityRequest.createIdentityRequest(r,v.platform,v.sdkVendor,v.sdkVersion,e._Store.deviceId,e._Store.context,o);e._Helpers.canLog()?e._Store.webviewBridgeEnabled?(e._NativeSdkHelpers.sendToNative(v.NativeSdkPaths.Logout,JSON.stringify(e._Identity.IdentityRequest.convertToNative(r))),e._Helpers.invokeCallback(n,ft.nativeIdentityRequest,"Logout request sent to native sdk")):(e._IdentityAPIClient.sendIdentityRequest(c,"logout",n,r,t.parseIdentityResponse,o),(a=e._ServerModel.createEventObject({messageType:f.MessageType.Profile})).ProfileMessageType=f.ProfileMessageType.Logout,e._Store.activeForwarders.length&&e._Store.activeForwarders.forEach((function(e){e.logOut&&e.logOut(a)}))):(e._Helpers.invokeCallback(n,ft.loggingDisabledOrMissingAPIKey,mt.InformationMessages.AbandonLogEvent),e.Logger.verbose(mt.InformationMessages.AbandonLogEvent))}else e._Helpers.invokeCallback(n,ft.validationIssue,s.error),e.Logger.verbose(s)},login:function(r,n){var o,i=e.Identity.getCurrentUser(),s=e._Identity.IdentityRequest.preProcessIdentityRequest(r,n,"login");if(i&&(o=i.getMPID()),s.valid){var a=e._Identity.IdentityRequest.createIdentityRequest(r,v.platform,v.sdkVendor,v.sdkVersion,e._Store.deviceId,e._Store.context,o);e._Helpers.canLog()?e._Store.webviewBridgeEnabled?(e._NativeSdkHelpers.sendToNative(v.NativeSdkPaths.Login,JSON.stringify(e._Identity.IdentityRequest.convertToNative(r))),e._Helpers.invokeCallback(n,ft.nativeIdentityRequest,"Login request sent to native sdk")):e._IdentityAPIClient.sendIdentityRequest(a,"login",n,r,t.parseIdentityResponse,o):(e._Helpers.invokeCallback(n,ft.loggingDisabledOrMissingAPIKey,mt.InformationMessages.AbandonLogEvent),e.Logger.verbose(mt.InformationMessages.AbandonLogEvent))}else e._Helpers.invokeCallback(n,ft.validationIssue,s.error),e.Logger.verbose(s)},modify:function(r,n){var o,i=e.Identity.getCurrentUser(),s=e._Identity.IdentityRequest.preProcessIdentityRequest(r,n,"modify");i&&(o=i.getMPID());var a=r&&r.userIdentities?r.userIdentities:{};if(s.valid){var c=e._Identity.IdentityRequest.createModifyIdentityRequest(i?i.getUserIdentities().userIdentities:{},a,v.platform,v.sdkVendor,v.sdkVersion,e._Store.context);e._Helpers.canLog()?e._Store.webviewBridgeEnabled?(e._NativeSdkHelpers.sendToNative(v.NativeSdkPaths.Modify,JSON.stringify(e._Identity.IdentityRequest.convertToNative(r))),e._Helpers.invokeCallback(n,ft.nativeIdentityRequest,"Modify request sent to native sdk")):e._IdentityAPIClient.sendIdentityRequest(c,"modify",n,r,t.parseIdentityResponse,o):(e._Helpers.invokeCallback(n,ft.loggingDisabledOrMissingAPIKey,mt.InformationMessages.AbandonLogEvent),e.Logger.verbose(mt.InformationMessages.AbandonLogEvent))}else e._Helpers.invokeCallback(n,ft.validationIssue,s.error),e.Logger.verbose(s)},getCurrentUser:function(){var r;return e._Store?(r=e._Store.mpid)?(r=e._Store.mpid.slice(),t.mParticleUser(r,e._Store.isLoggedIn)):e._Store.webviewBridgeEnabled?t.mParticleUser():null:null},getUser:function(r){var n=e._Persistence.getPersistence();return n&&n[r]&&!v.SDKv2NonMPIDCookieKeys.hasOwnProperty(r)?t.mParticleUser(r):null},getUsers:function(){var r=e._Persistence.getPersistence(),n=[];if(r)for(var o in r)v.SDKv2NonMPIDCookieKeys.hasOwnProperty(o)||n.push(t.mParticleUser(o));return n.sort((function(e,t){return(e.getLastSeenTime()||0)>(t.getLastSeenTime()||0)?-1:1})),n},aliasUsers:function(t,r){var n;if(t.destinationMpid&&t.sourceMpid||(n=mt.ValidationMessages.AliasMissingMpid),t.destinationMpid===t.sourceMpid&&(n=mt.ValidationMessages.AliasNonUniqueMpid),t.startTime&&t.endTime||(n=mt.ValidationMessages.AliasMissingTime),t.startTime>t.endTime&&(n=mt.ValidationMessages.AliasStartBeforeEndTime),n)return e.Logger.warning(n),void e._Helpers.invokeAliasCallback(r,ft.validationIssue,n);if(e._Helpers.canLog())if(e._Store.webviewBridgeEnabled)e._NativeSdkHelpers.sendToNative(v.NativeSdkPaths.Alias,JSON.stringify(e._Identity.IdentityRequest.convertAliasToNative(t))),e._Helpers.invokeAliasCallback(r,ft.nativeIdentityRequest,"Alias request sent to native sdk");else{e.Logger.verbose(mt.InformationMessages.StartingAliasRequest+": "+t.sourceMpid+" -> "+t.destinationMpid);var o=e._Identity.IdentityRequest.createAliasNetworkRequest(t);e._IdentityAPIClient.sendAliasRequest(o,r)}else e._Helpers.invokeAliasCallback(r,ft.loggingDisabledOrMissingAPIKey,mt.InformationMessages.AbandonAliasUsers),e.Logger.verbose(mt.InformationMessages.AbandonAliasUsers)},createAliasRequest:function(t,r){try{if(!r||!t)return e.Logger.error("'destinationUser' and 'sourceUser' must both be present"),null;var n=t.getFirstSeenTime();n||e.Identity.getUsers().forEach((function(e){e.getFirstSeenTime()&&(!n||e.getFirstSeenTime()<n)&&(n=e.getFirstSeenTime())}));var o=(new Date).getTime()-24*e._Store.SDKConfig.aliasMaxWindow*60*60*1e3,i=t.getLastSeenTime()||(new Date).getTime();return n<o&&(i<(n=o)&&e.Logger.warning("Source User has not been seen in the last "+e._Store.SDKConfig.maxAliasWindow+" days, Alias Request will likely fail")),{destinationMpid:r.getMPID(),sourceMpid:t.getMPID(),startTime:n,endTime:i}}catch(r){return e.Logger.error("There was a problem with creating an alias request: "+r),null}}},this.mParticleUser=function(t,r){var n=this;return{getUserIdentities:function(){var r={},n=e._Persistence.getUserIdentities(t);for(var o in n)n.hasOwnProperty(o)&&(r[f.IdentityType.getIdentityName(e._Helpers.parseNumber(o))]=n[o]);return{userIdentities:r}},getMPID:function(){return t},setUserTag:function(t){return e._Helpers.Validators.isValidKeyValue(t)?void this.setUserAttribute(t,null):void e.Logger.error(mt.ErrorMessages.BadKey)},removeUserTag:function(t){return e._Helpers.Validators.isValidKeyValue(t)?void this.removeUserAttribute(t):void e.Logger.error(mt.ErrorMessages.BadKey)},setUserAttribute:function(r,o){var i,s,a,c;if(e._SessionManager.resetSessionTimer(),e._Helpers.canLog()){if(!e._Helpers.Validators.isValidAttributeValue(o))return void e.Logger.error(mt.ErrorMessages.BadAttribute);if(!e._Helpers.Validators.isValidKeyValue(r))return void e.Logger.error(mt.ErrorMessages.BadKey);if(e._Store.webviewBridgeEnabled)e._NativeSdkHelpers.sendToNative(v.NativeSdkPaths.SetUserAttribute,JSON.stringify({key:r,value:o}));else{i=e._Persistence.getPersistence(),s=this.getAllUserAttributes();var u=e._Helpers.findKeyInObject(s,r);u?(c=!1,a=s[u],delete s[u]):c=!0,s[r]=o,i&&i[t]&&(i[t].ua=s,e._Persistence.savePersistence(i,t)),n.sendUserAttributeChangeEvent(r,o,a,c,!1,this),e._Forwarders.initForwarders(n.IdentityAPI.getCurrentUser().getUserIdentities(),e._APIClient.prepareForwardingStats),e._Forwarders.handleForwarderUserAttributes("setUserAttribute",r,o)}}},setUserAttributes:function(t){if(e._SessionManager.resetSessionTimer(),e._Helpers.isObject(t)){if(e._Helpers.canLog())for(var r in t)t.hasOwnProperty(r)&&this.setUserAttribute(r,t[r])}else e.Logger.error("Must pass an object into setUserAttributes. You passed a "+o(t))},removeUserAttribute:function(r){var o,i;if(e._SessionManager.resetSessionTimer(),e._Helpers.Validators.isValidKeyValue(r))if(e._Store.webviewBridgeEnabled)e._NativeSdkHelpers.sendToNative(v.NativeSdkPaths.RemoveUserAttribute,JSON.stringify({key:r,value:null}));else{o=e._Persistence.getPersistence(),i=this.getAllUserAttributes();var s=e._Helpers.findKeyInObject(i,r);s&&(r=s);var a=i[r]?i[r].toString():null;delete i[r],o&&o[t]&&(o[t].ua=i,e._Persistence.savePersistence(o,t)),n.sendUserAttributeChangeEvent(r,null,a,!1,!0,this),e._Forwarders.initForwarders(n.IdentityAPI.getCurrentUser().getUserIdentities(),e._APIClient.prepareForwardingStats),e._Forwarders.handleForwarderUserAttributes("removeUserAttribute",r,null)}else e.Logger.error(mt.ErrorMessages.BadKey)},setUserAttributeList:function(r,i){var s,a,c,u,d;if(e._SessionManager.resetSessionTimer(),e._Helpers.Validators.isValidKeyValue(r))if(Array.isArray(i)){var l=i.slice();if(e._Store.webviewBridgeEnabled)e._NativeSdkHelpers.sendToNative(v.NativeSdkPaths.SetUserAttributeList,JSON.stringify({key:r,value:l}));else{s=e._Persistence.getPersistence(),a=this.getAllUserAttributes();var g=e._Helpers.findKeyInObject(a,r);if(g?(u=!1,c=a[g],delete a[g]):u=!0,a[r]=l,s&&s[t]&&(s[t].ua=a,e._Persistence.savePersistence(s,t)),c&&Array.isArray(c)){if(i.length!==c.length)d=!0;else for(var p=0;p<i.length;p++)if(c[p]!==i[p]){d=!0;break}}else d=!0;d&&n.sendUserAttributeChangeEvent(r,i,c,u,!1,this),e._Forwarders.initForwarders(n.IdentityAPI.getCurrentUser().getUserIdentities(),e._APIClient.prepareForwardingStats),e._Forwarders.handleForwarderUserAttributes("setUserAttribute",r,l)}}else e.Logger.error("The value you passed in to setUserAttributeList must be an array. You passed in a "+("undefined"==typeof value?"undefined":o(value)));else e.Logger.error(mt.ErrorMessages.BadKey)},removeAllUserAttributes:function(){var t;if(e._SessionManager.resetSessionTimer(),e._Store.webviewBridgeEnabled)e._NativeSdkHelpers.sendToNative(v.NativeSdkPaths.RemoveAllUserAttributes);else if(t=this.getAllUserAttributes(),e._Forwarders.initForwarders(n.IdentityAPI.getCurrentUser().getUserIdentities(),e._APIClient.prepareForwardingStats),t)for(var r in t)t.hasOwnProperty(r)&&e._Forwarders.handleForwarderUserAttributes("removeUserAttribute",r,null),this.removeUserAttribute(r)},getUserAttributesLists:function(){var e,t={};for(var r in e=this.getAllUserAttributes())e.hasOwnProperty(r)&&Array.isArray(e[r])&&(t[r]=e[r].slice());return t},getAllUserAttributes:function(){var r={},n=e._Persistence.getAllUserAttributes(t);if(n)for(var o in n)n.hasOwnProperty(o)&&(r[o]=Array.isArray(n[o])?n[o].slice():n[o]);return r},getCart:function(){return e.Logger.warning("Deprecated function Identity.getCurrentUser().getCart() will be removed in future releases"),n.mParticleUserCart(t)},getConsentState:function(){return e._Persistence.getConsentState(t)},setConsentState:function(r){e._Persistence.saveUserConsentStateToCookies(t,r),e._Forwarders.initForwarders(this.getUserIdentities().userIdentities,e._APIClient.prepareForwardingStats),e._CookieSyncManager.attemptCookieSync(null,this.getMPID())},isLoggedIn:function(){return r},getLastSeenTime:function(){return e._Persistence.getLastSeenTime(t)},getFirstSeenTime:function(){return e._Persistence.getFirstSeenTime(t)}}},this.mParticleUserCart=function(t){return{add:function(r,n){var o,i,s;e.Logger.warning("Deprecated function Identity.getCurrentUser().getCart().add() will be removed in future releases"),(s=Array.isArray(r)?r.slice():[r]).forEach((function(t){t.Attributes=e._Helpers.sanitizeAttributes(t.Attributes)})),e._Store.webviewBridgeEnabled?e._NativeSdkHelpers.sendToNative(v.NativeSdkPaths.AddToCart,JSON.stringify(s)):(e._SessionManager.resetSessionTimer(),i=(i=e._Persistence.getUserProductsFromLS(t)).concat(s),!0===n&&e._Events.logProductActionEvent(f.ProductActionType.AddToCart,s),i.length>e._Store.SDKConfig.maxProducts&&(e.Logger.verbose("The cart contains "+i.length+" items. Only "+e._Store.SDKConfig.maxProducts+" can currently be saved in cookies."),i=i.slice(-e._Store.SDKConfig.maxProducts)),(o=e._Persistence.getAllUserProductsFromLS())[t].cp=i,e._Persistence.setCartProducts(o))},remove:function(r,n){e.Logger.warning("Deprecated function Identity.getCurrentUser().getCart().remove() will be removed in future releases");var o,i,s=-1,a=null;e._Store.webviewBridgeEnabled?e._NativeSdkHelpers.sendToNative(v.NativeSdkPaths.RemoveFromCart,JSON.stringify(r)):(e._SessionManager.resetSessionTimer(),(i=e._Persistence.getUserProductsFromLS(t))&&(i.forEach((function(e,t){e.Sku===r.Sku&&(s=t,a=e)})),-1<s&&(i.splice(s,1),!0===n&&e._Events.logProductActionEvent(f.ProductActionType.RemoveFromCart,a))),(o=e._Persistence.getAllUserProductsFromLS())[t].cp=i,e._Persistence.setCartProducts(o))},clear:function(){var r;e.Logger.warning("Deprecated function Identity.getCurrentUser().getCart().clear() will be removed in future releases"),e._Store.webviewBridgeEnabled?e._NativeSdkHelpers.sendToNative(v.NativeSdkPaths.ClearCart):(e._SessionManager.resetSessionTimer(),(r=e._Persistence.getAllUserProductsFromLS())&&r[t]&&r[t].cp&&(r[t].cp=[],r[t].cp=[],e._Persistence.setCartProducts(r)))},getCartProducts:function(){return e.Logger.warning("Deprecated function Identity.getCurrentUser().getCart().getCartProducts() will be removed in future releases"),e._Persistence.getCartProducts(t)}}},this.parseIdentityResponse=function(r,n,o,i,s){var a,c,u,d,l=e.Identity.getUser(n),g={},p=l?l.getUserIdentities().userIdentities:{},m=e._Helpers.extend({},p);e._Store.identityCallInFlight=!1;try{if(e.Logger.verbose('Parsing "'+s+'" identity response from server'),r.responseText&&((u=JSON.parse(r.responseText)).hasOwnProperty("is_logged_in")&&(e._Store.isLoggedIn=u.is_logged_in)),(!l||l.getMPID()&&u.mpid&&u.mpid!==l.getMPID())&&(e._Store.mpid=u.mpid,l&&e._Persistence.setLastSeenTime(n),!e._Persistence.getFirstSeenTime(u.mpid)&&(c=!0),e._Persistence.setFirstSeenTime(u.mpid)),200===r.status){if("modify"===s)g=e._Identity.IdentityRequest.combineUserIdentities(p,i.userIdentities),e._Persistence.saveUserIdentitiesToPersistence(n,g);else{var v=t.IdentityAPI.getUser(u.mpid),h=v?v.getUserIdentities().userIdentities:{},y=e._Helpers.extend({},h);e.Logger.verbose("Successfully parsed Identity Response"),"identify"==s&&l&&u.mpid===l.getMPID()&&e._Persistence.setFirstSeenTime(u.mpid),d=e._Store.currentSessionMPIDs.indexOf(u.mpid),e._Store.sessionId&&u.mpid&&n!==u.mpid&&0>d&&e._Store.currentSessionMPIDs.push(u.mpid),-1<d&&(e._Store.currentSessionMPIDs=e._Store.currentSessionMPIDs.slice(0,d).concat(e._Store.currentSessionMPIDs.slice(d+1,e._Store.currentSessionMPIDs.length)),e._Store.currentSessionMPIDs.push(u.mpid)),e._CookieSyncManager.attemptCookieSync(n,u.mpid,c),t.checkIdentitySwap(n,u.mpid,e._Store.currentSessionMPIDs),i&&i.userIdentities&&Object.keys(i.userIdentities).length&&(g=t.IdentityRequest.combineUserIdentities(h,i.userIdentities)),e._Persistence.saveUserIdentitiesToPersistence(u.mpid,g),e._Persistence.update(),e._Persistence.findPrevCookiesBasedOnUI(i),e._Store.context=u.context||e._Store.context}if(a=e.Identity.getCurrentUser(),i&&i.onUserAlias&&e._Helpers.Validators.isFunction(i.onUserAlias))try{e.Logger.warning("Deprecated function onUserAlias will be removed in future releases"),i.onUserAlias(l,a)}catch(t){e.Logger.error("There was an error with your onUserAlias function - "+t)}var P=e._Persistence.getPersistence();a&&(e._Persistence.storeDataInMemory(P,a.getMPID()),(!l||a.getMPID()!==l.getMPID()||l.isLoggedIn()!==a.isLoggedIn())&&e._Forwarders.initForwarders(a.getUserIdentities().userIdentities,e._APIClient.prepareForwardingStats),e._Forwarders.setForwarderUserIdentities(a.getUserIdentities().userIdentities),e._Forwarders.setForwarderOnIdentityComplete(a,s),e._Forwarders.setForwarderOnUserIdentified(a,s));var b={};for(var C in g)b[f.IdentityType.getIdentityName(e._Helpers.parseNumber(C))]=g[C];t.sendUserIdentityChangeEvent(b,s,u.mpid,"modify"===s?m:y)}o?0===r.status?e._Helpers.invokeCallback(o,ft.noHttpCoverage,u||null,a):e._Helpers.invokeCallback(o,r.status,u||null,a):u&&u.errors&&u.errors.length&&e.Logger.error("Received HTTP response code of "+r.status+" - "+u.errors[0].message),e._APIClient.processQueuedEvents()}catch(t){o&&e._Helpers.invokeCallback(o,r.status,u||null),e.Logger.error("Error parsing JSON response from Identity server: "+t)}},this.sendUserIdentityChangeEvent=function(r,n,o,i){var s,a;if(o||"modify"===n)for(var c in s=this.IdentityAPI.getUser(o),r)if(i[c]!==r[c]){var u=!i[c];a=t.createUserIdentityChange(c,r[c],i[c],u,s),e._APIClient.sendEventToServer(a)}},this.createUserIdentityChange=function(t,r,n,o,i){return e._ServerModel.createEventObject({messageType:f.MessageType.UserIdentityChange,userIdentityChanges:{New:{IdentityType:t,Identity:r,CreatedThisBatch:o},Old:{IdentityType:t,Identity:n,CreatedThisBatch:!1}},userInMemory:i})},this.sendUserAttributeChangeEvent=function(r,n,o,i,s,a){var c=t.createUserAttributeChange(r,n,o,i,s,a);c&&e._APIClient.sendEventToServer(c)},this.createUserAttributeChange=function(t,r,n,o,i,s){var a;return void 0===n&&(n=null),r!==n&&(a=e._ServerModel.createEventObject({messageType:f.MessageType.UserAttributeChange,userAttributeChanges:{UserAttributeName:t,New:r,Old:n,Deleted:i,IsNewAttribute:o}},s)),a}}var ht=v.CCPAPurpose;function yt(e){var t=this;this.isEnabledForUserConsent=function(e,t){if(!e||!e.values||!e.values.length)return!0;if(!t)return!1;var r,n={},o=t.getConsentState();if(o){var i=o.getGDPRConsentState();if(i)for(var s in i)i.hasOwnProperty(s)&&(r=Ve.hashConsentPurposeConditionalForwarding("1",s),n[r]=i[s].Consented);var a=o.getCCPAConsentState();a&&(r=Ve.hashConsentPurposeConditionalForwarding("2",ht),n[r]=a.Consented)}var c=e.values.some((function(e){var t=e.consentPurpose,r=e.hasConsented;return!!n.hasOwnProperty(t)&&n[t]===r}));return e.includeOnMatch===c},this.createPrivacyConsent=function(t,r,n,o,i){return"boolean"==typeof t?r&&isNaN(r)?(e.Logger.error("Timestamp must be a valid number when constructing a Consent object."),null):n&&"string"!=typeof n?(e.Logger.error("Document must be a valid string when constructing a Consent object."),null):o&&"string"!=typeof o?(e.Logger.error("Location must be a valid string when constructing a Consent object."),null):i&&"string"!=typeof i?(e.Logger.error("Hardware ID must be a valid string when constructing a Consent object."),null):{Consented:t,Timestamp:r||Date.now(),ConsentDocument:n,Location:o,HardwareId:i}:(e.Logger.error("Consented boolean is required when constructing a Consent object."),null)},this.ConsentSerialization={toMinifiedJsonObject:function(e){var t,r={};if(e){var n=e.getGDPRConsentState();if(n)for(var o in r.gdpr={},n)if(n.hasOwnProperty(o)){var i=n[o];r.gdpr[o]={},"boolean"==typeof i.Consented&&(r.gdpr[o].c=i.Consented),"number"==typeof i.Timestamp&&(r.gdpr[o].ts=i.Timestamp),"string"==typeof i.ConsentDocument&&(r.gdpr[o].d=i.ConsentDocument),"string"==typeof i.Location&&(r.gdpr[o].l=i.Location),"string"==typeof i.HardwareId&&(r.gdpr[o].h=i.HardwareId)}var s=e.getCCPAConsentState();s&&(r.ccpa=((t={})[ht]={},t),"boolean"==typeof s.Consented&&(r.ccpa[ht].c=s.Consented),"number"==typeof s.Timestamp&&(r.ccpa[ht].ts=s.Timestamp),"string"==typeof s.ConsentDocument&&(r.ccpa[ht].d=s.ConsentDocument),"string"==typeof s.Location&&(r.ccpa[ht].l=s.Location),"string"==typeof s.HardwareId&&(r.ccpa[ht].h=s.HardwareId))}return r},fromMinifiedJsonObject:function(e){var r=t.createConsentState();if(e.gdpr)for(var n in e.gdpr)if(e.gdpr.hasOwnProperty(n)){var o=t.createPrivacyConsent(e.gdpr[n].c,e.gdpr[n].ts,e.gdpr[n].d,e.gdpr[n].l,e.gdpr[n].h);r.addGDPRConsentState(n,o)}if(e.ccpa&&e.ccpa.hasOwnProperty(ht)){var i=t.createPrivacyConsent(e.ccpa[ht].c,e.ccpa[ht].ts,e.ccpa[ht].d,e.ccpa[ht].l,e.ccpa[ht].h);r.setCCPAConsentState(i)}return r}},this.createConsentState=function(r){function n(e){if("string"!=typeof e)return null;var t=e.trim();return t.length?t.toLowerCase():null}function o(){return delete s[ht],this}var i={},s={};if(r){var a=t.createConsentState();return a.setGDPRConsentState(r.getGDPRConsentState()),a.setCCPAConsentState(r.getCCPAConsentState()),a}return{setGDPRConsentState:function(e){if(e){if(Z(e))for(var t in i={},e)e.hasOwnProperty(t)&&this.addGDPRConsentState(t,e[t])}else i={};return this},addGDPRConsentState:function(r,o){var s=n(r);if(!s)return e.Logger.error("Purpose must be a string."),this;if(!Z(o))return e.Logger.error("Invoked with a bad or empty consent object."),this;var a=t.createPrivacyConsent(o.Consented,o.Timestamp,o.ConsentDocument,o.Location,o.HardwareId);return a&&(i[s]=a),this},setCCPAConsentState:function(r){if(!Z(r))return e.Logger.error("Invoked with a bad or empty CCPA consent object."),this;var n=t.createPrivacyConsent(r.Consented,r.Timestamp,r.ConsentDocument,r.Location,r.HardwareId);return n&&(s[ht]=n),this},getCCPAConsentState:function(){return s[ht]},getGDPRConsentState:function(){return Object.assign({},i)},removeGDPRConsentState:function(e){var t=n(e);return t?(delete i[t],this):this},removeCCPAState:function(){return e.Logger.warning("removeCCPAState is deprecated and will be removed in a future release; use removeCCPAConsentState instead"),o()},removeCCPAConsentState:o}}}var Pt={ScreenView:"screen_view",CustomEvent:"custom_event",Commerce:"commerce",UserAttributes:"user_attributes",UserIdentities:"user_identities",ProductAction:"product_action",PromotionAction:"promotion_action",ProductImpression:"product_impression"},bt=function(){function e(e,t){var r,n,o,i,s,a,c,u,d,l,g,p,m,f,v,h=this;if(this.dataPlanMatchLookups={},this.blockEvents=!1,this.blockEventAttributes=!1,this.blockUserAttributes=!1,this.blockUserIdentities=!1,this.kitBlockingEnabled=!1,!e||e.document){this.kitBlockingEnabled=!0,this.mpInstance=t,this.blockEvents=null===(o=null===(n=null===(r=null==e?void 0:e.document)||void 0===r?void 0:r.dtpn)||void 0===n?void 0:n.blok)||void 0===o?void 0:o.ev,this.blockEventAttributes=null===(a=null===(s=null===(i=null==e?void 0:e.document)||void 0===i?void 0:i.dtpn)||void 0===s?void 0:s.blok)||void 0===a?void 0:a.ea,this.blockUserAttributes=null===(d=null===(u=null===(c=null==e?void 0:e.document)||void 0===c?void 0:c.dtpn)||void 0===u?void 0:u.blok)||void 0===d?void 0:d.ua,this.blockUserIdentities=null===(p=null===(g=null===(l=null==e?void 0:e.document)||void 0===l?void 0:l.dtpn)||void 0===g?void 0:g.blok)||void 0===p?void 0:p.id;var y=null===(v=null===(f=null===(m=null==e?void 0:e.document)||void 0===m?void 0:m.dtpn)||void 0===f?void 0:f.vers)||void 0===v?void 0:v.version_document,P=null==y?void 0:y.data_points;if(y)try{0<(null==P?void 0:P.length)&&P.forEach((function(e){return h.addToMatchLookups(e)}))}catch(e){this.mpInstance.Logger.error("There was an issue with the data plan: "+e)}}else this.kitBlockingEnabled=!1}return e.prototype.addToMatchLookups=function(e){var t,r,n;if(e.match&&e.validator){var o=this.generateMatchKey(e.match),i=this.getPlannedProperties(e.match.type,e.validator);this.dataPlanMatchLookups[o]=i,((null===(t=null==e?void 0:e.match)||void 0===t?void 0:t.type)===Pt.ProductImpression||(null===(r=null==e?void 0:e.match)||void 0===r?void 0:r.type)===Pt.ProductAction||(null===(n=null==e?void 0:e.match)||void 0===n?void 0:n.type)===Pt.PromotionAction)&&(o=this.generateProductAttributeMatchKey(e.match),i=this.getProductProperties(e.match.type,e.validator),this.dataPlanMatchLookups[o]=i)}else this.mpInstance.Logger.warning("Data Plan Point is not valid' + ".concat(e))},e.prototype.generateMatchKey=function(e){var t=e.criteria||"";switch(e.type){case Pt.CustomEvent:var r=t;return[Pt.CustomEvent,r.custom_event_type,r.event_name].join(":");case Pt.ScreenView:return[Pt.ScreenView,"",t.screen_name].join(":");case Pt.ProductAction:case Pt.PromotionAction:case Pt.ProductImpression:return[e.type,t.action].join(":");case Pt.UserIdentities:case Pt.UserAttributes:return[e.type].join(":");default:return null}},e.prototype.generateProductAttributeMatchKey=function(e){var t=e.criteria||"";switch(e.type){case Pt.ProductAction:case Pt.PromotionAction:return[e.type,t.action,"ProductAttributes"].join(":");case Pt.ProductImpression:return[e.type,"ProductAttributes"].join(":");default:return null}},e.prototype.getPlannedProperties=function(e,t){var r,n,o,i,s,a,c,u,d,l;switch(e){case Pt.CustomEvent:case Pt.ScreenView:case Pt.ProductAction:case Pt.PromotionAction:case Pt.ProductImpression:if(d=null===(i=null===(o=null===(n=null===(r=null==t?void 0:t.definition)||void 0===r?void 0:r.properties)||void 0===n?void 0:n.data)||void 0===o?void 0:o.properties)||void 0===i?void 0:i.custom_attributes){if(!0===d.additionalProperties||void 0===d.additionalProperties)return!0;for(var g={},p=0,m=Object.keys(d.properties);p<m.length;p++)g[m[p]]=!0;return g}return!1!==(null===(c=null===(a=null===(s=null==t?void 0:t.definition)||void 0===s?void 0:s.properties)||void 0===a?void 0:a.data)||void 0===c?void 0:c.additionalProperties)||{};case Pt.UserAttributes:case Pt.UserIdentities:if(!0===(l=null===(u=null==t?void 0:t.definition)||void 0===u?void 0:u.additionalProperties)||void 0===l)return!0;g={};for(var f=t.definition.properties,v=0,h=Object.keys(f);v<h.length;v++)g[h[v]]=!0;return g;default:return null}},e.prototype.getProductProperties=function(e,t){var r,n,o,i,s,a,c,u,d,l,g,p,m,f,v,h,y,P,b,C;switch(e){case Pt.ProductImpression:if(!1===(null==(C=null===(l=null===(d=null===(u=null===(c=null===(a=null===(s=null===(i=null===(o=null===(n=null===(r=null==t?void 0:t.definition)||void 0===r?void 0:r.properties)||void 0===n?void 0:n.data)||void 0===o?void 0:o.properties)||void 0===i?void 0:i.product_impressions)||void 0===s?void 0:s.items)||void 0===a?void 0:a.properties)||void 0===c?void 0:c.products)||void 0===u?void 0:u.items)||void 0===d?void 0:d.properties)||void 0===l?void 0:l.custom_attributes)?void 0:C.additionalProperties)){for(var w={},S=0,_=Object.keys(null==C?void 0:C.properties);S<_.length;S++)w[_[S]]=!0;return w}return!0;case Pt.ProductAction:case Pt.PromotionAction:if((C=null===(b=null===(P=null===(y=null===(h=null===(v=null===(f=null===(m=null===(p=null===(g=null==t?void 0:t.definition)||void 0===g?void 0:g.properties)||void 0===p?void 0:p.data)||void 0===m?void 0:m.properties)||void 0===f?void 0:f.product_action)||void 0===v?void 0:v.properties)||void 0===h?void 0:h.products)||void 0===y?void 0:y.items)||void 0===P?void 0:P.properties)||void 0===b?void 0:b.custom_attributes)&&!1===C.additionalProperties){w={};for(var I=0,A=Object.keys(null==C?void 0:C.properties);I<A.length;I++)w[A[I]]=!0;return w}return!0;default:return null}},e.prototype.getMatchKey=function(e){switch(e.event_type){case K.EventTypeEnum.screenView:var t=e;return t.data?["screen_view","",t.data.screen_name].join(":"):null;case K.EventTypeEnum.commerceEvent:var r=e,n=[];if(r&&r.data){var o=r.data,i=o.product_action,s=o.product_impressions,a=o.promotion_action;i?(n.push(Pt.ProductAction),n.push(i.action)):a?(n.push(Pt.PromotionAction),n.push(a.action)):s&&n.push(Pt.ProductImpression)}return n.join(":");case K.EventTypeEnum.customEvent:var c=e;return c.data?["custom_event",c.data.custom_event_type,c.data.event_name].join(":"):null;default:return null}},e.prototype.getProductAttributeMatchKey=function(e){if(e.event_type===K.EventTypeEnum.commerceEvent){var t=[],r=e.data,n=r.product_action,o=r.product_impressions,i=r.promotion_action;return n?(t.push(Pt.ProductAction),t.push(n.action),t.push("ProductAttributes")):i?(t.push(Pt.PromotionAction),t.push(i.action),t.push("ProductAttributes")):o&&(t.push(Pt.ProductImpression),t.push("ProductAttributes")),t.join(":")}return null},e.prototype.createBlockedEvent=function(e){try{return e&&(e=this.transformEventAndEventAttributes(e)),e&&e.EventDataType===f.MessageType.Commerce&&(e=this.transformProductAttributes(e)),e&&(e=this.transformUserAttributes(e),e=this.transformUserIdentities(e)),e}catch(t){return e}},e.prototype.transformEventAndEventAttributes=function(e){var t=w({},e),r=ve(t),n=this.getMatchKey(r),o=this.dataPlanMatchLookups[n];if(this.blockEvents&&!o)return null;if(this.blockEventAttributes){if(!0===o)return t;if(o){for(var i,s=0,a=Object.keys(t.EventAttributes);s<a.length;s++)o[i=a[s]]||delete t.EventAttributes[i];return t}return t}return t},e.prototype.transformProductAttributes=function(e){function t(e,t){t.forEach((function(t){for(var r,n=0,o=Object.keys(t.Attributes);n<o.length;n++)r=o[n],e[r]||delete t.Attributes[r]}))}var r,n=w({},e),o=ve(n),i=this.getProductAttributeMatchKey(o),s=this.dataPlanMatchLookups[i];if(this.blockEvents&&!s)return null;if(this.blockEventAttributes){if(!0===s)return n;if(s){switch(e.EventCategory){case f.CommerceEventType.ProductImpression:n.ProductImpressions.forEach((function(e){t(s,null==e?void 0:e.ProductList)}));break;case f.CommerceEventType.ProductPurchase:t(s,null===(r=n.ProductAction)||void 0===r?void 0:r.ProductList);break;default:this.mpInstance.Logger.warning("Product Not Supported ")}return n}return n}return n},e.prototype.transformUserAttributes=function(e){var t=w({},e);if(this.blockUserAttributes){var r=this.dataPlanMatchLookups.user_attributes;if(this.mpInstance._Helpers.isObject(r))for(var n,o=0,i=Object.keys(t.UserAttributes);o<i.length;o++)r[n=i[o]]||delete t.UserAttributes[n]}return t},e.prototype.isAttributeKeyBlocked=function(e){if(!this.blockUserAttributes)return!1;if(this.blockUserAttributes){var t=this.dataPlanMatchLookups.user_attributes;if(!0===t)return!1;if(!t[e])return!0}return!1},e.prototype.isIdentityBlocked=function(e){if(!this.blockUserIdentities)return!1;if(!this.blockUserIdentities)return!1;var t=this.dataPlanMatchLookups.user_identities;return!0!==t&&!t[e]},e.prototype.transformUserIdentities=function(e){var t,r=this,n=w({},e);if(this.blockUserIdentities){var o=this.dataPlanMatchLookups.user_identities;this.mpInstance._Helpers.isObject(o)&&(null===(t=null==n?void 0:n.UserIdentities)||void 0===t?void 0:t.length)&&n.UserIdentities.forEach((function(e,t){var i=f.IdentityType.getIdentityName(r.mpInstance._Helpers.parseNumber(e.Type));o[i]||n.UserIdentities.splice(t,1)}))}return n},e}();function Ct(){this.getSDKConfiguration=function(e,t,r,n){var o;try{var i=n._Helpers.createXHR((function(){4===i.readyState&&(200===i.status?(t=n._Helpers.extend({},t,JSON.parse(i.responseText)),r(e,t,n),n.Logger.verbose("Successfully received configuration from server")):(r(e,t,n),n.Logger.verbose("Issue with receiving configuration from server, received HTTP Code of "+i.status)))}));o="https://"+n._Store.SDKConfig.configUrl+e+"/config?env=",o+=t.isDevelopmentMode?"1":"0";var s=t.dataPlan;s&&(s.planId&&(o=o+"&plan_id="+s.planId||""),s.planVersion&&(o=o+"&plan_version="+s.planVersion||"")),i&&(i.open("get",o),i.send(null))}catch(o){r(e,t,n),n.Logger.error("Error getting forwarder configuration from mParticle servers.")}}}var wt=v.HTTPCodes,St=v.Messages;function _t(e){this.sendAliasRequest=function(t,r){var n;if(e.Logger.verbose(St.InformationMessages.SendAliasHttp),n=e._Helpers.createXHR((function(){if(4===n.readyState){if(e.Logger.verbose("Received "+n.statusText+" from server"),200!==n.status&&202!==n.status&&n.responseText){var t=JSON.parse(n.responseText);if(t.hasOwnProperty("message")){var o=t.message;return void e._Helpers.invokeAliasCallback(r,n.status,o)}}e._Helpers.invokeAliasCallback(r,n.status)}})),n)try{n.open("post",e._Helpers.createServiceUrl(e._Store.SDKConfig.aliasUrl,e._Store.devToken)+"/Alias"),n.send(JSON.stringify(t))}catch(t){e._Helpers.invokeAliasCallback(r,wt.noHttpCoverage,t),e.Logger.error("Error sending alias request to mParticle servers. "+t)}},this.sendIdentityRequest=function(t,r,n,o,i,s){var a,c;if(e.Logger.verbose(St.InformationMessages.SendIdentityBegin),t){if(e.Logger.verbose(St.InformationMessages.SendIdentityHttp),a=e._Helpers.createXHR((function(){4===a.readyState&&(e.Logger.verbose("Received "+a.statusText+" from server"),i(a,c,n,o,r))})))try{e._Store.identityCallInFlight?e._Helpers.invokeCallback(n,wt.activeIdentityRequest,"There is currently an Identity request processing. Please wait for this to return before requesting again"):(c=s||null,"modify"===r?a.open("post",e._Helpers.createServiceUrl(e._Store.SDKConfig.identityUrl)+s+"/"+r):a.open("post",e._Helpers.createServiceUrl(e._Store.SDKConfig.identityUrl)+r),a.setRequestHeader("Content-Type","application/json"),a.setRequestHeader("x-mp-key",e._Store.devToken),e._Store.identityCallInFlight=!0,a.send(JSON.stringify(t)))}catch(t){e._Store.identityCallInFlight=!1,e._Helpers.invokeCallback(n,wt.noHttpCoverage,t),e.Logger.error("Error sending identity request to servers with status code "+a.status+" - "+t)}}else e.Logger.error(St.ErrorMessages.APIRequestEmpty)}}var It=v.Messages,At=v.HTTPCodes;function Et(e){var t=this;this._instanceName=e,this._NativeSdkHelpers=new qe(this),this._SessionManager=new We(this),this._Persistence=new ot(this),this._Helpers=new He(this),this._Events=new st(this),this._CookieSyncManager=new ze(this),this._ServerModel=new gt(this),this._Ecommerce=new Qe(this),this._ForwardingStatsUploader=new pt(this),this._Consent=new yt(this),this._IdentityAPIClient=new _t(this),this._preInit={readyQueue:[],integrationDelays:{},forwarderConstructors:[]},this.IdentityType=f.IdentityType,this.EventType=f.EventType,this.CommerceEventType=f.CommerceEventType,this.PromotionType=f.PromotionActionType,this.ProductActionType=f.ProductActionType,this._Identity=new vt(this),this.Identity=this._Identity.IdentityAPI,this.generateHash=this._Helpers.generateHash,this.getDeviceId=this._Persistence.getDeviceId,"undefined"!=typeof window&&window.mParticle&&window.mParticle.config&&window.mParticle.config.hasOwnProperty("rq")&&(this._preInit.readyQueue=window.mParticle.config.rq),this.init=function(e,t){return t||console.warn("You did not pass a config object to init(). mParticle will not initialize properly"),function(e,t,r){e.Logger=new Ze(r),e._Store=new Ye(r,e),window.mParticle.Store=e._Store,e._Store.devToken=t||null,e.Logger.verbose(It.InformationMessages.StartingInitialization);try{e._Store.isLocalStorageAvailable=e._Persistence.determineLocalStorageAvailability(window.localStorage)}catch(t){e.Logger.warning("localStorage is not available, using cookies if available"),e._Store.isLocalStorageAvailable=!1}}(this,e,t),t?void(!t.hasOwnProperty("requestConfig")||t.requestConfig?(new Ct).getSDKConfiguration(e,t,Tt,this):Tt(e,t,this)):void console.error("No config available on the window, please pass a config object to mParticle.init()")},this.setLogLevel=function(e){t.Logger.setLogLevel(e)},this.reset=function(e){try{e._Persistence.resetPersistence(),e._Store&&delete e._Store}catch(e){console.error("Cannot reset mParticle",e)}},this._resetForTests=function(e,t,r){r._Store&&delete r._Store,r._Store=new Ye(e,r),r._Store.isLocalStorageAvailable=r._Persistence.determineLocalStorageAvailability(window.localStorage),r._Events.stopTracking(),t||r._Persistence.resetPersistence(),r._Persistence.forwardingStatsBatches.uploadsTable={},r._Persistence.forwardingStatsBatches.forwardingStatsEventQueue=[],r._preInit={readyQueue:[],pixelConfigurations:[],integrationDelays:{},forwarderConstructors:[],isDevelopmentMode:!1}},this.ready=function(e){t.isInitialized()&&"function"==typeof e?e():t._preInit.readyQueue.push(e)},this.getEnvironment=function(){return t._Store.SDKConfig.isDevelopmentMode?f.Environment.Development:f.Environment.Production},this.getVersion=function(){return v.sdkVersion},this.setAppVersion=function(e){kt((function(){t.setAppVersion(e)}),t)||(t._Store.SDKConfig.appVersion=e,t._Persistence.update())},this.setDeviceId=function(e){kt((function(){t.setDeviceId(e)}),t)||this._Persistence.setDeviceId(e)},this.isInitialized=function(){return!!t._Store&&t._Store.isInitialized},this.getAppName=function(){return t._Store.SDKConfig.appName},this.setAppName=function(e){kt((function(){t.setAppName(e)}),t)||(t._Store.SDKConfig.appName=e)},this.getAppVersion=function(){return t._Store.SDKConfig.appVersion},this.stopTrackingLocation=function(){t._SessionManager.resetSessionTimer(),t._Events.stopTracking()},this.startTrackingLocation=function(e){t._Helpers.Validators.isFunction(e)||t.Logger.warning("Warning: Location tracking is triggered, but not including a callback into the `startTrackingLocation` may result in events logged too quickly and not being associated with a location."),t._SessionManager.resetSessionTimer(),t._Events.startTracking(e)},this.setPosition=function(e,r){kt((function(){t.setPosition(e,r)}),t)||(t._SessionManager.resetSessionTimer(),"number"==typeof e&&"number"==typeof r?t._Store.currentPosition={lat:e,lng:r}:t.Logger.error("Position latitude and/or longitude must both be of type number"))},this.startNewSession=function(){t._SessionManager.startNewSession()},this.endSession=function(){t._SessionManager.endSession(!0)},this.logBaseEvent=function(e,r){if(!kt((function(){t.logBaseEvent(e,r)}),t))return t._SessionManager.resetSessionTimer(),"string"!=typeof e.name?void t.Logger.error(It.ErrorMessages.EventNameInvalidType):(e.eventType||(e.eventType=f.EventType.Unknown),t._Helpers.canLog()?void t._Events.logEvent(e,r):void t.Logger.error(It.ErrorMessages.LoggingDisabled))},this.logEvent=function(e,r,n,o,i){if(!kt((function(){t.logEvent(e,r,n,o,i)}),t))return t._SessionManager.resetSessionTimer(),"string"!=typeof e?void t.Logger.error(It.ErrorMessages.EventNameInvalidType):(r||(r=f.EventType.Unknown),t._Helpers.isEventType(r)?t._Helpers.canLog()?void t._Events.logEvent({messageType:f.MessageType.PageEvent,name:e,data:n,eventType:r,customFlags:o},i):void t.Logger.error(It.ErrorMessages.LoggingDisabled):void t.Logger.error("Invalid event type: "+r+", must be one of: \n"+JSON.stringify(f.EventType)))},this.logError=function(e,r){if(!kt((function(){t.logError(e,r)}),t)&&(t._SessionManager.resetSessionTimer(),e)){"string"==typeof e&&(e={message:e});var n={m:e.message?e.message:e,s:"Error",t:e.stack||null};if(r){var o=t._Helpers.sanitizeAttributes(r,n.m);for(var i in o)n[i]=o[i]}t._Events.logEvent({messageType:f.MessageType.CrashReport,name:e.name?e.name:"Error",data:n,eventType:f.EventType.Other})}},this.logLink=function(e,r,n,o){t._Events.addEventHandler("click",e,r,o,n)},this.logForm=function(e,r,n,o){t._Events.addEventHandler("submit",e,r,o,n)},this.logPageView=function(e,r,n,i){if(!kt((function(){t.logPageView(e,r,n,i)}),t)){if(t._SessionManager.resetSessionTimer(),t._Helpers.canLog()){if(t._Helpers.Validators.isStringOrNumber(e)||(e="PageView"),r){if(!t._Helpers.isObject(r))return void t.Logger.error("The attributes argument must be an object. A "+o(r)+" was entered. Please correct and retry.")}else r={hostname:window.location.hostname,title:window.document.title};if(n&&!t._Helpers.isObject(n))return void t.Logger.error("The customFlags argument must be an object. A "+o(n)+" was entered. Please correct and retry.")}t._Events.logEvent({messageType:f.MessageType.PageView,name:e,data:r,eventType:f.EventType.Unknown,customFlags:n},i)}},this.upload=function(){t._Helpers.canLog()&&(t._Store.webviewBridgeEnabled?t._NativeSdkHelpers.sendToNative(v.NativeSdkPaths.Upload):t._APIClient.uploader.prepareAndUpload(!1,!1))},this.Consent={createCCPAConsent:t._Consent.createPrivacyConsent,createGDPRConsent:t._Consent.createPrivacyConsent,createConsentState:t._Consent.createConsentState},this.eCommerce={Cart:{add:function(e,r){t.Logger.warning("Deprecated function eCommerce.Cart.add() will be removed in future releases");var n,o=t.Identity.getCurrentUser();o&&(n=o.getMPID()),t._Identity.mParticleUserCart(n).add(e,r)},remove:function(e,r){t.Logger.warning("Deprecated function eCommerce.Cart.remove() will be removed in future releases");var n,o=t.Identity.getCurrentUser();o&&(n=o.getMPID()),t._Identity.mParticleUserCart(n).remove(e,r)},clear:function(){t.Logger.warning("Deprecated function eCommerce.Cart.clear() will be removed in future releases");var e,r=t.Identity.getCurrentUser();r&&(e=r.getMPID()),t._Identity.mParticleUserCart(e).clear()}},setCurrencyCode:function(e){return kt((function(){t.eCommerce.setCurrencyCode(e)}),t)?void 0:"string"==typeof e?(t._SessionManager.resetSessionTimer(),void(t._Store.currencyCode=e)):void t.Logger.error("Code must be a string")},createProduct:function(e,r,n,o,i,s,a,c,u,d){return t._Ecommerce.createProduct(e,r,n,o,i,s,a,c,u,d)},createPromotion:function(e,r,n,o){return t._Ecommerce.createPromotion(e,r,n,o)},createImpression:function(e,r){return t._Ecommerce.createImpression(e,r)},createTransactionAttributes:function(e,r,n,o,i,s){return t._Ecommerce.createTransactionAttributes(e,r,n,o,i,s)},logCheckout:function(e,r,n,o){return t.Logger.warning("mParticle.logCheckout is deprecated, please use mParticle.logProductAction instead"),t._Store.isInitialized?(t._SessionManager.resetSessionTimer(),void t._Events.logCheckoutEvent(e,r,n,o)):void t.ready((function(){t.eCommerce.logCheckout(e,r,n,o)}))},logProductAction:function(e,r,n,o,i,s){kt((function(){t.eCommerce.logProductAction(e,r,n,o,i,s)}),t)||(t._SessionManager.resetSessionTimer(),t._Events.logProductActionEvent(e,r,n,o,i,s))},logPurchase:function(e,r,n,o,i){return t.Logger.warning("mParticle.logPurchase is deprecated, please use mParticle.logProductAction instead"),t._Store.isInitialized?e&&r?(t._SessionManager.resetSessionTimer(),void t._Events.logPurchaseEvent(e,r,o,i)):void t.Logger.error(It.ErrorMessages.BadLogPurchase):void t.ready((function(){t.eCommerce.logPurchase(e,r,n,o,i)}))},logPromotion:function(e,r,n,o,i){kt((function(){t.eCommerce.logPromotion(e,r,n,o,i)}),t)||(t._SessionManager.resetSessionTimer(),t._Events.logPromotionEvent(e,r,n,o,i))},logImpression:function(e,r,n,o){kt((function(){t.eCommerce.logImpression(e,r,n,o)}),t)||(t._SessionManager.resetSessionTimer(),t._Events.logImpressionEvent(e,r,n,o))},logRefund:function(e,r,n,o,i){return t.Logger.warning("mParticle.logRefund is deprecated, please use mParticle.logProductAction instead"),t._Store.isInitialized?(t._SessionManager.resetSessionTimer(),void t._Events.logRefundEvent(e,r,o,i)):void t.ready((function(){t.eCommerce.logRefund(e,r,n,o,i)}))},expandCommerceEvent:function(e){return t._Ecommerce.expandCommerceEvent(e)}},this.setSessionAttribute=function(e,r){if(!kt((function(){t.setSessionAttribute(e,r)}),t)&&t._Helpers.canLog()){if(!t._Helpers.Validators.isValidAttributeValue(r))return void t.Logger.error(It.ErrorMessages.BadAttribute);if(!t._Helpers.Validators.isValidKeyValue(e))return void t.Logger.error(It.ErrorMessages.BadKey);if(t._Store.webviewBridgeEnabled)t._NativeSdkHelpers.sendToNative(v.NativeSdkPaths.SetSessionAttribute,JSON.stringify({key:e,value:r}));else{var n=t._Helpers.findKeyInObject(t._Store.sessionAttributes,e);n&&(e=n),t._Store.sessionAttributes[e]=r,t._Persistence.update(),t._Forwarders.applyToForwarders("setSessionAttribute",[e,r])}}},this.setOptOut=function(e){kt((function(){t.setOptOut(e)}),t)||(t._SessionManager.resetSessionTimer(),t._Store.isEnabled=!e,t._Events.logOptOut(),t._Persistence.update(),t._Store.activeForwarders.length&&t._Store.activeForwarders.forEach((function(r){if(r.setOptOut){var n=r.setOptOut(e);n&&t.Logger.verbose(n)}})))},this.setIntegrationAttribute=function(e,r){if(!kt((function(){t.setIntegrationAttribute(e,r)}),t)){if("number"!=typeof e)return void t.Logger.error("integrationId must be a number");if(null===r)t._Store.integrationAttributes[e]={};else{if(!t._Helpers.isObject(r))return void t.Logger.error("Attrs must be an object with keys and values. You entered a "+o(r));if(0===Object.keys(r).length)t._Store.integrationAttributes[e]={};else for(var n in r){if("string"!=typeof n){t.Logger.error("Keys must be strings, you entered a "+o(n));continue}if("string"!=typeof r[n]){t.Logger.error("Values for integration attributes must be strings. You entered a "+o(r[n]));continue}t._Helpers.isObject(t._Store.integrationAttributes[e])||(t._Store.integrationAttributes[e]={}),t._Store.integrationAttributes[e][n]=r[n]}}t._Persistence.update()}},this.getIntegrationAttributes=function(e){return t._Store.integrationAttributes[e]?t._Store.integrationAttributes[e]:{}},this.addForwarder=function(e){t._preInit.forwarderConstructors.push(e)},this.configurePixel=function(e){t._Forwarders.configurePixel(e)},this._getActiveForwarders=function(){return t._Store.activeForwarders},this._getIntegrationDelays=function(){return t._preInit.integrationDelays},this._setIntegrationDelay=function(e,r){if(t._preInit.integrationDelays[e]=r,!0!==r){var n=Object.keys(t._preInit.integrationDelays);if(0!==n.length){var o=n.some((function(e){return!0===t._preInit.integrationDelays[e]}));o||t._APIClient.processQueuedEvents()}}},this._setWrapperSDKInfo=function(e,r){kt((function(){t._setWrapperSDKInfo(e,r)}),t)||(void 0===t._Store.wrapperSDKInfo||!t._Store.wrapperSDKInfo.isInfoSet)&&(t._Store.wrapperSDKInfo={name:e,version:r,isInfoSet:!0})}}function Tt(e,t,r){var n=function(e,t){var r,n,o,i;return e.dataPlanOptions&&(t.Logger.verbose("Customer provided data plan found"),i=e.dataPlanOptions,n={document:{dtpn:{vers:i.dataPlanVersion,blok:{ev:i.blockEvents,ea:i.blockEventAttributes,ua:i.blockUserAttributes,id:i.blockUserIdentities}}}}),n||(e.dataPlan&&e.dataPlan.document?e.dataPlan.document.error_message?o=e.dataPlan.document.error_message:(t.Logger.verbose("Data plan found from mParticle.js"),n=e.dataPlan):e.dataPlanResult&&(e.dataPlanResult.error_message?o=e.dataPlanResult.error_message:(t.Logger.verbose("Data plan found from /config"),n={document:e.dataPlanResult}))),o&&t.Logger.error(o),n&&(r=new bt(n,t)),r}(t,r);if(r._APIClient=new Ne(r,n),r._Forwarders=new ct(r,n),t.flags&&t.flags.hasOwnProperty(v.FeatureFlags.EventBatchingIntervalMillis)&&(r._Store.SDKConfig.flags[v.FeatureFlags.EventBatchingIntervalMillis]=t.flags[v.FeatureFlags.EventBatchingIntervalMillis]),r._Store.storageName=r._Helpers.createMainStorageName(t.workspaceToken),r._Store.prodStorageName=r._Helpers.createProductStorageName(t.workspaceToken),t.hasOwnProperty("workspaceToken")?r._Store.SDKConfig.workspaceToken=t.workspaceToken:r.Logger.warning("You should have a workspaceToken on your config object for security purposes."),t.hasOwnProperty("requiredWebviewBridgeName")?r._Store.SDKConfig.requiredWebviewBridgeName=t.requiredWebviewBridgeName:t.hasOwnProperty("workspaceToken")&&(r._Store.SDKConfig.requiredWebviewBridgeName=t.workspaceToken),r._Store.webviewBridgeEnabled=r._NativeSdkHelpers.isWebviewEnabled(r._Store.SDKConfig.requiredWebviewBridgeName,r._Store.SDKConfig.minWebviewBridgeVersion),r._Store.configurationLoaded=!0,r._Store.webviewBridgeEnabled||r._Persistence.initializeStorage(),r._Store.webviewBridgeEnabled)r._NativeSdkHelpers.sendToNative(v.NativeSdkPaths.SetSessionAttribute,JSON.stringify({key:"$src_env",value:"webview"})),e&&r._NativeSdkHelpers.sendToNative(v.NativeSdkPaths.SetSessionAttribute,JSON.stringify({key:"$src_key",value:e}));else{var o;if(r._Helpers.isObject(r._Store.SDKConfig.identifyRequest)&&r._Helpers.isObject(r._Store.SDKConfig.identifyRequest.userIdentities)&&0===Object.keys(r._Store.SDKConfig.identifyRequest.userIdentities).length||!r._Store.SDKConfig.identifyRequest){var i={};if(o=r.Identity.getCurrentUser()){var s=o.getUserIdentities().userIdentities||{};for(var a in s)s.hasOwnProperty(a)&&(i[a]=s[a])}r._Store.SDKConfig.identifyRequest={userIdentities:i}}o=r.Identity.getCurrentUser(),r._Helpers.getFeatureFlag(v.FeatureFlags.ReportBatching)&&r._ForwardingStatsUploader.startForwardingStatsTimer(),r._Forwarders.processForwarders(t,r._APIClient.prepareForwardingStats),r._Forwarders.processPixelConfigs(t),r._SessionManager.initialize(),r._Events.logAST(),!r._Store.identifyCalled&&r._Store.SDKConfig.identityCallback&&o&&o.getMPID()&&r._Store.SDKConfig.identityCallback({httpCode:At.activeSession,getUser:function(){return r._Identity.mParticleUser(o.getMPID())},getPreviousUser:function(){var e=r.Identity.getUsers(),t=e.shift();return t&&o&&t.getMPID()===o.getMPID()&&(t=e.shift()),t||null},body:{mpid:o.getMPID(),is_logged_in:r._Store.isLoggedIn,matched_identities:o.getUserIdentities().userIdentities,context:null,is_ephemeral:!1}})}r._Store.isInitialized=!0,r._preInit.readyQueue&&r._preInit.readyQueue.length&&(r._preInit.readyQueue.forEach((function(e){r._Helpers.Validators.isFunction(e)?e():Array.isArray(e)&&function(e,t){var r=e,n=r.splice(0,1)[0];if(mParticle[r[0]])mParticle[n].apply(this,r);else{var o=n.split(".");try{for(var i=mParticle,s=0;s<o.length;s++)i=i[o[s]];i.apply(this,r)}catch(e){t.Logger.verbose("Unable to compute proper mParticle function "+e)}}}(e,r)})),r._preInit.readyQueue=[]),r._Store.isFirstRun&&(r._Store.isFirstRun=!1)}function kt(e,t){return!t.isInitialized()&&(t.ready((function(){e()})),!0)}var Dt,Ot,Ut,Lt=function(){return null},Mt=function(){function e(){}return e.prototype.getMPInstance=function(){return{_Helpers:{sanitizeAttributes:window.mParticle.getInstance()._Helpers.sanitizeAttributes,generateHash:function(){return"mockHash"},generateUniqueId:function(){return"mockId"},extend:window.mParticle.getInstance()._Helpers.extend,createServiceUrl:Lt,parseNumber:Lt,isObject:Lt,returnConvertedBoolean:Lt,Validators:null},_resetForTests:Lt,_APIClient:null,MPSideloadedKit:null,_Consent:null,_Events:null,_Forwarders:null,_NativeSdkHelpers:null,_Persistence:null,_preInit:null,Consent:null,_ServerModel:null,_SessionManager:null,_Store:{sessionId:"mockSessionId",sideloadedKits:[],devToken:"test_dev_token",isFirstRun:!0,isEnabled:!0,sessionAttributes:{},currentSessionMPIDs:[],consentState:null,clientId:null,deviceId:null,serverSettings:{},dateLastEventSent:null,sessionStartDate:null,currentPosition:null,isTracking:!1,watchPositionId:null,cartProducts:[],eventQueue:[],currencyCode:null,globalTimer:null,context:null,configurationLoaded:!1,identityCallInFlight:!1,nonCurrentUserMPIDs:{},identifyCalled:!1,isLoggedIn:!1,cookieSyncDates:{},integrationAttributes:{},requireDelay:!0,isLocalStorageAvailable:null,integrationDelayTimeoutStart:null,storageName:null,prodStorageName:null,activeForwarders:[],kits:{},configuredForwarders:[],pixelConfigurations:[],wrapperSDKInfo:{name:"none",version:null,isInfoSet:!1},SDKConfig:{isDevelopmentMode:!1,onCreateBatch:Lt}},config:null,eCommerce:null,Identity:{getCurrentUser:Lt,IdentityAPI:{},identify:Lt,login:Lt,logout:Lt,modify:Lt},Logger:{verbose:Lt,error:Lt,warning:Lt},ProductActionType:null,ServerModel:null,addForwarder:Lt,generateHash:Lt,getAppVersion:Lt,getAppName:Lt,getInstance:Lt,getDeviceId:Lt,init:Lt,logBaseEvent:Lt,logEvent:Lt,logLevel:"none",setPosition:Lt,upload:Lt}},e.prototype.createSDKEventFunction=function(e){return new gt(this.getMPInstance()).createEventObject(e)},e.prototype.returnBatch=function(e){var t=this,r=this.getMPInstance();return le("0",Array.isArray(e)?e.map((function(e){return t.createSDKEventFunction(e)})):[this.createSDKEventFunction(e)],r)},e}();!function(e){e[e.Unknown=0]="Unknown",e[e.Navigation=1]="Navigation",e[e.Location=2]="Location",e[e.Search=3]="Search",e[e.Transaction=4]="Transaction",e[e.UserContent=5]="UserContent",e[e.UserPreference=6]="UserPreference",e[e.Social=7]="Social",e[e.Other=8]="Other",e[e.Media=9]="Media"}(Dt||(Dt={})),function(e){e[e.SessionStart=1]="SessionStart",e[e.SessionEnd=2]="SessionEnd",e[e.PageView=3]="PageView",e[e.PageEvent=4]="PageEvent",e[e.CrashReport=5]="CrashReport",e[e.OptOut=6]="OptOut",e[e.AppStateTransition=10]="AppStateTransition",e[e.Profile=14]="Profile",e[e.Commerce=16]="Commerce",e[e.UserAttributeChange=17]="UserAttributeChange",e[e.UserIdentityChange=18]="UserIdentityChange",e[e.Media=20]="Media"}(Ot||(Ot={})),function(e){e[e.Other=0]="Other",e[e.CustomerId=1]="CustomerId",e[e.Facebook=2]="Facebook",e[e.Twitter=3]="Twitter",e[e.Google=4]="Google",e[e.Microsoft=5]="Microsoft",e[e.Yahoo=6]="Yahoo",e[e.Email=7]="Email",e[e.FacebookCustomAudienceId=9]="FacebookCustomAudienceId",e[e.Other2=10]="Other2",e[e.Other3=11]="Other3",e[e.Other4=12]="Other4",e[e.Other5=13]="Other5",e[e.Other6=14]="Other6",e[e.Other7=15]="Other7",e[e.Other8=16]="Other8",e[e.Other9=17]="Other9",e[e.Other10=18]="Other10",e[e.MobileNumber=19]="MobileNumber",e[e.PhoneNumber2=20]="PhoneNumber2",e[e.PhoneNumber3=21]="PhoneNumber3"}(Ut||(Ut={}));var Nt=function(){function e(e){this.filterDictionary={eventTypeFilters:[],eventNameFilters:[],screenNameFilters:[],screenAttributeFilters:[],userIdentityFilters:[],userAttributeFilters:[],attributeFilters:[],consentRegulationFilters:[],consentRegulationPurposeFilters:[],messageTypeFilters:[],messageTypeStateFilters:[],filteringEventAttributeValue:{},filteringUserAttributeValue:{},filteringConsentRuleValues:{}},this.kitInstance=e}return e.prototype.addEventTypeFilter=function(e){var t=Ve.hashEventType(e);this.filterDictionary.eventTypeFilters.push(t)},e.prototype.addEventNameFilter=function(e,t){var r=Ve.hashEventName(t,e);this.filterDictionary.eventNameFilters.push(r)},e.prototype.addEventAttributeFilter=function(e,t,r){var n=Ve.hashEventAttributeKey(e,t,r);this.filterDictionary.attributeFilters.push(n)},e.prototype.addScreenNameFilter=function(e){var t=Ve.hashEventName(e,Dt.Unknown);this.filterDictionary.screenNameFilters.push(t)},e.prototype.addScreenAttributeFilter=function(e,t){var r=Ve.hashEventAttributeKey(Dt.Unknown,e,t);this.filterDictionary.screenAttributeFilters.push(r)},e.prototype.addUserIdentityFilter=function(e){var t=Ve.hashUserIdentity(e);this.filterDictionary.userIdentityFilters.push(t)},e.prototype.addUserAttributeFilter=function(e){var t=Ve.hashUserAttribute(e);this.filterDictionary.userAttributeFilters.push(t)},e}();Array.prototype.forEach||(Array.prototype.forEach=n.forEach),Array.prototype.map||(Array.prototype.map=n.map),Array.prototype.filter||(Array.prototype.filter=n.filter),Array.isArray||(Array.prototype.isArray=n.isArray);var Ft=new function(){var e=this;this.Store={},this._instances={},this.IdentityType=f.IdentityType,this.EventType=f.EventType,this.CommerceEventType=f.CommerceEventType,this.PromotionType=f.PromotionActionType,this.ProductActionType=f.ProductActionType,this.MPSideloadedKit=Nt,"undefined"!=typeof window&&(this.isIOS=!(!window.mParticle||!window.mParticle.isIOS)&&window.mParticle.isIOS,this.config=window.mParticle&&window.mParticle.config?window.mParticle.config:{}),this.init=function(t,r,n){!r&&window.mParticle&&window.mParticle.config&&(console.warn("You did not pass a config object to mParticle.init(). Attempting to use the window.mParticle.config if it exists. Please note that in a future release, this may not work and mParticle will not initialize properly"),r=window.mParticle?window.mParticle.config:{}),n=(n&&0!==n.length?n:v.DefaultInstance).toLowerCase();var o=e._instances[n];void 0===o&&(o=new Et(t),e._instances[n]=o),o.init(t,r,n)},this.getInstance=function(t){var r;return t?(r=e._instances[t.toLowerCase()])||(console.log("You tried to initialize an instance named "+t+". This instance does not exist. Check your instance name or initialize a new instance with this name before calling it."),null):(t=v.DefaultInstance,(r=e._instances[t])||(r=new Et(t),e._instances[v.DefaultInstance]=r),r)},this.getDeviceId=function(){return e.getInstance().getDeviceId()},this.setDeviceId=function(t){return e.getInstance().setDeviceId(t)},this.isInitialized=function(){return e.getInstance().isInitialized()},this.startNewSession=function(){e.getInstance().startNewSession()},this.endSession=function(){e.getInstance().endSession()},this.setLogLevel=function(t){e.getInstance().setLogLevel(t)},this.ready=function(t){e.getInstance().ready(t)},this.setAppVersion=function(t){e.getInstance().setAppVersion(t)},this.getAppName=function(){return e.getInstance().getAppName()},this.setAppName=function(t){e.getInstance().setAppName(t)},this.getAppVersion=function(){return e.getInstance().getAppVersion()},this.getEnvironment=function(){return e.getInstance().getEnvironment()},this.stopTrackingLocation=function(){e.getInstance().stopTrackingLocation()},this.startTrackingLocation=function(t){e.getInstance().startTrackingLocation(t)},this.setPosition=function(t,r){e.getInstance().setPosition(t,r)},this.startNewSession=function(){e.getInstance().startNewSession()},this.endSession=function(){e.getInstance().endSession()},this.logBaseEvent=function(t,r){e.getInstance().logBaseEvent(t,r)},this.logEvent=function(t,r,n,o,i){e.getInstance().logEvent(t,r,n,o,i)},this.logError=function(t,r){e.getInstance().logError(t,r)},this.logLink=function(t,r,n,o){e.getInstance().logLink(t,r,n,o)},this.logForm=function(t,r,n,o){e.getInstance().logForm(t,r,n,o)},this.logPageView=function(t,r,n,o){e.getInstance().logPageView(t,r,n,o)},this.upload=function(){e.getInstance().upload()},this.eCommerce={Cart:{add:function(t,r){e.getInstance().eCommerce.Cart.add(t,r)},remove:function(t,r){e.getInstance().eCommerce.Cart.remove(t,r)},clear:function(){e.getInstance().eCommerce.Cart.clear()}},setCurrencyCode:function(t){e.getInstance().eCommerce.setCurrencyCode(t)},createProduct:function(t,r,n,o,i,s,a,c,u,d){return e.getInstance().eCommerce.createProduct(t,r,n,o,i,s,a,c,u,d)},createPromotion:function(t,r,n,o){return e.getInstance().eCommerce.createPromotion(t,r,n,o)},createImpression:function(t,r){return e.getInstance().eCommerce.createImpression(t,r)},createTransactionAttributes:function(t,r,n,o,i,s){return e.getInstance().eCommerce.createTransactionAttributes(t,r,n,o,i,s)},logCheckout:function(t,r,n,o){e.getInstance().eCommerce.logCheckout(t,r,n,o)},logProductAction:function(t,r,n,o,i,s){e.getInstance().eCommerce.logProductAction(t,r,n,o,i,s)},logPurchase:function(t,r,n,o,i){e.getInstance().eCommerce.logPurchase(t,r,n,o,i)},logPromotion:function(t,r,n,o,i){e.getInstance().eCommerce.logPromotion(t,r,n,o,i)},logImpression:function(t,r,n,o){e.getInstance().eCommerce.logImpression(t,r,n,o)},logRefund:function(t,r,n,o,i){e.getInstance().eCommerce.logRefund(t,r,n,o,i)},expandCommerceEvent:function(t){return e.getInstance().eCommerce.expandCommerceEvent(t)}},this.setSessionAttribute=function(t,r){e.getInstance().setSessionAttribute(t,r)},this.setOptOut=function(t){e.getInstance().setOptOut(t)},this.setIntegrationAttribute=function(t,r){e.getInstance().setIntegrationAttribute(t,r)},this.getIntegrationAttributes=function(t){return e.getInstance().getIntegrationAttributes(t)},this.Identity={HTTPCodes:e.getInstance().Identity.HTTPCodes,aliasUsers:function(t,r){e.getInstance().Identity.aliasUsers(t,r)},createAliasRequest:function(t,r){return e.getInstance().Identity.createAliasRequest(t,r)},getCurrentUser:function(){return e.getInstance().Identity.getCurrentUser()},getUser:function(t){return e.getInstance().Identity.getUser(t)},getUsers:function(){return e.getInstance().Identity.getUsers()},identify:function(t,r){e.getInstance().Identity.identify(t,r)},login:function(t,r){e.getInstance().Identity.login(t,r)},logout:function(t,r){e.getInstance().Identity.logout(t,r)},modify:function(t,r){e.getInstance().Identity.modify(t,r)}},this.sessionManager={getSession:function(){return e.getInstance()._SessionManager.getSession()}},this.Consent={createConsentState:function(){return e.getInstance().Consent.createConsentState()},createGDPRConsent:function(t,r,n,o,i){return e.getInstance().Consent.createGDPRConsent(t,r,n,o,i)},createCCPAConsent:function(t,r,n,o,i){return e.getInstance().Consent.createGDPRConsent(t,r,n,o,i)}},this.reset=function(){e.getInstance().reset(e.getInstance())},this._resetForTests=function(t,r){"boolean"==typeof r?e.getInstance()._resetForTests(t,r,e.getInstance()):e.getInstance()._resetForTests(t,!1,e.getInstance())},this.configurePixel=function(t){e.getInstance().configurePixel(t)},this._setIntegrationDelay=function(t,r){e.getInstance()._setIntegrationDelay(t,r)},this._getIntegrationDelays=function(){return e.getInstance()._getIntegrationDelays()},this.getVersion=function(){return e.getInstance().getVersion()},this.generateHash=function(t){return e.getInstance().generateHash(t)},this.addForwarder=function(t){e.getInstance().addForwarder(t)},this._getActiveForwarders=function(){return e.getInstance()._getActiveForwarders()},this._setWrapperSDKInfo=function(t,r){e.getInstance()._setWrapperSDKInfo(t,r)}};"undefined"!=typeof window&&(window.mParticle=Ft,window.mParticle._BatchValidator=new Mt);var Vt=r(364),Rt=r(963),Ht=r(438),xt=r(943),jt=r(862),Kt=r(99),qt=r(334),Bt=function(){return window.location.origin.includes("hdev-")||window.location.origin.includes("hdev3-")||window.location.origin.includes("uat-")||window.location.origin.includes("local-preview-")},zt=function(){return window.location.origin.includes("cmcmarkets")?".cmcmarkets.com":window.location.origin.includes("cfdonlinetrader")?".cfdonlinetrader.com":window.location.origin.includes("cmcinvest.com")?".cmcinvest.com":window.location.origin.includes("cmcinvest.sg")?".cmcinvest.sg":void 0};function Gt(e){var t=("; "+document.cookie).split("; "+e+"=");if(t.length>1)return t.pop().split(";")[0]}function Wt(e){var t,r,n=null!==(t=null===(r=Gt(e))||void 0===r?void 0:r.split("|"))&&void 0!==t?t:null;if(null===n)return null;var o={};return n.forEach((function(e){var t=e.split("=");o[t[0]]=t[1]})),o}function Jt(e){return Jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Jt(e)}function Qt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,s,a=[],c=!0,u=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(a.push(n.value),a.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw o}}return a}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Yt(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Yt(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Yt(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Zt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(o=n.key,i=void 0,i=function(e,t){if("object"!==Jt(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Jt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===Jt(i)?i:String(i)),n)}var o,i}var Xt,$t=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,n=[{key:"updateUserAttributes",value:function(e){var t=window.mParticle.getInstance(e).Identity.getCurrentUser(),r=Wt("__utmzz");window.optLayer&&(window.optLayer[0].campaign&&t.setUserAttribute("Optimizely Campaign ID",window.optLayer[0].campaign),window.optLayer[0].experiment&&t.setUserAttribute("Optimizely Experiment Name",window.optLayer[0].experiment),window.optLayer[0].variation&&t.setUserAttribute("Optimizely Variation ID",window.optLayer[0].variation)),r&&r.utmcsr?t.setUserAttribute("utm_source",r.utmcsr):t.setUserAttribute("utm_source",""),r&&r.utmcmd?t.setUserAttribute("utm_medium",r.utmcmd):t.setUserAttribute("utm_medium",""),r&&r.utmccn?t.setUserAttribute("utm_campaign",r.utmccn):t.setUserAttribute("utm_campaign",""),r&&r.utmcct?t.setUserAttribute("utm_content",r.utmcct):t.setUserAttribute("utm_content",""),r&&r.utmctr?t.setUserAttribute("utm_term",r.utmctr):t.setUserAttribute("utm_term",""),r&&r.utmgclid?t.setUserAttribute("gclid",r.utmgclid):t.setUserAttribute("gclid",""),r&&r.utmdclid?t.setUserAttribute("dclid",r.utmdclid):t.setUserAttribute("dclid","")}},{key:"updateConvertUserAttributes",value:function(e){var t=window.mParticle.getInstance(e).Identity.getCurrentUser(),r=function(e,t){for(var r=0;r<e.length;r++){var n=e[r];if(n.event&&n.event.startsWith(t))return n}return null}(window.dataLayer,"convert-trigger-experiment");r&&r.experiment_id&&r.variation_name&&(t.setUserAttribute("convert_experiment_id",r.experiment_id),t.setUserAttribute("convert_variation_name",r.variation_name))}},{key:"pageViewEvent",value:function(e){var t,r,n,o,i,s,a,c,u=Wt("__utmzz"),d=window.mParticle.getInstance(e).Identity.getCurrentUser().getAllUserAttributes();if(a=d,0===Object.keys(a).length)this.updateUserAttributes(e);else if(u.utmcsr!==d.utm_source||u.utmcmd!==d.utm_medium)this.updateUserAttributes(e);else{for(var l=window.location.href.split("?")[1],g=!1,p=0,m=["gtm_source","gtm_medium","gtm_campaign","gtm_content","gtm_term","utm_source","utm_medium","utm_campaign","utm_content","utm_term","gclid","dclid"];p<m.length;p++){var f=m[p];if(l&&l.includes(f+"=")){g=!0;break}}g&&this.updateUserAttributes(e)}this.updateConvertUserAttributes(e),window.mParticle.getInstance(e).logPageView("Page",Object.assign({"page.url":window.location.href,"page.country_code":(null===(t=dataLayer[0].page)||void 0===t?void 0:t.countryCode)||null,"page.region_code":(c=document.querySelector("body"),c.getAttribute("data-language")&&c.getAttribute("data-region")?c.getAttribute("data-language")+"_"+c.getAttribute("data-region"):c.getAttribute("data-language")?c.getAttribute("data-language"):""),"page.category":(null===(r=dataLayer[0].page)||void 0===r?void 0:r.page_category_general)||"other","page.type":(null===(n=dataLayer[0].page)||void 0===n?void 0:n.type)||"other","page.environment":(null===(o=dataLayer[0].page)||void 0===o?void 0:o.environment)||"other"},Object.fromEntries(Object.entries(null!==(i=null===(s=dataLayer[0])||void 0===s?void 0:s.page)&&void 0!==i?i:{}).filter((function(e){var t=Qt(e,2),r=t[0];return t[1],r.startsWith("mp_attribute_")})))))}}],(r=null)&&Zt(t.prototype,r),n&&Zt(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}(),er=function(e,t){var r=Gt("_ga");if(r){var n,o=r.split(".");if(o[2]&&o[3])o=o[2]+"."+o[3],(null===(n=e.getUser().getUserIdentities())||void 0===n||null===(n=n.userIdentities)||void 0===n?void 0:n.other3)!==o?window.mParticle.getInstance(t).Identity.modify({userIdentities:{other3:o}},(function(){tr(t)})):tr(t)}else tr(t)},tr=function(e){var t;t="__utmzz",document.cookie.indexOf(t)>=0?$t.pageViewEvent(e):window.addEventListener("dynamicMobileAppLinkInitialized",(function(t){$t.pageViewEvent(e)}))},rr=null!==(Xt=document.querySelector("body").getAttribute("data-region"))&&void 0!==Xt?Xt:null,nr=["at","fr","it","se"],or="default_instance",ir="au_instance";window.mParticle=null;var sr={isDevelopmentMode:Bt(),useCookieStorage:!0,cookieDomain:zt(),dataPlan:{planId:window.location.origin.includes("cmcmarkets")||window.location.origin.includes("cfdonlinetrader")?"html_web_onboarding_mobile_apps":window.location.href.includes("cmcinvest.com/en-gb")?"sinatra_invest":window.location.href.includes("cmcinvest.com/en-sg")?"web_invest_sg":void 0},identityCallback:function(e){var t=new Event("mParticleInitialized");window.dispatchEvent(t),e.getUser()&&er(e,or)}},ar={isDevelopmentMode:Bt(),useCookieStorage:!0,cookieDomain:zt(),dataPlan:{planId:"cfd_website"},identityCallback:function(e){e.getUser()&&er(e,ir)}},cr=[sr];if("au"===rr&&cr.push(ar),cr.forEach((function(e){Vt.ZP.register(e),Rt.ZP.register(e),Ht.ZP.register(e),Kt.Z.register(e),qt.ZP.register(e),nr.includes(rr)||(xt.ZP.register(e),jt.ZP.register(e))})),window.mParticleApiKey){var ur=window.mParticleApiKey;window.location.origin.includes("cmcinvest.com")&&(ur="us1-304ce6f17ac60c478777d19bdf2b71a7",window.location.pathname.includes("/en-sg/")&&(ur="us1-f5ed7156e4ef694ca8934651e5655363")),window.location.origin.includes("cfdonlinetrader")&&(ur="us1-885b6300f4a3574bbe3a6d89380d0f99"),window.mParticle=Ft,"au"===rr?(window.mParticle.init(ur,sr,or),window.mParticle.init("us1-f5ed7156e4ef694ca8934651e5655363",ar,ir)):window.mParticle.init(ur,sr)}})()})();